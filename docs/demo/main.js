(()=>{var D=(e,t)=>()=>(e&&(t=e(e=0)),t);var ao=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ze=(e,t,r)=>new Promise((n,o)=>{var c=s=>{try{i(r.next(s))}catch(u){o(u)}},a=s=>{try{i(r.throw(s))}catch(u){o(u)}},i=s=>s.done?n(s.value):Promise.resolve(s.value).then(c,a);i((r=r.apply(e,t)).next())});var Ae,ir=D(()=>{Ae={COLUMNS:0,ROWS:1,MAX_COLUMNS:2,MAX_ROWS:3}});var ke,ur,fr,so,lr,mr,io,_e,xr,$e,yr=D(()=>{ir();ke=e=>typeof e=="number"?e:e.value,ur=0,fr=ur+256,so=fr+256,lr=so+2560,mr=lr+65536,io=mr+65536,_e=class{constructor(t){this.state=t,this.appStateAddr=this.state.exports.init(this.osAddr)}static load(t){return ze(this,null,function*(){let r={env:{prn:(c,a)=>{let i=n.exports,s=new Uint8ClampedArray(i.memory.buffer,c,a),u=new TextDecoder("utf8");console.info(u.decode(s))}}},n;if(WebAssembly.instantiateStreaming!=null)n=(yield WebAssembly.instantiateStreaming(fetch(t),r)).instance;else{let c=yield fetch(t);n=(yield WebAssembly.instantiate(yield c.arrayBuffer(),r)).instance}let o=n.exports;return console.log("exports",Object.keys(o)),new _e({instance:n,exports:o})})}get osAddr(){return ke(this.state.exports.OS)}tick(t){this.state.exports.frame(this.osAddr,this.appStateAddr,t)}setInput(t,r){let n=ke(this.state.exports.OS)+fr;new DataView(this.state.exports.memory.buffer,n).setUint8(t,r)}get config(){let t=new DataView(this.state.exports.memory.buffer,ke(this.state.exports.OS)+ur,4);return new xr(t)}get screen(){return new $e(this.state.exports.OS,lr,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}get bgColors(){return new $e(this.state.exports.OS,mr,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}get fgColors(){return new $e(this.state.exports.OS,io,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}},xr=class{constructor(t){this.data=t}get rows(){return this.data.getUint8(Ae.ROWS)}get cols(){return this.data.getUint8(Ae.COLUMNS)}set max_rows(t){this.data.setUint8(Ae.MAX_ROWS,t)}set max_cols(t){this.data.setUint8(Ae.MAX_COLUMNS,t)}},$e=class{constructor(t,r,n,o,c){let a=ke(t)+r;this.updateView=new DataView(n,a,1),this.cells=new DataView(n,a+1,c*o)}get update(){return this.updateView.getUint8(0)>0}set update(t){this.updateView.setUint8(0,t?1:0)}}});function ht(e,t,r){let n=new Et(3);return e&&(n[0]=e),t&&(n[1]=t),r&&(n[2]=r),n}function uo(e,t,r){return r=r||new Et(3),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function fo(e,t,r){return r=r||new Et(3),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function lo(e){return e=e||new pr(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mo(e,t){t=t||new pr(16);let r=e[0*4+0],n=e[0*4+1],o=e[0*4+2],c=e[0*4+3],a=e[1*4+0],i=e[1*4+1],s=e[1*4+2],u=e[1*4+3],m=e[2*4+0],x=e[2*4+1],f=e[2*4+2],p=e[2*4+3],l=e[3*4+0],y=e[3*4+1],E=e[3*4+2],h=e[3*4+3],b=f*h,_=E*p,S=s*h,T=E*u,F=s*p,w=f*u,P=o*h,g=E*c,U=o*p,v=f*c,W=o*u,z=s*c,re=m*y,se=l*x,ie=a*y,ue=l*i,fe=a*x,le=m*i,Me=r*y,Le=l*n,ve=r*x,Oe=m*n,Ge=r*i,Ve=a*n,or=b*i+T*x+F*y-(_*i+S*x+w*y),cr=_*n+P*x+v*y-(b*n+g*x+U*y),ar=S*n+g*i+W*y-(T*n+P*i+z*y),sr=w*n+U*i+z*x-(F*n+v*i+W*x),d=1/(r*or+a*cr+m*ar+l*sr);return t[0]=d*or,t[1]=d*cr,t[2]=d*ar,t[3]=d*sr,t[4]=d*(_*a+S*m+w*l-(b*a+T*m+F*l)),t[5]=d*(b*r+g*m+U*l-(_*r+P*m+v*l)),t[6]=d*(T*r+P*a+z*l-(S*r+g*a+W*l)),t[7]=d*(F*r+v*a+W*m-(w*r+U*a+z*m)),t[8]=d*(re*u+ue*p+fe*h-(se*u+ie*p+le*h)),t[9]=d*(se*c+Me*p+Oe*h-(re*c+Le*p+ve*h)),t[10]=d*(ie*c+Le*u+Ge*h-(ue*c+Me*u+Ve*h)),t[11]=d*(le*c+ve*u+Ve*p-(fe*c+Oe*u+Ge*p)),t[12]=d*(ie*f+le*E+se*s-(fe*E+re*s+ue*f)),t[13]=d*(ve*E+re*o+Le*f-(Me*f+Oe*E+se*o)),t[14]=d*(Me*s+Ve*E+ue*o-(Ge*E+ie*o+Le*s)),t[15]=d*(Ge*f+fe*o+Oe*s-(ve*s+Ve*f+le*o)),t}function xo(e,t,r){r=r||ht();let n=t[0],o=t[1],c=t[2],a=n*e[0*4+3]+o*e[1*4+3]+c*e[2*4+3]+e[3*4+3];return r[0]=(n*e[0*4+0]+o*e[1*4+0]+c*e[2*4+0]+e[3*4+0])/a,r[1]=(n*e[0*4+1]+o*e[1*4+1]+c*e[2*4+1]+e[3*4+1])/a,r[2]=(n*e[0*4+2]+o*e[1*4+2]+c*e[2*4+2]+e[3*4+2])/a,r}function yo(e,t,r){r=r||ht();let n=t[0],o=t[1],c=t[2];return r[0]=n*e[0*4+0]+o*e[1*4+0]+c*e[2*4+0],r[1]=n*e[0*4+1]+o*e[1*4+1]+c*e[2*4+1],r[2]=n*e[0*4+2]+o*e[1*4+2]+c*e[2*4+2],r}function We(e){if(e instanceof Int8Array)return bt;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return Fe;if(e instanceof Int16Array)return Tt;if(e instanceof Uint16Array)return At;if(e instanceof Int32Array)return _t;if(e instanceof Uint32Array)return Ft;if(e instanceof Float32Array)return St;throw new Error("unsupported typed array type")}function Co(e){if(e===Int8Array)return bt;if(e===Uint8Array||e===Uint8ClampedArray)return Fe;if(e===Int16Array)return Tt;if(e===Uint16Array)return At;if(e===Int32Array)return _t;if(e===Uint32Array)return Ft;if(e===Float32Array)return St;throw new Error("unsupported typed array type")}function wo(e){let t=Er[e];if(!t)throw new Error("unknown gl type");return t}function hr(...e){console.error(...e)}function Ro(e,t){return typeof WebGLBuffer!="undefined"&&t instanceof WebGLBuffer}function br(e,t){return typeof WebGLRenderbuffer!="undefined"&&t instanceof WebGLRenderbuffer}function Io(e,t){return typeof WebGLShader!="undefined"&&t instanceof WebGLShader}function He(e,t){return typeof WebGLTexture!="undefined"&&t instanceof WebGLTexture}function Po(e,t){return typeof WebGLSampler!="undefined"&&t instanceof WebGLSampler}function Oo(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||Tr)}function Ct(e,t,r,n){if(Ro(e,t))return t;r=r||j;let o=e.createBuffer();return Oo(e,r,o,t,n),o}function Fr(e){return e==="indices"}function Go(e){return e instanceof Int8Array||e instanceof Uint8Array}function Vo(e){return e===Int8Array||e===Uint8Array}function Sr(e){return e.length?e:e.data}function Cr(e,t){let r;if(zo.test(e)?r=2:ko.test(e)?r=4:r=3,t%r>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function wr(e,t){return e.numComponents||e.size||Cr(t,Sr(e).length)}function Xe(e,t){if(Se(e))return e;if(Se(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(Fr(t)?r=Uint16Array:r=Float32Array),new r(e.data)}function $o(e,t){let r={};return Object.keys(t).forEach(function(n){if(!Fr(n)){let o=t[n],c=o.attrib||o.name||o.attribName||_r.attribPrefix+n;if(o.value){if(!Array.isArray(o.value)&&!Se(o.value))throw new Error("array.value is not array or typedarray");r[c]={value:o.value}}else{let a,i,s,u;if(o.buffer&&o.buffer instanceof WebGLBuffer)a=o.buffer,u=o.numComponents||o.size,i=o.type,s=o.normalize;else if(typeof o=="number"||typeof o.data=="number"){let m=o.data||o,x=o.type||Float32Array,f=m*x.BYTES_PER_ELEMENT;i=Co(x),s=o.normalize!==void 0?o.normalize:Vo(x),u=o.numComponents||o.size||Cr(n,m),a=e.createBuffer(),e.bindBuffer(j,a),e.bufferData(j,f,o.drawType||Tr)}else{let m=Xe(o,n);a=Ct(e,m,void 0,o.drawType),i=We(m),s=o.normalize!==void 0?o.normalize:Go(m),u=wr(o,n)}r[c]={buffer:a,numComponents:u,type:i,normalize:s,stride:o.stride||0,offset:o.offset||0,divisor:o.divisor===void 0?void 0:o.divisor,drawType:o.drawType}}}}),e.bindBuffer(j,null),r}function Wo(e,t){return t===go||t===Do?1:t===No||t===Uo?2:t===Mo||t===Lo||t===vo?4:0}function Ho(e){let t,r;for(r=0;r<me.length&&(t=me[r],!(t in e));++r);r===me.length&&(t=Object.keys(e)[0]);let n=e[t],o=Sr(n).length,c=wr(n,t),a=o/c;if(o%c>0)throw new Error(`numComponents ${c} not correct for length ${o}`);return a}function Xo(e,t){let r,n;for(n=0;n<me.length&&(r=me[n],!(r in t||(r=_r.attribPrefix+r,r in t)));++n);n===me.length&&(r=Object.keys(t)[0]);let o=t[r];e.bindBuffer(j,o.buffer);let c=e.getBufferParameter(j,Bo);e.bindBuffer(j,null);let a=Wo(e,o.type),i=c/a,s=o.numComponents||o.size,u=i/s;if(u%1!==0)throw new Error(`numComponents ${s} not correct for length ${length}`);return u}function Ce(e,t,r){let n=$o(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);let c=t.indices;if(c){let a=Xe(c,"indices");o.indices=Ct(e,a,Ar),o.numElements=a.length,o.elementType=We(a)}else o.numElements||(o.numElements=Xo(e,o.attribs));return o}function Yo(e,t,r){let n=r==="indices"?Ar:j,o=Xe(t,r);return Ct(e,o,n)}function jo(e,t){let r={};return Object.keys(t).forEach(function(n){r[n]=Yo(e,t[n],n)}),t.indices?(r.numElements=t.indices.length,r.elementType=We(Xe(t.indices))):r.numElements=Ho(t),r}function qo(e,t){let r=0;return e.push=function(){for(let n=0;n<arguments.length;++n){let o=arguments[n];if(o instanceof Array||Se(o))for(let c=0;c<o.length;++c)e[r++]=o[c];else e[r++]=o}},e.reset=function(n){r=n||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function C(e,t,r){let n=r||Float32Array;return qo(new n(e*t),e)}function wt(e,t,r){let n=e.length,o=new Float32Array(3);for(let c=0;c<n;c+=3)r(t,[e[c],e[c+1],e[c+2]],o),e[c]=o[0],e[c+1]=o[1],e[c+2]=o[2]}function Ko(e,t,r){r=r||ht();let n=t[0],o=t[1],c=t[2];return r[0]=n*e[0*4+0]+o*e[0*4+1]+c*e[0*4+2],r[1]=n*e[1*4+0]+o*e[1*4+1]+c*e[1*4+2],r[2]=n*e[2*4+0]+o*e[2*4+1]+c*e[2*4+2],r}function Zo(e,t){return wt(e,t,yo),e}function Qo(e,t){return wt(e,mo(t),Ko),e}function Jo(e,t){return wt(e,t,xo),e}function ec(e,t){return Object.keys(e).forEach(function(r){let n=e[r];r.indexOf("pos")>=0?Jo(n,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?Zo(n,t):r.indexOf("norm")>=0&&Qo(n,t)}),e}function Rr(e,t,r){return e=e||2,t=t||0,r=r||0,e*=.5,{position:{numComponents:2,data:[t+-1*e,r+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function Ir(e,t,r,n,o){e=e||1,t=t||1,r=r||1,n=n||1,o=o||lo();let c=(r+1)*(n+1),a=C(3,c),i=C(3,c),s=C(2,c);for(let f=0;f<=n;f++)for(let p=0;p<=r;p++){let l=p/r,y=f/n;a.push(e*l-e*.5,0,t*y-t*.5),i.push(0,1,0),s.push(l,y)}let u=r+1,m=C(3,r*n*2,Uint16Array);for(let f=0;f<n;f++)for(let p=0;p<r;p++)m.push((f+0)*u+p,(f+1)*u+p,(f+0)*u+p+1),m.push((f+1)*u+p,(f+1)*u+p+1,(f+0)*u+p+1);return ec({position:a,normal:i,texcoord:s,indices:m},o)}function Pr(e,t,r,n,o,c,a){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");n=n||0,o=o||Math.PI,c=c||0,a=a||Math.PI*2;let i=o-n,s=a-c,u=(t+1)*(r+1),m=C(3,u),x=C(3,u),f=C(2,u);for(let y=0;y<=r;y++)for(let E=0;E<=t;E++){let h=E/t,b=y/r,_=s*h+c,S=i*b+n,T=Math.sin(_),F=Math.cos(_),w=Math.sin(S),P=Math.cos(S),g=F*w,U=P,v=T*w;m.push(e*g,e*U,e*v),x.push(g,U,v),f.push(1-h,b)}let p=t+1,l=C(3,t*r*2,Uint16Array);for(let y=0;y<t;y++)for(let E=0;E<r;E++)l.push((E+0)*p+y,(E+0)*p+y+1,(E+1)*p+y),l.push((E+1)*p+y,(E+0)*p+y+1,(E+1)*p+y+1);return{position:m,normal:x,texcoord:f,indices:l}}function Br(e){e=e||1;let t=e/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],c=6*4,a=C(3,c),i=C(3,c),s=C(2,c),u=C(3,6*2,Uint16Array);for(let m=0;m<6;++m){let x=tc[m];for(let p=0;p<4;++p){let l=r[x[p]],y=n[m],E=o[p];a.push(l),i.push(y),s.push(E)}let f=4*m;u.push(f+0,f+1,f+2),u.push(f+0,f+2,f+3)}return{position:a,normal:i,texcoord:s,indices:u}}function Rt(e,t,r,n,o,c,a){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");let i=c===void 0?!0:c,s=a===void 0?!0:a,u=(i?2:0)+(s?2:0),m=(n+1)*(o+1+u),x=C(3,m),f=C(3,m),p=C(2,m),l=C(3,n*(o+u/2)*2,Uint16Array),y=n+1,E=Math.atan2(e-t,r),h=Math.cos(E),b=Math.sin(E),_=i?-2:0,S=o+(s?2:0);for(let T=_;T<=S;++T){let F=T/o,w=r*F,P;T<0?(w=0,F=1,P=e):T>o?(w=r,F=1,P=t):P=e+(t-e)*(T/o),(T===-2||T===o+2)&&(P=0,F=0),w-=r/2;for(let g=0;g<y;++g){let U=Math.sin(g*Math.PI*2/n),v=Math.cos(g*Math.PI*2/n);x.push(U*P,w,v*P),T<0?f.push(0,-1,0):T>o?f.push(0,1,0):P===0?f.push(0,0,0):f.push(U*h,b,v*h),p.push(g/n,1-F)}}for(let T=0;T<o+u;++T)if(!(T===1&&i||T===o+u-2&&s))for(let F=0;F<n;++F)l.push(y*(T+0)+0+F,y*(T+0)+1+F,y*(T+1)+1+F),l.push(y*(T+0)+0+F,y*(T+1)+1+F,y*(T+1)+0+F);return{position:x,normal:f,texcoord:p,indices:l}}function gr(e,t){t=t||[];let r=[];for(let n=0;n<e.length;n+=4){let o=e[n],c=e.slice(n+1,n+4);c.push.apply(c,t);for(let a=0;a<o;++a)r.push.apply(r,c)}return r}function dr(){let e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0],r=gr([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=gr([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),o=e.length/3,c={position:C(3,o),texcoord:C(2,o),normal:C(3,o),color:C(4,o,Uint8Array),indices:C(3,o/3,Uint16Array)};c.position.push(e),c.texcoord.push(t),c.normal.push(r),c.color.push(n);for(let a=0;a<o;++a)c.indices.push(a);return c}function Dr(e,t,r,n,o,c,a){if(o<=0)throw new Error("subdivisionDown must be > 0");c=c||0,a=a||1;let i=2,s=a-c,u=(o+1)*2*(2+i),m=C(3,u),x=C(3,u),f=C(2,u);function p(b,_,S){return b+(_-b)*S}function l(b,_,S,T,F,w){for(let P=0;P<=o;P++){let g=_/(i-1),U=P/o,v=(g-.5)*2,W=(c+U*s)*Math.PI,z=Math.sin(W),re=Math.cos(W),se=p(e,b,z),ie=v*n,ue=re*e,fe=z*se;m.push(ie,ue,fe);let le=uo(fo([0,z,re],S),T);x.push(le),f.push(g*F+w,U)}}for(let b=0;b<i;b++){let _=(b/(i-1)-.5)*2;l(t,b,[1,1,1],[0,0,0],1,0),l(t,b,[0,0,0],[_,0,0],0,0),l(r,b,[1,1,1],[0,0,0],1,0),l(r,b,[0,0,0],[_,0,0],0,1)}let y=C(3,o*2*(2+i),Uint16Array);function E(b,_){for(let S=0;S<o;++S)y.push(b+S+0,b+S+1,_+S+0),y.push(b+S+1,_+S+1,_+S+0)}let h=o+1;return E(h*0,h*4),E(h*5,h*7),E(h*6,h*2),E(h*3,h*1),{position:m,normal:x,texcoord:f,indices:y}}function Nr(e,t,r,n,o,c){return Rt(e,e,t,r,n,o,c)}function Ur(e,t,r,n,o,c){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0,c=c||Math.PI*2;let a=c-o,i=r+1,s=n+1,u=i*s,m=C(3,u),x=C(3,u),f=C(2,u),p=C(3,r*n*2,Uint16Array);for(let l=0;l<s;++l){let y=l/n,E=y*Math.PI*2,h=Math.sin(E),b=e+h*t,_=Math.cos(E),S=_*t;for(let T=0;T<i;++T){let F=T/r,w=o+F*a,P=Math.sin(w),g=Math.cos(w),U=P*b,v=g*b,W=P*h,z=g*h;m.push(U,S,v),x.push(W,_,z),f.push(F,1-y)}}for(let l=0;l<n;++l)for(let y=0;y<r;++y){let E=1+y,h=1+l;p.push(i*l+y,i*h+y,i*l+E),p.push(i*h+y,i*h+E,i*l+E)}return{position:m,normal:x,texcoord:f,indices:p}}function Mr(e,t,r,n,o){if(t<3)throw new Error("divisions must be at least 3");r=r||1,o=o||1,n=n||0;let c=(t+1)*(r+1),a=C(3,c),i=C(3,c),s=C(2,c),u=C(3,r*t*2,Uint16Array),m=0,x=e-n,f=t+1;for(let p=0;p<=r;++p){let l=n+x*Math.pow(p/r,o);for(let y=0;y<=t;++y){let E=2*Math.PI*y/t,h=l*Math.cos(E),b=l*Math.sin(E);if(a.push(h,0,b),i.push(0,1,0),s.push(1-y/t,p/r),p>0&&y!==t){let _=m+(y+1),S=m+y,T=m+y-f,F=m+(y+1)-f;u.push(_,S,T),u.push(_,T,F)}}m+=t+1}return{position:a,normal:i,texcoord:s,indices:u}}function k(e){return function(t){let r=e.apply(this,Array.prototype.slice.call(arguments,1));return jo(t,r)}}function $(e){return function(t){let r=e.apply(null,Array.prototype.slice.call(arguments,1));return Ce(t,r)}}function we(e){return!!e.texStorage2D}function Je(e){if(!Lt){let t={};t[Pt]={textureFormat:Pt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[I,G,Re,N]},t[Bt]={textureFormat:Bt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[I,G,Re,N]},t[gt]={textureFormat:gt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[I,G,Re,N]},t[O]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[I,G,Re,N,Hr]},t[R]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[I,G,Re,N,$r,Wr]},t[ye]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ne,pe]},t[Ec]={textureFormat:Pe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[I]},t[hc]={textureFormat:Pe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Q]},t[bc]={textureFormat:Pe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[N,G]},t[Tc]={textureFormat:Pe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[N]},t[Ac]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[I]},t[_c]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Q]},t[Dc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[pe]},t[Nc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Ze]},t[Uc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ne]},t[Mc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Qe]},t[Rc]={textureFormat:Ie,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[I]},t[Ic]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Q]},t[Pc]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[N,G]},t[Bc]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[N]},t[gc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[I]},t[dc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Q]},t[Fc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[pe]},t[Sc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ze]},t[Cc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ne]},t[wc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Qe]},t[Lc]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[I]},t[vc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[I]},t[Oc]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[I,Hr]},t[Gc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Q]},t[Vc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[N,G,Ea]},t[zc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[N,G,ha]},t[kc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[N,G]},t[$c]={textureFormat:O,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[N]},t[Wc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[I]},t[Hc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Q]},t[Xc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[pe]},t[Yc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Ze]},t[jc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ne]},t[qc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Qe]},t[Kc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[I]},t[Zc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[I]},t[Qc]={textureFormat:R,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Q]},t[Jc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[I,Wr,Mt]},t[ea]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[I,$r]},t[ta]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Mt]},t[ra]={textureFormat:R,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[N,G]},t[na]={textureFormat:R,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[N]},t[oa]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[I]},t[ca]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Q]},t[aa]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Mt]},t[sa]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[pe]},t[ia]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ze]},t[ua]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Qe]},t[fa]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ne]},t[la]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[pe,ne]},t[ma]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ne]},t[xa]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[N]},t[pa]={textureFormat:dt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ta]},t[ya]={textureFormat:dt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ba]},Object.keys(t).forEach(function(r){let n=t[r];n.bytesPerElementMap={},n.bytesPerElement.forEach(function(o,c){let a=n.type[c];n.bytesPerElementMap[a]=o})}),Lt=t}return Lt[e]}function _a(e,t){let r=Je(e);if(!r)throw"unknown internal format";let n=r.bytesPerElementMap[t];if(n===void 0)throw"unknown internal format";return n}function Ee(e){let t=Je(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function Xr(e){return(e&e-1)===0}function Fa(e,t,r,n){if(!we(e))return Xr(t)&&Xr(r);let o=Je(n);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function Sa(e){let t=Je(e);if(!t)throw"unknown internal format";return t.textureFilterable}function Yr(e,t,r){return xe(t)?We(t):r||I}function et(e,t,r,n,o){if(o%1!==0)throw"can't guess dimensions";if(!r&&!n){let c=Math.sqrt(o/(t===X?6:1));c%1===0?(r=c,n=c):(r=o,n=1)}else if(n){if(!r&&(r=o/n,r%1))throw"can't guess dimensions"}else if(n=o/r,n%1)throw"can't guess dimensions";return{width:r,height:n}}function he(e,t){t.colorspaceConversion!==void 0&&e.pixelStorei(xc,t.colorspaceConversion),t.premultiplyAlpha!==void 0&&e.pixelStorei(yc,t.premultiplyAlpha),t.flipY!==void 0&&e.pixelStorei(pc,t.flipY)}function jr(e){e.pixelStorei(Ut,4),we(e)&&(e.pixelStorei(Or,0),e.pixelStorei(Gr,0),e.pixelStorei(Vr,0),e.pixelStorei(zr,0),e.pixelStorei(kr,0))}function Ca(e,t,r,n){n.minMag&&(r.call(e,t,Dt,n.minMag),r.call(e,t,Nt,n.minMag)),n.min&&r.call(e,t,Dt,n.min),n.mag&&r.call(e,t,Nt,n.mag),n.wrap&&(r.call(e,t,qe,n.wrap),r.call(e,t,Ke,n.wrap),(t===K||Po(e,t))&&r.call(e,t,vr,n.wrap)),n.wrapR&&r.call(e,t,vr,n.wrapR),n.wrapS&&r.call(e,t,qe,n.wrapS),n.wrapT&&r.call(e,t,Ke,n.wrapT),n.minLod&&r.call(e,t,uc,n.minLod),n.maxLod&&r.call(e,t,fc,n.maxLod),n.baseLevel&&r.call(e,t,lc,n.baseLevel),n.maxLevel&&r.call(e,t,mc,n.maxLevel)}function qr(e,t,r){let n=r.target||H;e.bindTexture(n,t),Ca(e,n,e.texParameteri,r)}function wa(e){return e=e||q.textureColor,xe(e)?e:new Uint8Array([e[0]*255,e[1]*255,e[2]*255,e[3]*255])}function vt(e,t,r,n,o,c){r=r||q.textureOptions,c=c||R;let a=r.target||H;if(n=n||r.width,o=o||r.height,e.bindTexture(a,t),Fa(e,n,o,c))e.generateMipmap(a);else{let i=Sa(c)?nc:rc;e.texParameteri(a,Dt,i),e.texParameteri(a,Nt,i),e.texParameteri(a,qe,Ye),e.texParameteri(a,Ke,Ye)}}function Be(e){return e.auto===!0||e.auto===void 0&&e.level===void 0}function Ot(e,t){return t=t||{},t.cubeFaceOrder||[je,oc,cc,ac,sc,ic]}function Gt(e,t){let n=Ot(e,t).map(function(o,c){return{face:o,ndx:c}});return n.sort(function(o,c){return o.face-c.face}),n}function Kr(e,t,r,n){n=n||q.textureOptions;let o=n.target||H,c=n.level||0,a=r.width,i=r.height,s=n.internalFormat||n.format||R,u=Ee(s),m=n.format||u.format,x=n.type||u.type;if(he(e,n),e.bindTexture(o,t),o===X){let f=r.width,p=r.height,l,y;if(f/6===p)l=p,y=[0,0,1,0,2,0,3,0,4,0,5,0];else if(p/6===f)l=f,y=[0,0,0,1,0,2,0,3,0,4,0,5];else if(f/3===p/2)l=f/3,y=[0,0,1,0,2,0,0,1,1,1,2,1];else if(f/2===p/3)l=f/2,y=[0,0,1,0,0,1,1,1,0,2,1,2];else throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);let E=Lr();E?(E.canvas.width=l,E.canvas.height=l,a=l,i=l,Gt(e,n).forEach(function(h){let b=y[h.ndx*2+0]*l,_=y[h.ndx*2+1]*l;E.drawImage(r,b,_,l,l,0,0,l,l),e.texImage2D(h.face,c,s,m,x,E.canvas)}),E.canvas.width=1,E.canvas.height=1):typeof createImageBitmap!="undefined"&&(a=l,i=l,Gt(e,n).forEach(function(h){let b=y[h.ndx*2+0]*l,_=y[h.ndx*2+1]*l;e.texImage2D(h.face,c,s,l,l,0,m,x,null),createImageBitmap(r,b,_,l,l,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(S){he(e,n),e.bindTexture(o,t),e.texImage2D(h.face,c,s,m,x,S),Be(n)&&vt(e,t,n,a,i,s)})}))}else if(o===K||o===Z){let f=Math.min(r.width,r.height),p=Math.max(r.width,r.height),l=p/f;if(l%1!==0)throw"can not compute 3D dimensions of element";let y=r.width===p?1:0,E=r.height===p?1:0;e.pixelStorei(Ut,1),e.pixelStorei(Or,r.width),e.pixelStorei(Gr,0),e.pixelStorei(kr,0),e.texImage3D(o,c,s,f,f,f,0,m,x,null);for(let h=0;h<l;++h){let b=h*f*y,_=h*f*E;e.pixelStorei(Vr,b),e.pixelStorei(zr,_),e.texSubImage3D(o,c,0,0,h,f,f,1,m,x,r)}jr(e)}else e.texImage2D(o,c,s,m,x,r);Be(n)&&vt(e,t,n,a,i,s),qr(e,t,n)}function ge(){}function Ra(e){if(typeof document!="undefined"){let t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}else{let t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}function Ia(e,t){return t===void 0&&!Ra(e)?"anonymous":t}function Pa(e,t,r){r=r||ge;let n;if(t=t!==void 0?t:q.crossOrigin,t=Ia(e,t),typeof Image!="undefined"){n=new Image,t!==void 0&&(n.crossOrigin=t);let o=function(){n.removeEventListener("error",c),n.removeEventListener("load",a),n=null},c=function(){let s="couldn't load image: "+e;hr(s),r(s,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",c),n.addEventListener("load",a),n.src=e,n}else if(typeof ImageBitmap!="undefined"){let o,c,a=function(){r(o,c)},i={};t&&(i.mode="cors"),fetch(e,i).then(function(s){if(!s.ok)throw s;return s.blob()}).then(function(s){return createImageBitmap(s,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(s){c=s,setTimeout(a)}).catch(function(s){o=s,setTimeout(a)}),n=null}return n}function Zr(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof ImageData!="undefined"&&e instanceof ImageData||typeof HTMLElement!="undefined"&&e instanceof HTMLElement}function Vt(e,t,r){return Zr(e)?(setTimeout(function(){r(null,e)}),e):Pa(e,t,r)}function zt(e,t,r){r=r||q.textureOptions;let n=r.target||H;if(e.bindTexture(n,t),r.color===!1)return;let o=wa(r.color);if(n===X)for(let c=0;c<6;++c)e.texImage2D(je+c,0,R,1,1,0,R,I,o);else n===K||n===Z?e.texImage3D(n,0,R,1,1,1,0,R,I,o):e.texImage2D(n,0,R,1,1,0,R,I,o)}function Ba(e,t,r,n){return n=n||ge,r=r||q.textureOptions,zt(e,t,r),r=Object.assign({},r),Vt(r.src,r.crossOrigin,function(c,a){c?n(c,t,a):(Kr(e,t,a,r),n(null,t,a))})}function ga(e,t,r,n){n=n||ge;let o=r.src;if(o.length!==6)throw"there must be 6 urls for a cubemap";let c=r.level||0,a=r.internalFormat||r.format||R,i=Ee(a),s=r.format||i.format,u=r.type||I,m=r.target||H;if(m!==X)throw"target must be TEXTURE_CUBE_MAP";zt(e,t,r),r=Object.assign({},r);let x=6,f=[],p=Ot(e,r),l;function y(E){return function(h,b){--x,h?f.push(h):b.width!==b.height?f.push("cubemap face img is not a square: "+b.src):(he(e,r),e.bindTexture(m,t),x===5?Ot().forEach(function(_){e.texImage2D(_,c,a,s,u,b)}):e.texImage2D(E,c,a,s,u,b),Be(r)&&e.generateMipmap(m)),x===0&&n(f.length?f:void 0,t,l)}}l=o.map(function(E,h){return Vt(E,r.crossOrigin,y(p[h]))})}function da(e,t,r,n){n=n||ge;let o=r.src,c=r.internalFormat||r.format||R,a=Ee(c),i=r.format||a.format,s=r.type||I,u=r.target||Z;if(u!==K&&u!==Z)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";zt(e,t,r),r=Object.assign({},r);let m=o.length,x=[],f,p=r.level||0,l=r.width,y=r.height,E=o.length,h=!0;function b(_){return function(S,T){if(--m,S)x.push(S);else{if(he(e,r),e.bindTexture(u,t),h){h=!1,l=r.width||T.width,y=r.height||T.height,e.texImage3D(u,p,c,l,y,E,0,i,s,null);for(let F=0;F<E;++F)e.texSubImage3D(u,p,0,0,F,l,y,1,i,s,T)}else{let F=T,w;(T.width!==l||T.height!==y)&&(w=Lr(),F=w.canvas,w.canvas.width=l,w.canvas.height=y,w.drawImage(T,0,0,l,y)),e.texSubImage3D(u,p,0,0,_,l,y,1,i,s,F),w&&F===w.canvas&&(w.canvas.width=0,w.canvas.height=0)}Be(r)&&e.generateMipmap(u)}m===0&&n(x.length?x:void 0,t,f)}}f=o.map(function(_,S){return Vt(_,r.crossOrigin,b(S))})}function tt(e,t,r,n){n=n||q.textureOptions;let o=n.target||H;e.bindTexture(o,t);let c=n.width,a=n.height,i=n.depth,s=n.level||0,u=n.internalFormat||n.format||R,m=Ee(u),x=n.format||m.format,f=n.type||Yr(e,r,m.type);if(xe(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{let E=wo(f);r=new E(r)}let p=_a(u,f),l=r.byteLength/p;if(l%1)throw"length wrong size for format: "+It(e,x);let y;if(o===K||o===Z)if(!c&&!a&&!i){let E=Math.cbrt(l);if(E%1!==0)throw"can't guess cube size of array of numElements: "+l;c=E,a=E,i=E}else c&&(!a||!i)?(y=et(e,o,a,i,l/c),a=y.width,i=y.height):a&&(!c||!i)?(y=et(e,o,c,i,l/a),c=y.width,i=y.height):(y=et(e,o,c,a,l/i),c=y.width,a=y.height);else y=et(e,o,c,a,l),c=y.width,a=y.height;if(jr(e),e.pixelStorei(Ut,n.unpackAlignment||1),he(e,n),o===X){let E=p/r.BYTES_PER_ELEMENT,h=l/6*E;Gt(e,n).forEach(b=>{let _=h*b.ndx,S=r.subarray(_,_+h);e.texImage2D(b.face,s,u,c,a,0,x,f,S)})}else o===K||o===Z?e.texImage3D(o,s,u,c,a,i,0,x,f,r):e.texImage2D(o,s,u,c,a,0,x,f,r);return{width:c,height:a,depth:i,type:f}}function Da(e,t,r){let n=r.target||H;e.bindTexture(n,t);let o=r.level||0,c=r.internalFormat||r.format||R,a=Ee(c),i=r.format||a.format,s=r.type||a.type;if(he(e,r),n===X)for(let u=0;u<6;++u)e.texImage2D(je+u,o,c,r.width,r.height,0,i,s,null);else n===K||n===Z?e.texImage3D(n,o,c,r.width,r.height,r.depth,0,i,s,null):e.texImage2D(n,o,c,r.width,r.height,0,i,s,null)}function Y(e,t,r){r=r||ge,t=t||q.textureOptions;let n=e.createTexture(),o=t.target||H,c=t.width||1,a=t.height||1,i=t.internalFormat||R;e.bindTexture(o,n),o===X&&(e.texParameteri(o,qe,Ye),e.texParameteri(o,Ke,Ye));let s=t.src;if(s)if(typeof s=="function"&&(s=s(e,t)),typeof s=="string")Ba(e,n,t,r);else if(xe(s)||Array.isArray(s)&&(typeof s[0]=="number"||Array.isArray(s[0])||xe(s[0]))){let u=tt(e,n,s,t);c=u.width,a=u.height}else Array.isArray(s)&&(typeof s[0]=="string"||Zr(s[0]))?o===X?ga(e,n,t,r):da(e,n,t,r):(Kr(e,n,s,t),c=s.width,a=s.height);else Da(e,n,t);return Be(t)&&vt(e,n,t,c,a,i),qr(e,n,t),n}function Na(e,t,r,n,o,c){n=n||r.width,o=o||r.height,c=c||r.depth;let a=r.target||H;e.bindTexture(a,t);let i=r.level||0,s=r.internalFormat||r.format||R,u=Ee(s),m=r.format||u.format,x,f=r.src;if(f&&(xe(f)||Array.isArray(f)&&typeof f[0]=="number")?x=r.type||Yr(e,f,u.type):x=r.type||u.type,a===X)for(let p=0;p<6;++p)e.texImage2D(je+p,i,s,n,o,0,m,x,null);else a===K||a===Z?e.texImage3D(a,i,s,n,o,c,0,m,x,null):e.texImage2D(a,i,s,n,o,0,m,x,null)}function Jr(e){return typeof document!="undefined"&&document.getElementById?document.getElementById(e):null}function bn(e,t){return A[t].bindPoint}function ys(e,t){return function(r){e.uniform1f(t,r)}}function ps(e,t){return function(r){e.uniform1fv(t,r)}}function Es(e,t){return function(r){e.uniform2fv(t,r)}}function hs(e,t){return function(r){e.uniform3fv(t,r)}}function bs(e,t){return function(r){e.uniform4fv(t,r)}}function Tn(e,t){return function(r){e.uniform1i(t,r)}}function An(e,t){return function(r){e.uniform1iv(t,r)}}function _n(e,t){return function(r){e.uniform2iv(t,r)}}function Fn(e,t){return function(r){e.uniform3iv(t,r)}}function Sn(e,t){return function(r){e.uniform4iv(t,r)}}function Ts(e,t){return function(r){e.uniform1ui(t,r)}}function As(e,t){return function(r){e.uniform1uiv(t,r)}}function _s(e,t){return function(r){e.uniform2uiv(t,r)}}function Fs(e,t){return function(r){e.uniform3uiv(t,r)}}function Ss(e,t){return function(r){e.uniform4uiv(t,r)}}function Cs(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}function ws(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}function Rs(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}function Is(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}function Ps(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}function Bs(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}function gs(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}function ds(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}function Ds(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}function M(e,t,r,n){let o=bn(e,t);return we(e)?function(c){let a,i;He(e,c)?(a=c,i=null):(a=c.texture,i=c.sampler),e.uniform1i(n,r),e.activeTexture(rt+r),e.bindTexture(o,a),e.bindSampler(r,i)}:function(c){e.uniform1i(n,r),e.activeTexture(rt+r),e.bindTexture(o,c)}}function L(e,t,r,n,o){let c=bn(e,t),a=new Int32Array(o);for(let i=0;i<o;++i)a[i]=r+i;return we(e)?function(i){e.uniform1iv(n,a),i.forEach(function(s,u){e.activeTexture(rt+a[u]);let m,x;He(e,s)?(m=s,x=null):(m=s.texture,x=s.sampler),e.bindSampler(r,x),e.bindTexture(c,m)})}:function(i){e.uniform1iv(n,a),i.forEach(function(s,u){e.activeTexture(rt+a[u]),e.bindTexture(c,s)})}}function it(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(nt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||ot,r.normalize||!1,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function ee(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4iv(t,r.value);else throw new Error("The length of an integer constant value must be 4!");else e.bindBuffer(nt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||kt,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function ut(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4uiv(t,r.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else e.bindBuffer(nt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||$t,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function Ht(e,t,r){let n=r.size,o=r.count;return function(c){e.bindBuffer(nt,c.buffer);let a=c.size||c.numComponents||n,i=a/o,s=c.type||ot,m=A[s].size*a,x=c.normalize||!1,f=c.offset||0,p=m/o;for(let l=0;l<o;++l)e.enableVertexAttribArray(t+l),e.vertexAttribPointer(t+l,i,s,x,m,f+p*l),c.divisor!==void 0&&e.vertexAttribDivisor(t+l,c.divisor)}}function Cn(e,t="",r=0){let n=[...t.matchAll(Ns)],o=new Map(n.map((c,a)=>{let i=parseInt(c[1]),s=n[a+1],u=s?s.index:t.length,m=t.substring(c.index,u);return[i-1,m]}));return e.split(`
`).map((c,a)=>{let i=o.get(a);return`${a+1+r}: ${c}${i?`

^^^ ${i}`:""}`}).join(`
`)}function Rn(e,t,r,n){let o=n||Qr,c=e.createShader(r),a=0;if(wn.test(t)&&(a=1,t=t.replace(wn,"")),e.shaderSource(c,t),e.compileShader(c),!e.getShaderParameter(c,Ma)){let s=e.getShaderInfoLog(c);return o(`${Cn(t,s,a)}
Error compiling ${It(e,r)}: ${s}`),e.deleteShader(c),null}return c}function Xt(e,t,r){let n,o;if(typeof t=="function"&&(r=t,t=void 0),typeof e=="function")r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;let a=e;r=a.errorCallback,e=a.attribLocations,n=a.transformFeedbackVaryings,o=a.transformFeedbackMode}let c={errorCallback:r||Qr,transformFeedbackVaryings:n,transformFeedbackMode:o};if(e){let a={};Array.isArray(e)?e.forEach(function(i,s){a[i]=t?t[s]:s}):a=e,c.attribLocations=a}return c}function Us(e,t){if(t.indexOf("frag")>=0)return va;if(t.indexOf("vert")>=0)return Oa}function Pn(e,t){t.forEach(function(r){e.deleteShader(r)})}function Ms(e,t,r,n,o){let c=Xt(r,n,o),a=[],i=[];for(let x=0;x<t.length;++x){let f=t[x];if(typeof f=="string"){let p=Jr(f),l=p?p.text:f,y=e[In[x]];p&&p.type&&(y=Us(e,p.type)||y),f=Rn(e,l,y,c.errorCallback),i.push(f)}Io(e,f)&&a.push(f)}if(a.length!==t.length)return c.errorCallback("not enough shaders for program"),Pn(e,i),null;let s=e.createProgram();a.forEach(function(x){e.attachShader(s,x)}),c.attribLocations&&Object.keys(c.attribLocations).forEach(function(x){e.bindAttribLocation(s,c.attribLocations[x],x)});let u=c.transformFeedbackVaryings;if(u&&(u.attribs&&(u=u.attribs),Array.isArray(u)||(u=Object.keys(u)),e.transformFeedbackVaryings(s,u,c.transformFeedbackMode||Ga)),e.linkProgram(s),!e.getProgramParameter(s,La)){let x=e.getProgramInfoLog(s);return c.errorCallback(`${a.map(f=>{let p=Cn(e.getShaderSource(f),"",0),l=e.getShaderParameter(f,e.SHADER_TYPE);return`${It(e,l)}
${p}}`}).join(`
`)}
Error in program linking: ${x}`),e.deleteProgram(s),Pn(e,i),null}return s}function Ls(e,t,r,n,o){let c=Xt(r,n,o),a=[];for(let i=0;i<t.length;++i){let s=Rn(e,t[i],e[In[i]],c.errorCallback);if(!s)return null;a.push(s)}return Ms(e,a,c)}function Bn(e){let t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function Gs(e,t,r,n){let o=e.split(vs).filter(i=>i!==""),c=0,a="";for(;;){let i=o[c++];a+=i;let s=Os(i[0]),u=s?parseInt(i):i;if(s&&(a+=o[c++]),c===o.length){r[u]=t;break}else{let x=o[c++],f=x==="[",p=r[u]||(f?[]:{});r[u]=p,r=p,n[a]=n[a]||function(l){return function(y){gn(l,y)}}(p),a+=x}}}function Vs(e,t){let r=0;function n(i,s,u){let m=s.name.endsWith("[0]"),x=s.type,f=A[x];if(!f)throw new Error(`unknown type: 0x${x.toString(16)}`);let p;if(f.bindPoint){let l=r;r+=s.size,m?p=f.arraySetter(e,x,l,u,s.size):p=f.setter(e,x,l,u,s.size)}else f.arraySetter&&m?p=f.arraySetter(e,u):p=f.setter(e,u);return p.location=u,p}let o={},c={},a=e.getProgramParameter(t,en);for(let i=0;i<a;++i){let s=e.getActiveUniform(t,i);if(Bn(s))continue;let u=s.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));let m=e.getUniformLocation(t,s.name);if(m){let x=n(t,s,m);o[u]=x,Gs(u,x,c,o)}}return o}function zs(e,t){let r={},n=e.getProgramParameter(t,za);for(let o=0;o<n;++o){let c=e.getTransformFeedbackVarying(t,o);r[c.name]={index:o,type:c.type,size:c.size}}return r}function ks(e,t){let r=e.getProgramParameter(t,en),n=[],o=[];for(let i=0;i<r;++i){o.push(i),n.push({});let s=e.getActiveUniform(t,i);n[i].name=s.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(i){let s=i[0],u=i[1];e.getActiveUniforms(t,o,e[s]).forEach(function(m,x){n[x][u]=m})});let c={},a=e.getProgramParameter(t,ka);for(let i=0;i<a;++i){let s=e.getActiveUniformBlockName(t,i),u={index:e.getUniformBlockIndex(t,s),usedByVertexShader:e.getActiveUniformBlockParameter(t,i,$a),usedByFragmentShader:e.getActiveUniformBlockParameter(t,i,Wa),size:e.getActiveUniformBlockParameter(t,i,Ha),uniformIndices:e.getActiveUniformBlockParameter(t,i,Xa)};u.used=u.usedByVertexShader||u.usedByFragmentShader,c[s]=u}return{blockSpecs:c,uniformData:n}}function gn(e,t){for(let r in t){let n=e[r];typeof n=="function"?n(t[r]):gn(e[r],t[r])}}function de(e,...t){let r=e.uniformSetters||e,n=t.length;for(let o=0;o<n;++o){let c=t[o];if(Array.isArray(c)){let a=c.length;for(let i=0;i<a;++i)de(r,c[i])}else for(let a in c){let i=r[a];i&&i(c[a])}}}function $s(e,t){let r={},n=e.getProgramParameter(t,Va);for(let o=0;o<n;++o){let c=e.getActiveAttrib(t,o);if(Bn(c))continue;let a=e.getAttribLocation(t,c.name),i=B[c.type],s=i.setter(e,a,i);s.location=a,r[c.name]=s}return r}function Ws(e,t){for(let r in t){let n=e[r];n&&n(t[r])}}function ft(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Ws(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(Ua,r.indices))}function Hs(e,t){let r=Vs(e,t),n=$s(e,t),o={program:t,uniformSetters:r,attribSetters:n};return we(e)&&(o.uniformBlockSpec=ks(e,t),o.transformFeedbackInfo=zs(e,t)),o}function lt(e,t,r,n,o){let c=Xt(r,n,o),a=!0;if(t=t.map(function(s){if(s.indexOf(`
`)<0){let u=Jr(s);u?s=u.text:(c.errorCallback("no element with id: "+s),a=!1)}return s}),!a)return null;let i=Ls(e,t,c);return i?Hs(e,i):null}function mt(e,t,r,n,o,c){r=r===void 0?Xs:r;let a=t.indices,i=t.elementType,s=n===void 0?t.numElements:n;o=o===void 0?0:o,i||a?c!==void 0?e.drawElementsInstanced(r,s,i===void 0?dn:t.elementType,o,c):e.drawElements(r,s,i===void 0?dn:t.elementType,o):c!==void 0?e.drawArraysInstanced(r,o,s,c):e.drawArrays(r,o,s)}function ci(e,t){return V[e]||V[t]}function ai(e){return te[e]}function On(e,t,r,n){let o=Dn,c=e.createFramebuffer();e.bindFramebuffer(o,c),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight,t=t||vn;let a=0,i={framebuffer:c,attachments:[],width:r,height:n};return t.forEach(function(s){let u=s.attachment,m=s.format,x=s.attachmentPoint||ci(m,s.internalFormat);if(x||(x=oi+a++),!u)if(ai(m))u=e.createRenderbuffer(),e.bindRenderbuffer(De,u),e.renderbufferStorage(De,m,r,n);else{let f=Object.assign({},s);f.width=r,f.height=n,f.auto===void 0&&(f.auto=!1,f.min=f.min||f.minMag||Kt,f.mag=f.mag||f.minMag||Kt,f.wrapS=f.wrapS||f.wrap||qt,f.wrapT=f.wrapT||f.wrap||qt),u=Y(e,f)}if(br(e,u))e.framebufferRenderbuffer(o,x,De,u);else if(He(e,u))s.layer!==void 0?e.framebufferTextureLayer(o,x,u,s.level||0,s.layer):e.framebufferTexture2D(o,x,s.target||Ys,u,s.level||0);else throw new Error("unknown attachment type");i.attachments.push(u)}),i}function Gn(e,t,r,n,o){n=n||e.drawingBufferWidth,o=o||e.drawingBufferHeight,t.width=n,t.height=o,r=r||vn,r.forEach(function(c,a){let i=t.attachments[a],s=c.format;if(br(e,i))e.bindRenderbuffer(De,i),e.renderbufferStorage(De,s,n,o);else if(He(e,i))Na(e,i,c,n,o);else throw new Error("unknown attachment type")})}function Zt(e,t,r){r=r||Dn,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}function Vn(e,t){t=t||1,t=Math.max(0,t);let r=e.clientWidth*t|0,n=e.clientHeight*t|0;return e.width!==r||e.height!==n?(e.width=r,e.height=n,!0):!1}var Et,pr,bt,Fe,Tt,At,_t,Ft,St,po,Eo,ho,bo,To,Ao,_o,Fo,So,Er,Se,Tr,j,Ar,Bo,go,Do,No,Uo,Mo,Lo,vo,_r,zo,ko,me,tc,Ti,Ai,_i,Fi,Si,Ci,wi,Ri,Ii,Pi,Bi,gi,di,Di,Ni,Ui,Mi,Li,vi,Oi,It,q,xe,Lr,Pt,O,R,Bt,gt,ye,dt,Ye,rc,nc,H,X,K,Z,je,oc,cc,ac,sc,ic,Dt,Nt,qe,Ke,vr,uc,fc,lc,mc,Ut,Or,Gr,Vr,zr,kr,xc,yc,pc,Ec,hc,bc,Tc,Ac,_c,Fc,Sc,Cc,wc,Rc,Ic,Pc,Bc,gc,dc,Dc,Nc,Uc,Mc,Lc,vc,Oc,Gc,Vc,zc,kc,$c,Wc,Hc,Xc,Yc,jc,qc,Kc,Zc,Qc,Jc,ea,ta,ra,na,oa,ca,aa,sa,ia,ua,fa,la,ma,xa,ya,pa,Q,I,Ze,pe,Qe,ne,N,$r,Wr,Hr,G,Re,Mt,Ea,ha,ba,Ta,Ie,oe,Pe,ce,ae,J,Aa,Lt,Qr,rt,nt,Ua,Ma,La,va,Oa,Ga,en,Va,za,ka,$a,Wa,Ha,Xa,ot,tn,rn,nn,kt,on,cn,an,sn,un,fn,ln,mn,xn,yn,Ya,ja,qa,Ka,Za,Qa,Ja,es,ts,rs,ns,os,cs,$t,pn,En,hn,as,ss,is,us,fs,ls,ms,xs,ct,at,Wt,st,A,B,Ns,wn,In,vs,Os,Xs,dn,Dn,De,Ys,js,qs,Ks,Zs,Qs,Js,ei,ti,ri,ni,Nn,Un,Mn,Yt,oi,xt,Ln,jt,qt,Kt,vn,V,te,be=D(()=>{Et=Float32Array;pr=Float32Array;bt=5120,Fe=5121,Tt=5122,At=5123,_t=5124,Ft=5125,St=5126,po=32819,Eo=32820,ho=33635,bo=5131,To=33640,Ao=35899,_o=35902,Fo=36269,So=34042,Er={};{let e=Er;e[bt]=Int8Array,e[Fe]=Uint8Array,e[Tt]=Int16Array,e[At]=Uint16Array,e[_t]=Int32Array,e[Ft]=Uint32Array,e[St]=Float32Array,e[po]=Uint16Array,e[Eo]=Uint16Array,e[ho]=Uint16Array,e[bo]=Uint16Array,e[To]=Uint32Array,e[Ao]=Uint32Array,e[_o]=Uint32Array,e[Fo]=Uint32Array,e[So]=Uint32Array}Se=typeof SharedArrayBuffer!="undefined"?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};Tr=35044,j=34962,Ar=34963,Bo=34660,go=5120,Do=5121,No=5122,Uo=5123,Mo=5124,Lo=5125,vo=5126,_r={attribPrefix:""};zo=/coord|texture/i,ko=/color|colour/i;me=["position","positions","a_position"];tc=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];Ti=$(dr),Ai=k(dr),_i=$(Br),Fi=k(Br),Si=$(Ir),Ci=k(Ir),wi=$(Pr),Ri=k(Pr),Ii=$(Rt),Pi=k(Rt),Bi=$(Rr),gi=k(Rr),di=$(Dr),Di=k(Dr),Ni=$(Nr),Ui=k(Nr),Mi=$(Ur),Li=k(Ur),vi=$(Mr),Oi=k(Mr);It=function(){let e={},t={};function r(n){let o=n.constructor.name;if(!e[o]){for(let c in n)if(typeof n[c]=="number"){let a=t[n[c]];t[n[c]]=a?`${a} | ${c}`:c}e[o]=!0}}return function(o,c){return r(o),t[c]||(typeof c=="number"?`0x${c.toString(16)}`:c)}}(),q={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},xe=Se,Lr=function(){let e;return function(){return e=e||(typeof document!="undefined"&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),Pt=6406,O=6407,R=6408,Bt=6409,gt=6410,ye=6402,dt=34041,Ye=33071,rc=9728,nc=9729,H=3553,X=34067,K=32879,Z=35866,je=34069,oc=34070,cc=34071,ac=34072,sc=34073,ic=34074,Dt=10241,Nt=10240,qe=10242,Ke=10243,vr=32882,uc=33082,fc=33083,lc=33084,mc=33085,Ut=3317,Or=3314,Gr=32878,Vr=3316,zr=3315,kr=32877,xc=37443,yc=37441,pc=37440,Ec=33321,hc=36756,bc=33325,Tc=33326,Ac=33330,_c=33329,Fc=33338,Sc=33337,Cc=33340,wc=33339,Rc=33323,Ic=36757,Pc=33327,Bc=33328,gc=33336,dc=33335,Dc=33332,Nc=33331,Uc=33334,Mc=33333,Lc=32849,vc=35905,Oc=36194,Gc=36758,Vc=35898,zc=35901,kc=34843,$c=34837,Wc=36221,Hc=36239,Xc=36215,Yc=36233,jc=36209,qc=36227,Kc=32856,Zc=35907,Qc=36759,Jc=32855,ea=32854,ta=32857,ra=34842,na=34836,oa=36220,ca=36238,aa=36975,sa=36214,ia=36232,ua=36226,fa=36208,la=33189,ma=33190,xa=36012,ya=36013,pa=35056,Q=5120,I=5121,Ze=5122,pe=5123,Qe=5124,ne=5125,N=5126,$r=32819,Wr=32820,Hr=33635,G=5131,Re=36193,Mt=33640,Ea=35899,ha=35902,ba=36269,Ta=34042,Ie=33319,oe=33320,Pe=6403,ce=36244,ae=36248,J=36249,Aa={};{let e=Aa;e[Pt]={numColorComponents:1},e[Bt]={numColorComponents:1},e[gt]={numColorComponents:2},e[O]={numColorComponents:3},e[R]={numColorComponents:4},e[Pe]={numColorComponents:1},e[ce]={numColorComponents:1},e[Ie]={numColorComponents:2},e[oe]={numColorComponents:2},e[O]={numColorComponents:3},e[ae]={numColorComponents:3},e[R]={numColorComponents:4},e[J]={numColorComponents:4},e[ye]={numColorComponents:1},e[dt]={numColorComponents:2}}Qr=hr;rt=33984,nt=34962,Ua=34963,Ma=35713,La=35714,va=35632,Oa=35633,Ga=35981,en=35718,Va=35721,za=35971,ka=35382,$a=35396,Wa=35398,Ha=35392,Xa=35395,ot=5126,tn=35664,rn=35665,nn=35666,kt=5124,on=35667,cn=35668,an=35669,sn=35670,un=35671,fn=35672,ln=35673,mn=35674,xn=35675,yn=35676,Ya=35678,ja=35680,qa=35679,Ka=35682,Za=35685,Qa=35686,Ja=35687,es=35688,ts=35689,rs=35690,ns=36289,os=36292,cs=36293,$t=5125,pn=36294,En=36295,hn=36296,as=36298,ss=36299,is=36300,us=36303,fs=36306,ls=36307,ms=36308,xs=36311,ct=3553,at=34067,Wt=32879,st=35866,A={};A[ot]={Type:Float32Array,size:4,setter:ys,arraySetter:ps};A[tn]={Type:Float32Array,size:8,setter:Es,cols:2};A[rn]={Type:Float32Array,size:12,setter:hs,cols:3};A[nn]={Type:Float32Array,size:16,setter:bs,cols:4};A[kt]={Type:Int32Array,size:4,setter:Tn,arraySetter:An};A[on]={Type:Int32Array,size:8,setter:_n,cols:2};A[cn]={Type:Int32Array,size:12,setter:Fn,cols:3};A[an]={Type:Int32Array,size:16,setter:Sn,cols:4};A[$t]={Type:Uint32Array,size:4,setter:Ts,arraySetter:As};A[pn]={Type:Uint32Array,size:8,setter:_s,cols:2};A[En]={Type:Uint32Array,size:12,setter:Fs,cols:3};A[hn]={Type:Uint32Array,size:16,setter:Ss,cols:4};A[sn]={Type:Uint32Array,size:4,setter:Tn,arraySetter:An};A[un]={Type:Uint32Array,size:8,setter:_n,cols:2};A[fn]={Type:Uint32Array,size:12,setter:Fn,cols:3};A[ln]={Type:Uint32Array,size:16,setter:Sn,cols:4};A[mn]={Type:Float32Array,size:32,setter:Cs,rows:2,cols:2};A[xn]={Type:Float32Array,size:48,setter:ws,rows:3,cols:3};A[yn]={Type:Float32Array,size:64,setter:Rs,rows:4,cols:4};A[Za]={Type:Float32Array,size:32,setter:Is,rows:2,cols:3};A[Qa]={Type:Float32Array,size:32,setter:Bs,rows:2,cols:4};A[Ja]={Type:Float32Array,size:48,setter:Ps,rows:3,cols:2};A[es]={Type:Float32Array,size:48,setter:ds,rows:3,cols:4};A[ts]={Type:Float32Array,size:64,setter:gs,rows:4,cols:2};A[rs]={Type:Float32Array,size:64,setter:Ds,rows:4,cols:3};A[Ya]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:ct};A[ja]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:at};A[qa]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:Wt};A[Ka]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:ct};A[ns]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:st};A[os]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:st};A[cs]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:at};A[as]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:ct};A[ss]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:Wt};A[is]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:at};A[us]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:st};A[fs]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:ct};A[ls]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:Wt};A[ms]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:at};A[xs]={Type:null,size:0,setter:M,arraySetter:L,bindPoint:st};B={};B[ot]={size:4,setter:it};B[tn]={size:8,setter:it};B[rn]={size:12,setter:it};B[nn]={size:16,setter:it};B[kt]={size:4,setter:ee};B[on]={size:8,setter:ee};B[cn]={size:12,setter:ee};B[an]={size:16,setter:ee};B[$t]={size:4,setter:ut};B[pn]={size:8,setter:ut};B[En]={size:12,setter:ut};B[hn]={size:16,setter:ut};B[sn]={size:4,setter:ee};B[un]={size:8,setter:ee};B[fn]={size:12,setter:ee};B[ln]={size:16,setter:ee};B[mn]={size:4,setter:Ht,count:2};B[xn]={size:9,setter:Ht,count:3};B[yn]={size:16,setter:Ht,count:4};Ns=/ERROR:\s*\d+:(\d+)/gi;wn=/^[ \t]*\n/;In=["VERTEX_SHADER","FRAGMENT_SHADER"];vs=/(\.|\[|]|\w+)/g,Os=e=>e>="0"&&e<="9";Xs=4,dn=5123;Dn=36160,De=36161,Ys=3553,js=5121,qs=6402,Ks=6408,Zs=33190,Qs=36012,Js=35056,ei=36013,ti=32854,ri=32855,ni=36194,Nn=33189,Un=6401,Mn=36168,Yt=34041,oi=36064,xt=36096,Ln=36128,jt=33306,qt=33071,Kt=9729,vn=[{format:Ks,type:js,min:Kt,wrap:qt},{format:Yt}],V={};V[Yt]=jt;V[Un]=Ln;V[Mn]=Ln;V[qs]=xt;V[Nn]=xt;V[Zs]=xt;V[Qs]=xt;V[Js]=jt;V[ei]=jt;te={};te[ti]=!0;te[ri]=!0;te[ni]=!0;te[Yt]=!0;te[Nn]=!0;te[Un]=!0;te[Mn]=!0});var kn,zn=D(()=>{kn=`precision mediump float;

attribute vec2 position;
attribute vec2 texCoord;

varying vec2 v_texCoord;

void main() {
  v_texCoord = texCoord;
  gl_Position = vec4(position, 0.0, 1.0);
}
`});var Wn,$n=D(()=>{Wn=`
precision mediump float;

varying vec2 v_texCoord;

// Colors used for rendering
uniform sampler2D narrowFont;
uniform sampler2D squareFont;
uniform sampler2D palette;

// Tables used for lookups
uniform sampler2D charsTexture;
uniform sampler2D backgroundColorTable;
uniform sampler2D foregroundColorTable;

uniform vec2 fontTileCount;
uniform vec2 screenTileCount;

void main() {
  vec4 charSample = texture2D(charsTexture, v_texCoord);
  vec2 char = (charSample.xy * 255.0);

  vec2 bgColLoc = texture2D(backgroundColorTable, v_texCoord).xy * 255.0;
  vec4 backgroundColor = texture2D(palette, (bgColLoc + 0.5) / 16.0);
  vec2 fgColLoc = texture2D(foregroundColorTable, v_texCoord).xy * 255.0;
  vec4 foregroundColor = texture2D(palette, (fgColLoc + 0.5) / 16.0);

  bool doubleWidth = charSample.z > 0.5;

  vec2 fontTileCountScaled = doubleWidth
    ? vec2(fontTileCount.x * 2.0, fontTileCount.y)
    : fontTileCount;
  vec2 spriteSize = 1.0 / fontTileCountScaled;
  vec2 fontTextureStartOffset = char * spriteSize;

  vec2 spriteOffset = vec2(
    mod((v_texCoord.x * screenTileCount.x), 1.0),
    mod((v_texCoord.y * screenTileCount.y), 1.0)
  ) * spriteSize;

  vec2 fontTextureOffset = fontTextureStartOffset + spriteOffset;

  vec4 fontCol = doubleWidth
    ? texture2D(squareFont, fontTextureOffset)
    //? vec4(spriteOffset / spriteSize, 0.0, 1.0)
    : texture2D(narrowFont, fontTextureOffset);

  //gl_FragColor = vec4(v_texCoord.x, 0.0, v_texCoord.y, 1.0);
  fontCol = fontCol * foregroundColor;
  gl_FragColor = vec4(mix(backgroundColor.rgb, fontCol.rgb, fontCol.a), 1.0);
}
`});var Qt,Hn=D(()=>{Qt=class{constructor(t){this.data=new Float32Array(t),this.offset=0}push(t){this.data[this.offset]=t,this.offset+=1}push2(t,r){this.push(t),this.push(r)}}});function Te(e,t,r,n){let o=new Qt(12);return o.push2(e,t),o.push2(r,n),o.push2(e,n),o.push2(e,t),o.push2(r,t),o.push2(r,n),o.data}var Jt=D(()=>{Hn()});var er,Xn=D(()=>{be();zn();$n();Jt();er=class{constructor(t){let r={position:{numComponents:2,data:Te(-1,1,1,-1)},texCoord:{numComponents:2,data:Te(0,0,1,1)}},n=lt(t,[kn,Wn]),o=Ce(t,r);this.state={gl:t,programInfo:n,bufferInfo:o}}render(t){let{gl:r}=this.state;r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),r.useProgram(this.state.programInfo.program),ft(r,this.state.programInfo,this.state.bufferInfo),de(this.state.programInfo,{narrowFont:t.narrowFont,squareFont:t.squareFont,charsTexture:t.charsTable,palette:t.palette,backgroundColorTable:t.backgroundColorTable,foregroundColorTable:t.foregroundColorTable,fontTileCount:[16,16],screenTileCount:[t.cols,t.rows]}),mt(r,this.state.bufferInfo)}}});var jn,Yn=D(()=>{jn=`precision mediump float;

attribute vec2 position;
attribute vec2 texCoord;

varying vec2 v_texCoord;

uniform vec2 scale;

void main() {
  v_texCoord = texCoord;
  gl_Position = vec4(position * scale, 0.0, 1.0);
}
`});var Kn,qn=D(()=>{Kn=`precision mediump float;

varying vec2 v_texCoord;

uniform sampler2D virtualScreen;
uniform vec2 virtualScreenSize;
uniform sampler2D scanlineTexture;

void main() {
  vec4 col = texture2D(virtualScreen, v_texCoord);

  // Grab a pixel to the left for some bleed
  vec2 left = vec2(-1.0 / virtualScreenSize.x, 0.0);
  vec4 bleedCol = texture2D(virtualScreen, v_texCoord + left);
  vec4 bleedCol2 = texture2D(virtualScreen, v_texCoord + left + left);

  vec4 scanline = texture2D(scanlineTexture, v_texCoord * virtualScreenSize);

  gl_FragColor = (col * 0.6 + bleedCol * 0.2 + bleedCol2 * 0.2) * scanline;
}
`});var Qn,Zn=D(()=>{Qn=`precision mediump float;

varying vec2 v_texCoord;

uniform sampler2D virtualScreen;

void main() {
  vec4 col = texture2D(virtualScreen, v_texCoord);

  gl_FragColor = col;
}
`});var tr,Jn=D(()=>{be();Yn();qn();Zn();Jt();tr=class{constructor(t,r){let n={position:{numComponents:2,data:Te(-1,-1,1,1)},texCoord:{numComponents:2,data:Te(0,0,1,1)}},o=lt(t,[jn,r?Kn:Qn]),c=Ce(t,n),a=Y(t,{src:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,90,90,90,255]),width:1,height:4});this.state={gl:t,programInfo:o,bufferInfo:c,scanlineTexture:a}}render(t,r,n){let{gl:o}=this.state;o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.enable(o.BLEND);let c=[r.x/o.canvas.width,r.y/o.canvas.height];o.useProgram(this.state.programInfo.program),ft(o,this.state.programInfo,this.state.bufferInfo),de(this.state.programInfo,{virtualScreen:t,virtualScreenSize:[n.x,n.y],scale:c,scanlineTexture:this.state.scanlineTexture}),mt(o,this.state.bufferInfo)}}});var pt,eo=D(()=>{(t=>{function e(r,n){return{x:r.x*n,y:r.y*n}}t.scalarMult=e})(pt||(pt={}))});var Ne,to=D(()=>{be();Ne=class{constructor(t){this.setCell=(t,r,n,o)=>{this.backingData[t*4]=r,this.backingData[t*4+1]=n,this.backingData[t*4+2]=o?255:0};this.gl=t,this.backingData=new Uint8Array(4);let r={src:this.backingData,width:1,height:1,format:t.RGBA,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE};this.texture=Y(t,r)}updateWithColorData(t,r,n){let{gl:o,texture:c}=this,a=0,i=t*r;for(this.backingData.length<i*4&&(this.backingData=new Uint8Array(i*4));a<i;){let s=n.getUint8(a),u=s%16,m=Math.floor(s/16);this.setCell(a,u,m,!1),a+=1}tt(o,c,this.backingData,{min:o.NEAREST,mag:o.NEAREST,width:t,height:r,wrap:o.CLAMP_TO_EDGE})}updateWithCharData(t,r,n){let{gl:o,texture:c}=this,a=0,i=t*r;for(this.backingData.length<i*4&&(this.backingData=new Uint8Array(i*4));a<i;){let s=n.getUint8(a),u=s%16,m=Math.floor(s/16);if(s!==255)this.setCell(a,u,m,!1);else{if(a+1>=i)return;let x=n.getUint8(a+1),f=x%16,p=Math.floor(x/16);this.setCell(a,f*2,p,!0),this.setCell(a+1,f*2+1,p,!0),a+=1}a+=1}tt(o,c,this.backingData,{min:o.NEAREST,mag:o.NEAREST,width:t,height:r,wrap:o.CLAMP_TO_EDGE})}}});var ro,rr,no=D(()=>{Xn();be();Jn();eo();to();ro=[{min:WebGLRenderingContext.NEAREST,mag:WebGLRenderingContext.NEAREST}],rr=class{constructor(t,r,n,o){let c=t.getContext("webgl");if(c==null)throw new Error("Could not start webgl");let a=Y(c,{src:r.narrow,min:c.NEAREST,mag:c.NEAREST}),i=Y(c,{src:r.square,min:c.NEAREST,mag:c.NEAREST}),s=Y(c,{src:n,min:c.NEAREST,mag:c.NEAREST}),u=On(c,ro,1,1);this.state={gl:c,fontSpriteProgram:new er(c),virtualScreenProgram:new tr(c,o),charsTable:new Ne(c),bgColorTable:new Ne(c),fgColorTable:new Ne(c),narrowFontTexture:a,squareFontTexture:i,virtualScreen:u,palette:s}}clear(){let{gl:t}=this.state;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}useVirtualScreen(){Zt(this.state.gl,this.state.virtualScreen),this.clear()}useRealScreen(){let{gl:t}=this.state;Zt(t,null),t.viewport(0,0,t.canvas.width,t.canvas.height),this.clear()}render(t,r,n){let{gl:o}=this.state;(this.state.virtualScreen.width!=t.x||this.state.virtualScreen.height!=t.y)&&Gn(o,this.state.virtualScreen,ro,t.x,t.y),this.useVirtualScreen(),o.viewport(0,0,t.x,t.y),this.state.fontSpriteProgram.render({rows:r,cols:n,narrowFont:this.state.narrowFontTexture,squareFont:this.state.squareFontTexture,palette:this.state.palette,charsTable:this.state.charsTable.texture,backgroundColorTable:this.state.bgColorTable.texture,foregroundColorTable:this.state.fgColorTable.texture}),this.useRealScreen();let c=o.canvas.width/this.state.virtualScreen.width,a=o.canvas.height/this.state.virtualScreen.height,i=Math.floor(Math.max(1,Math.min(c,a)));this.state.virtualScreenProgram.render(this.state.virtualScreen.attachments[0],pt.scalarMult(t,i),t)}}});var nr,oo=D(()=>{nr={ArrowLeft:1,ArrowDown:2,ArrowUp:3,ArrowRight:4,Enter:5,Backspace:6,Delete:7,Space:8,Tab:9,PageUp:10,PageDown:11,Home:12,End:13,Escape:14,Shift:15,Alt:16,Control:17,Meta:18,F1:19,F2:20,F3:21,F4:22,F5:23,F6:24,F7:25,F8:26,F9:27,F10:28,F11:29,F12:30," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126}});var yi=ao(co=>{yr();no();be();oo();var Ue=document.getElementById("canvas");fetch("./manifest.json").then(e=>e.json()).then(e=>xi(e));var mi=(e,t)=>{let r=Math.floor(e.width/window.devicePixelRatio/t.width),n=Math.floor(e.height/window.devicePixelRatio/t.height);return{columns:r,rows:n}},xi=e=>ze(co,null,function*(){if(e.manifestVersion==null)throw console.log(e),new Error("Manifest version not specified");if(e.manifestVersion>1)throw console.log(e),new Error("Only manifest version 1 is currently supported");let t=new rr(Ue,e.fonts,e.palette,e.postProcessing!==!1),r=yield _e.load(e.program),n=!1;document.addEventListener("keydown",i=>{let s=nr[i.key];s!=null&&r.setInput(s,1)}),document.addEventListener("keyup",i=>{let s=nr[i.key];s!=null&&r.setInput(s,0)});let o=0,c,a=i=>{if(n){requestAnimationFrame(a);return}let s;c==null||i==null?s=.016:s=(i-c)/1e3,c=i,r.tick(s);let u=!1;if(o%10===0){u=Vn(Ue,window.devicePixelRatio||1);let y=mi(Ue,e.fonts.gridSize);r.config.max_cols=y.columns,r.config.max_rows=y.rows}let m=r.config,x=r.screen,f=r.bgColors,p=r.fgColors;p.update&&t.state.fgColorTable.updateWithColorData(m.cols,m.rows,p.cells),f.update&&t.state.bgColorTable.updateWithColorData(m.cols,m.rows,f.cells),x.update&&t.state.charsTable.updateWithCharData(m.cols,m.rows,x.cells);let l={x:m.cols*e.fonts.gridSize.width,y:m.rows*e.fonts.gridSize.height};(x.update||f.update||p.update||u)&&(t.render(l,m.rows,m.cols),t.state.gl.finish(),p.update=!1,f.update=!1,x.update=!1),o+=1,requestAnimationFrame(a)};a(),Ue.addEventListener("dblclick",()=>{Ue.requestFullscreen()})})});yi();})();
/* @license twgl.js 4.21.2 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
