(()=>{var L=(e,t)=>()=>(e&&(t=e(e=0)),t);var to=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ge=(e,t,r)=>new Promise((n,o)=>{var c=s=>{try{i(r.next(s))}catch(u){o(u)}},a=s=>{try{i(r.throw(s))}catch(u){o(u)}},i=s=>s.done?n(s.value):Promise.resolve(s.value).then(c,a);i((r=r.apply(e,t)).next())});var Ve,ar,sr,ro,ir,ur,no,Ae,ze,fr=L(()=>{Ve=e=>typeof e=="number"?e:e.value,ar=0,sr=ar+256,ro=sr+256,ir=ro+2560,ur=ir+65536,no=ur+65536,Ae=class{constructor(t){this.state=t,this.appStateAddr=this.state.exports.init(this.osAddr)}static load(t){return Ge(this,null,function*(){let r={env:{prn:(c,a)=>{let i=n.exports,s=new Uint8ClampedArray(i.memory.buffer,c,a),u=new TextDecoder("utf8");console.info(u.decode(s))}}},n;if(WebAssembly.instantiateStreaming!=null)n=(yield WebAssembly.instantiateStreaming(fetch(t),r)).instance;else{let c=yield fetch(t);n=(yield WebAssembly.instantiate(yield c.arrayBuffer(),r)).instance}let o=n.exports;return console.log("exports",Object.keys(o)),new Ae({instance:n,exports:o})})}get osAddr(){return Ve(this.state.exports.OS)}tick(t){this.state.exports.frame(this.osAddr,this.appStateAddr,t)}setInput(t,r){let n=Ve(this.state.exports.OS)+sr;new DataView(this.state.exports.memory.buffer,n).setUint8(t,r)}get config(){let t=new DataView(this.state.exports.memory.buffer,Ve(this.state.exports.OS)+ar,2);return{cols:t.getUint8(0),rows:t.getUint8(1)}}get screen(){return new ze(this.state.exports.OS,ir,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}get bgColors(){return new ze(this.state.exports.OS,ur,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}get fgColors(){return new ze(this.state.exports.OS,no,this.state.exports.memory.buffer,this.config.cols,this.config.rows)}},ze=class{constructor(t,r,n,o,c){let a=Ve(t)+r;this.updateView=new DataView(n,a,1),this.cells=new DataView(n,a+1,c*o)}get update(){return this.updateView.getUint8(0)>0}set update(t){this.updateView.setUint8(0,t?1:0)}}});function Et(e,t,r){let n=new pt(3);return e&&(n[0]=e),t&&(n[1]=t),r&&(n[2]=r),n}function oo(e,t,r){return r=r||new pt(3),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function co(e,t,r){return r=r||new pt(3),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function ao(e){return e=e||new lr(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function so(e,t){t=t||new lr(16);let r=e[0*4+0],n=e[0*4+1],o=e[0*4+2],c=e[0*4+3],a=e[1*4+0],i=e[1*4+1],s=e[1*4+2],u=e[1*4+3],m=e[2*4+0],x=e[2*4+1],f=e[2*4+2],y=e[2*4+3],l=e[3*4+0],p=e[3*4+1],E=e[3*4+2],b=e[3*4+3],h=f*b,_=E*y,S=s*b,T=E*u,F=s*y,w=f*u,P=o*b,g=E*c,N=o*y,v=f*c,W=o*u,z=s*c,re=m*p,se=l*x,ie=a*p,ue=l*i,fe=a*x,le=m*i,Ne=r*p,Ue=l*n,Me=r*x,ve=m*n,Le=r*i,Oe=a*n,rr=h*i+T*x+F*p-(_*i+S*x+w*p),nr=_*n+P*x+v*p-(h*n+g*x+N*p),or=S*n+g*i+W*p-(T*n+P*i+z*p),cr=w*n+N*i+z*x-(F*n+v*i+W*x),D=1/(r*rr+a*nr+m*or+l*cr);return t[0]=D*rr,t[1]=D*nr,t[2]=D*or,t[3]=D*cr,t[4]=D*(_*a+S*m+w*l-(h*a+T*m+F*l)),t[5]=D*(h*r+g*m+N*l-(_*r+P*m+v*l)),t[6]=D*(T*r+P*a+z*l-(S*r+g*a+W*l)),t[7]=D*(F*r+v*a+W*m-(w*r+N*a+z*m)),t[8]=D*(re*u+ue*y+fe*b-(se*u+ie*y+le*b)),t[9]=D*(se*c+Ne*y+ve*b-(re*c+Ue*y+Me*b)),t[10]=D*(ie*c+Ue*u+Le*b-(ue*c+Ne*u+Oe*b)),t[11]=D*(le*c+Me*u+Oe*y-(fe*c+ve*u+Le*y)),t[12]=D*(ie*f+le*E+se*s-(fe*E+re*s+ue*f)),t[13]=D*(Me*E+re*o+Ue*f-(Ne*f+ve*E+se*o)),t[14]=D*(Ne*s+Oe*E+ue*o-(Le*E+ie*o+Ue*s)),t[15]=D*(Le*f+fe*o+ve*s-(Me*s+Oe*f+le*o)),t}function io(e,t,r){r=r||Et();let n=t[0],o=t[1],c=t[2],a=n*e[0*4+3]+o*e[1*4+3]+c*e[2*4+3]+e[3*4+3];return r[0]=(n*e[0*4+0]+o*e[1*4+0]+c*e[2*4+0]+e[3*4+0])/a,r[1]=(n*e[0*4+1]+o*e[1*4+1]+c*e[2*4+1]+e[3*4+1])/a,r[2]=(n*e[0*4+2]+o*e[1*4+2]+c*e[2*4+2]+e[3*4+2])/a,r}function uo(e,t,r){r=r||Et();let n=t[0],o=t[1],c=t[2];return r[0]=n*e[0*4+0]+o*e[1*4+0]+c*e[2*4+0],r[1]=n*e[0*4+1]+o*e[1*4+1]+c*e[2*4+1],r[2]=n*e[0*4+2]+o*e[1*4+2]+c*e[2*4+2],r}function ke(e){if(e instanceof Int8Array)return bt;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return _e;if(e instanceof Int16Array)return ht;if(e instanceof Uint16Array)return Tt;if(e instanceof Int32Array)return At;if(e instanceof Uint32Array)return _t;if(e instanceof Float32Array)return Ft;throw new Error("unsupported typed array type")}function To(e){if(e===Int8Array)return bt;if(e===Uint8Array||e===Uint8ClampedArray)return _e;if(e===Int16Array)return ht;if(e===Uint16Array)return Tt;if(e===Int32Array)return At;if(e===Uint32Array)return _t;if(e===Float32Array)return Ft;throw new Error("unsupported typed array type")}function Ao(e){let t=mr[e];if(!t)throw new Error("unknown gl type");return t}function xr(...e){console.error(...e)}function _o(e,t){return typeof WebGLBuffer!="undefined"&&t instanceof WebGLBuffer}function yr(e,t){return typeof WebGLRenderbuffer!="undefined"&&t instanceof WebGLRenderbuffer}function Fo(e,t){return typeof WebGLShader!="undefined"&&t instanceof WebGLShader}function $e(e,t){return typeof WebGLTexture!="undefined"&&t instanceof WebGLTexture}function So(e,t){return typeof WebGLSampler!="undefined"&&t instanceof WebGLSampler}function No(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||pr)}function St(e,t,r,n){if(_o(e,t))return t;r=r||j;let o=e.createBuffer();return No(e,r,o,t,n),o}function hr(e){return e==="indices"}function Uo(e){return e instanceof Int8Array||e instanceof Uint8Array}function Mo(e){return e===Int8Array||e===Uint8Array}function Tr(e){return e.length?e:e.data}function Ar(e,t){let r;if(vo.test(e)?r=2:Lo.test(e)?r=4:r=3,t%r>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function _r(e,t){return e.numComponents||e.size||Ar(t,Tr(e).length)}function We(e,t){if(Fe(e))return e;if(Fe(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(hr(t)?r=Uint16Array:r=Float32Array),new r(e.data)}function Oo(e,t){let r={};return Object.keys(t).forEach(function(n){if(!hr(n)){let o=t[n],c=o.attrib||o.name||o.attribName||br.attribPrefix+n;if(o.value){if(!Array.isArray(o.value)&&!Fe(o.value))throw new Error("array.value is not array or typedarray");r[c]={value:o.value}}else{let a,i,s,u;if(o.buffer&&o.buffer instanceof WebGLBuffer)a=o.buffer,u=o.numComponents||o.size,i=o.type,s=o.normalize;else if(typeof o=="number"||typeof o.data=="number"){let m=o.data||o,x=o.type||Float32Array,f=m*x.BYTES_PER_ELEMENT;i=To(x),s=o.normalize!==void 0?o.normalize:Mo(x),u=o.numComponents||o.size||Ar(n,m),a=e.createBuffer(),e.bindBuffer(j,a),e.bufferData(j,f,o.drawType||pr)}else{let m=We(o,n);a=St(e,m,void 0,o.drawType),i=ke(m),s=o.normalize!==void 0?o.normalize:Uo(m),u=_r(o,n)}r[c]={buffer:a,numComponents:u,type:i,normalize:s,stride:o.stride||0,offset:o.offset||0,divisor:o.divisor===void 0?void 0:o.divisor,drawType:o.drawType}}}}),e.bindBuffer(j,null),r}function Go(e,t){return t===wo||t===Ro?1:t===Io||t===Po?2:t===Bo||t===go||t===Do?4:0}function Vo(e){let t,r;for(r=0;r<me.length&&(t=me[r],!(t in e));++r);r===me.length&&(t=Object.keys(e)[0]);let n=e[t],o=Tr(n).length,c=_r(n,t),a=o/c;if(o%c>0)throw new Error(`numComponents ${c} not correct for length ${o}`);return a}function zo(e,t){let r,n;for(n=0;n<me.length&&(r=me[n],!(r in t||(r=br.attribPrefix+r,r in t)));++n);n===me.length&&(r=Object.keys(t)[0]);let o=t[r];e.bindBuffer(j,o.buffer);let c=e.getBufferParameter(j,Co);e.bindBuffer(j,null);let a=Go(e,o.type),i=c/a,s=o.numComponents||o.size,u=i/s;if(u%1!==0)throw new Error(`numComponents ${s} not correct for length ${length}`);return u}function Se(e,t,r){let n=Oo(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);let c=t.indices;if(c){let a=We(c,"indices");o.indices=St(e,a,Er),o.numElements=a.length,o.elementType=ke(a)}else o.numElements||(o.numElements=zo(e,o.attribs));return o}function ko(e,t,r){let n=r==="indices"?Er:j,o=We(t,r);return St(e,o,n)}function $o(e,t){let r={};return Object.keys(t).forEach(function(n){r[n]=ko(e,t[n],n)}),t.indices?(r.numElements=t.indices.length,r.elementType=ke(We(t.indices))):r.numElements=Vo(t),r}function Wo(e,t){let r=0;return e.push=function(){for(let n=0;n<arguments.length;++n){let o=arguments[n];if(o instanceof Array||Fe(o))for(let c=0;c<o.length;++c)e[r++]=o[c];else e[r++]=o}},e.reset=function(n){r=n||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function C(e,t,r){let n=r||Float32Array;return Wo(new n(e*t),e)}function Ct(e,t,r){let n=e.length,o=new Float32Array(3);for(let c=0;c<n;c+=3)r(t,[e[c],e[c+1],e[c+2]],o),e[c]=o[0],e[c+1]=o[1],e[c+2]=o[2]}function Ho(e,t,r){r=r||Et();let n=t[0],o=t[1],c=t[2];return r[0]=n*e[0*4+0]+o*e[0*4+1]+c*e[0*4+2],r[1]=n*e[1*4+0]+o*e[1*4+1]+c*e[1*4+2],r[2]=n*e[2*4+0]+o*e[2*4+1]+c*e[2*4+2],r}function Xo(e,t){return Ct(e,t,uo),e}function Yo(e,t){return Ct(e,so(t),Ho),e}function jo(e,t){return Ct(e,t,io),e}function qo(e,t){return Object.keys(e).forEach(function(r){let n=e[r];r.indexOf("pos")>=0?jo(n,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?Xo(n,t):r.indexOf("norm")>=0&&Yo(n,t)}),e}function Fr(e,t,r){return e=e||2,t=t||0,r=r||0,e*=.5,{position:{numComponents:2,data:[t+-1*e,r+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function Sr(e,t,r,n,o){e=e||1,t=t||1,r=r||1,n=n||1,o=o||ao();let c=(r+1)*(n+1),a=C(3,c),i=C(3,c),s=C(2,c);for(let f=0;f<=n;f++)for(let y=0;y<=r;y++){let l=y/r,p=f/n;a.push(e*l-e*.5,0,t*p-t*.5),i.push(0,1,0),s.push(l,p)}let u=r+1,m=C(3,r*n*2,Uint16Array);for(let f=0;f<n;f++)for(let y=0;y<r;y++)m.push((f+0)*u+y,(f+1)*u+y,(f+0)*u+y+1),m.push((f+1)*u+y,(f+1)*u+y+1,(f+0)*u+y+1);return qo({position:a,normal:i,texcoord:s,indices:m},o)}function Cr(e,t,r,n,o,c,a){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");n=n||0,o=o||Math.PI,c=c||0,a=a||Math.PI*2;let i=o-n,s=a-c,u=(t+1)*(r+1),m=C(3,u),x=C(3,u),f=C(2,u);for(let p=0;p<=r;p++)for(let E=0;E<=t;E++){let b=E/t,h=p/r,_=s*b+c,S=i*h+n,T=Math.sin(_),F=Math.cos(_),w=Math.sin(S),P=Math.cos(S),g=F*w,N=P,v=T*w;m.push(e*g,e*N,e*v),x.push(g,N,v),f.push(1-b,h)}let y=t+1,l=C(3,t*r*2,Uint16Array);for(let p=0;p<t;p++)for(let E=0;E<r;E++)l.push((E+0)*y+p,(E+0)*y+p+1,(E+1)*y+p),l.push((E+1)*y+p,(E+0)*y+p+1,(E+1)*y+p+1);return{position:m,normal:x,texcoord:f,indices:l}}function wr(e){e=e||1;let t=e/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],c=6*4,a=C(3,c),i=C(3,c),s=C(2,c),u=C(3,6*2,Uint16Array);for(let m=0;m<6;++m){let x=Ko[m];for(let y=0;y<4;++y){let l=r[x[y]],p=n[m],E=o[y];a.push(l),i.push(p),s.push(E)}let f=4*m;u.push(f+0,f+1,f+2),u.push(f+0,f+2,f+3)}return{position:a,normal:i,texcoord:s,indices:u}}function wt(e,t,r,n,o,c,a){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");let i=c===void 0?!0:c,s=a===void 0?!0:a,u=(i?2:0)+(s?2:0),m=(n+1)*(o+1+u),x=C(3,m),f=C(3,m),y=C(2,m),l=C(3,n*(o+u/2)*2,Uint16Array),p=n+1,E=Math.atan2(e-t,r),b=Math.cos(E),h=Math.sin(E),_=i?-2:0,S=o+(s?2:0);for(let T=_;T<=S;++T){let F=T/o,w=r*F,P;T<0?(w=0,F=1,P=e):T>o?(w=r,F=1,P=t):P=e+(t-e)*(T/o),(T===-2||T===o+2)&&(P=0,F=0),w-=r/2;for(let g=0;g<p;++g){let N=Math.sin(g*Math.PI*2/n),v=Math.cos(g*Math.PI*2/n);x.push(N*P,w,v*P),T<0?f.push(0,-1,0):T>o?f.push(0,1,0):P===0?f.push(0,0,0):f.push(N*b,h,v*b),y.push(g/n,1-F)}}for(let T=0;T<o+u;++T)if(!(T===1&&i||T===o+u-2&&s))for(let F=0;F<n;++F)l.push(p*(T+0)+0+F,p*(T+0)+1+F,p*(T+1)+1+F),l.push(p*(T+0)+0+F,p*(T+1)+1+F,p*(T+1)+0+F);return{position:x,normal:f,texcoord:y,indices:l}}function Rr(e,t){t=t||[];let r=[];for(let n=0;n<e.length;n+=4){let o=e[n],c=e.slice(n+1,n+4);c.push.apply(c,t);for(let a=0;a<o;++a)r.push.apply(r,c)}return r}function Ir(){let e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0],r=Rr([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=Rr([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),o=e.length/3,c={position:C(3,o),texcoord:C(2,o),normal:C(3,o),color:C(4,o,Uint8Array),indices:C(3,o/3,Uint16Array)};c.position.push(e),c.texcoord.push(t),c.normal.push(r),c.color.push(n);for(let a=0;a<o;++a)c.indices.push(a);return c}function Pr(e,t,r,n,o,c,a){if(o<=0)throw new Error("subdivisionDown must be > 0");c=c||0,a=a||1;let i=2,s=a-c,u=(o+1)*2*(2+i),m=C(3,u),x=C(3,u),f=C(2,u);function y(h,_,S){return h+(_-h)*S}function l(h,_,S,T,F,w){for(let P=0;P<=o;P++){let g=_/(i-1),N=P/o,v=(g-.5)*2,W=(c+N*s)*Math.PI,z=Math.sin(W),re=Math.cos(W),se=y(e,h,z),ie=v*n,ue=re*e,fe=z*se;m.push(ie,ue,fe);let le=oo(co([0,z,re],S),T);x.push(le),f.push(g*F+w,N)}}for(let h=0;h<i;h++){let _=(h/(i-1)-.5)*2;l(t,h,[1,1,1],[0,0,0],1,0),l(t,h,[0,0,0],[_,0,0],0,0),l(r,h,[1,1,1],[0,0,0],1,0),l(r,h,[0,0,0],[_,0,0],0,1)}let p=C(3,o*2*(2+i),Uint16Array);function E(h,_){for(let S=0;S<o;++S)p.push(h+S+0,h+S+1,_+S+0),p.push(h+S+1,_+S+1,_+S+0)}let b=o+1;return E(b*0,b*4),E(b*5,b*7),E(b*6,b*2),E(b*3,b*1),{position:m,normal:x,texcoord:f,indices:p}}function Br(e,t,r,n,o,c){return wt(e,e,t,r,n,o,c)}function gr(e,t,r,n,o,c){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0,c=c||Math.PI*2;let a=c-o,i=r+1,s=n+1,u=i*s,m=C(3,u),x=C(3,u),f=C(2,u),y=C(3,r*n*2,Uint16Array);for(let l=0;l<s;++l){let p=l/n,E=p*Math.PI*2,b=Math.sin(E),h=e+b*t,_=Math.cos(E),S=_*t;for(let T=0;T<i;++T){let F=T/r,w=o+F*a,P=Math.sin(w),g=Math.cos(w),N=P*h,v=g*h,W=P*b,z=g*b;m.push(N,S,v),x.push(W,_,z),f.push(F,1-p)}}for(let l=0;l<n;++l)for(let p=0;p<r;++p){let E=1+p,b=1+l;y.push(i*l+p,i*b+p,i*l+E),y.push(i*b+p,i*b+E,i*l+E)}return{position:m,normal:x,texcoord:f,indices:y}}function Dr(e,t,r,n,o){if(t<3)throw new Error("divisions must be at least 3");r=r||1,o=o||1,n=n||0;let c=(t+1)*(r+1),a=C(3,c),i=C(3,c),s=C(2,c),u=C(3,r*t*2,Uint16Array),m=0,x=e-n,f=t+1;for(let y=0;y<=r;++y){let l=n+x*Math.pow(y/r,o);for(let p=0;p<=t;++p){let E=2*Math.PI*p/t,b=l*Math.cos(E),h=l*Math.sin(E);if(a.push(b,0,h),i.push(0,1,0),s.push(1-p/t,y/r),y>0&&p!==t){let _=m+(p+1),S=m+p,T=m+p-f,F=m+(p+1)-f;u.push(_,S,T),u.push(_,T,F)}}m+=t+1}return{position:a,normal:i,texcoord:s,indices:u}}function k(e){return function(t){let r=e.apply(this,Array.prototype.slice.call(arguments,1));return $o(t,r)}}function $(e){return function(t){let r=e.apply(null,Array.prototype.slice.call(arguments,1));return Se(t,r)}}function Ce(e){return!!e.texStorage2D}function Ze(e){if(!Mt){let t={};t[It]={textureFormat:It,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[I,G,we,d]},t[Pt]={textureFormat:Pt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[I,G,we,d]},t[Bt]={textureFormat:Bt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[I,G,we,d]},t[O]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[I,G,we,d,zr]},t[R]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[I,G,we,d,Gr,Vr]},t[ye]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ne,pe]},t[lc]={textureFormat:Ie,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[I]},t[mc]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Q]},t[xc]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[d,G]},t[yc]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[d]},t[pc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[I]},t[Ec]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Q]},t[Ic]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[pe]},t[Pc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[qe]},t[Bc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ne]},t[gc]={textureFormat:ce,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ke]},t[_c]={textureFormat:Re,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[I]},t[Fc]={textureFormat:Re,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Q]},t[Sc]={textureFormat:Re,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[d,G]},t[Cc]={textureFormat:Re,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[d]},t[wc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[I]},t[Rc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Q]},t[bc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[pe]},t[hc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[qe]},t[Tc]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ne]},t[Ac]={textureFormat:oe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ke]},t[Dc]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[I]},t[dc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[I]},t[Nc]={textureFormat:O,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[I,zr]},t[Uc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Q]},t[Mc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[d,G,la]},t[vc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[d,G,ma]},t[Lc]={textureFormat:O,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[d,G]},t[Oc]={textureFormat:O,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[d]},t[Gc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[I]},t[Vc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Q]},t[zc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[pe]},t[kc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[qe]},t[$c]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ne]},t[Wc]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Ke]},t[Hc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[I]},t[Xc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[I]},t[Yc]={textureFormat:R,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Q]},t[jc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[I,Vr,Ut]},t[qc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[I,Gr]},t[Kc]={textureFormat:R,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Ut]},t[Zc]={textureFormat:R,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[d,G]},t[Qc]={textureFormat:R,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[d]},t[Jc]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[I]},t[ea]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Q]},t[ta]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ut]},t[ra]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[pe]},t[na]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[qe]},t[oa]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Ke]},t[ca]={textureFormat:J,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ne]},t[aa]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[pe,ne]},t[sa]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ne]},t[ia]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[d]},t[fa]={textureFormat:gt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ya]},t[ua]={textureFormat:gt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[xa]},Object.keys(t).forEach(function(r){let n=t[r];n.bytesPerElementMap={},n.bytesPerElement.forEach(function(o,c){let a=n.type[c];n.bytesPerElementMap[a]=o})}),Mt=t}return Mt[e]}function Ea(e,t){let r=Ze(e);if(!r)throw"unknown internal format";let n=r.bytesPerElementMap[t];if(n===void 0)throw"unknown internal format";return n}function Ee(e){let t=Ze(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function kr(e){return(e&e-1)===0}function ba(e,t,r,n){if(!Ce(e))return kr(t)&&kr(r);let o=Ze(n);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function ha(e){let t=Ze(e);if(!t)throw"unknown internal format";return t.textureFilterable}function $r(e,t,r){return xe(t)?ke(t):r||I}function Qe(e,t,r,n,o){if(o%1!==0)throw"can't guess dimensions";if(!r&&!n){let c=Math.sqrt(o/(t===X?6:1));c%1===0?(r=c,n=c):(r=o,n=1)}else if(n){if(!r&&(r=o/n,r%1))throw"can't guess dimensions"}else if(n=o/r,n%1)throw"can't guess dimensions";return{width:r,height:n}}function be(e,t){t.colorspaceConversion!==void 0&&e.pixelStorei(ic,t.colorspaceConversion),t.premultiplyAlpha!==void 0&&e.pixelStorei(uc,t.premultiplyAlpha),t.flipY!==void 0&&e.pixelStorei(fc,t.flipY)}function Wr(e){e.pixelStorei(Nt,4),Ce(e)&&(e.pixelStorei(Ur,0),e.pixelStorei(Mr,0),e.pixelStorei(vr,0),e.pixelStorei(Lr,0),e.pixelStorei(Or,0))}function Ta(e,t,r,n){n.minMag&&(r.call(e,t,Dt,n.minMag),r.call(e,t,dt,n.minMag)),n.min&&r.call(e,t,Dt,n.min),n.mag&&r.call(e,t,dt,n.mag),n.wrap&&(r.call(e,t,Ye,n.wrap),r.call(e,t,je,n.wrap),(t===K||So(e,t))&&r.call(e,t,Nr,n.wrap)),n.wrapR&&r.call(e,t,Nr,n.wrapR),n.wrapS&&r.call(e,t,Ye,n.wrapS),n.wrapT&&r.call(e,t,je,n.wrapT),n.minLod&&r.call(e,t,oc,n.minLod),n.maxLod&&r.call(e,t,cc,n.maxLod),n.baseLevel&&r.call(e,t,ac,n.baseLevel),n.maxLevel&&r.call(e,t,sc,n.maxLevel)}function Hr(e,t,r){let n=r.target||H;e.bindTexture(n,t),Ta(e,n,e.texParameteri,r)}function Aa(e){return e=e||q.textureColor,xe(e)?e:new Uint8Array([e[0]*255,e[1]*255,e[2]*255,e[3]*255])}function vt(e,t,r,n,o,c){r=r||q.textureOptions,c=c||R;let a=r.target||H;if(n=n||r.width,o=o||r.height,e.bindTexture(a,t),ba(e,n,o,c))e.generateMipmap(a);else{let i=ha(c)?Qo:Zo;e.texParameteri(a,Dt,i),e.texParameteri(a,dt,i),e.texParameteri(a,Ye,He),e.texParameteri(a,je,He)}}function Pe(e){return e.auto===!0||e.auto===void 0&&e.level===void 0}function Lt(e,t){return t=t||{},t.cubeFaceOrder||[Xe,Jo,ec,tc,rc,nc]}function Ot(e,t){let n=Lt(e,t).map(function(o,c){return{face:o,ndx:c}});return n.sort(function(o,c){return o.face-c.face}),n}function Xr(e,t,r,n){n=n||q.textureOptions;let o=n.target||H,c=n.level||0,a=r.width,i=r.height,s=n.internalFormat||n.format||R,u=Ee(s),m=n.format||u.format,x=n.type||u.type;if(be(e,n),e.bindTexture(o,t),o===X){let f=r.width,y=r.height,l,p;if(f/6===y)l=y,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(y/6===f)l=f,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(f/3===y/2)l=f/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else if(f/2===y/3)l=f/2,p=[0,0,1,0,0,1,1,1,0,2,1,2];else throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);let E=dr();E?(E.canvas.width=l,E.canvas.height=l,a=l,i=l,Ot(e,n).forEach(function(b){let h=p[b.ndx*2+0]*l,_=p[b.ndx*2+1]*l;E.drawImage(r,h,_,l,l,0,0,l,l),e.texImage2D(b.face,c,s,m,x,E.canvas)}),E.canvas.width=1,E.canvas.height=1):typeof createImageBitmap!="undefined"&&(a=l,i=l,Ot(e,n).forEach(function(b){let h=p[b.ndx*2+0]*l,_=p[b.ndx*2+1]*l;e.texImage2D(b.face,c,s,l,l,0,m,x,null),createImageBitmap(r,h,_,l,l,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(S){be(e,n),e.bindTexture(o,t),e.texImage2D(b.face,c,s,m,x,S),Pe(n)&&vt(e,t,n,a,i,s)})}))}else if(o===K||o===Z){let f=Math.min(r.width,r.height),y=Math.max(r.width,r.height),l=y/f;if(l%1!==0)throw"can not compute 3D dimensions of element";let p=r.width===y?1:0,E=r.height===y?1:0;e.pixelStorei(Nt,1),e.pixelStorei(Ur,r.width),e.pixelStorei(Mr,0),e.pixelStorei(Or,0),e.texImage3D(o,c,s,f,f,f,0,m,x,null);for(let b=0;b<l;++b){let h=b*f*p,_=b*f*E;e.pixelStorei(vr,h),e.pixelStorei(Lr,_),e.texSubImage3D(o,c,0,0,b,f,f,1,m,x,r)}Wr(e)}else e.texImage2D(o,c,s,m,x,r);Pe(n)&&vt(e,t,n,a,i,s),Hr(e,t,n)}function Be(){}function _a(e){if(typeof document!="undefined"){let t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}else{let t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}function Fa(e,t){return t===void 0&&!_a(e)?"anonymous":t}function Sa(e,t,r){r=r||Be;let n;if(t=t!==void 0?t:q.crossOrigin,t=Fa(e,t),typeof Image!="undefined"){n=new Image,t!==void 0&&(n.crossOrigin=t);let o=function(){n.removeEventListener("error",c),n.removeEventListener("load",a),n=null},c=function(){let s="couldn't load image: "+e;xr(s),r(s,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",c),n.addEventListener("load",a),n.src=e,n}else if(typeof ImageBitmap!="undefined"){let o,c,a=function(){r(o,c)},i={};t&&(i.mode="cors"),fetch(e,i).then(function(s){if(!s.ok)throw s;return s.blob()}).then(function(s){return createImageBitmap(s,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(s){c=s,setTimeout(a)}).catch(function(s){o=s,setTimeout(a)}),n=null}return n}function Yr(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof ImageData!="undefined"&&e instanceof ImageData||typeof HTMLElement!="undefined"&&e instanceof HTMLElement}function Gt(e,t,r){return Yr(e)?(setTimeout(function(){r(null,e)}),e):Sa(e,t,r)}function Vt(e,t,r){r=r||q.textureOptions;let n=r.target||H;if(e.bindTexture(n,t),r.color===!1)return;let o=Aa(r.color);if(n===X)for(let c=0;c<6;++c)e.texImage2D(Xe+c,0,R,1,1,0,R,I,o);else n===K||n===Z?e.texImage3D(n,0,R,1,1,1,0,R,I,o):e.texImage2D(n,0,R,1,1,0,R,I,o)}function Ca(e,t,r,n){return n=n||Be,r=r||q.textureOptions,Vt(e,t,r),r=Object.assign({},r),Gt(r.src,r.crossOrigin,function(c,a){c?n(c,t,a):(Xr(e,t,a,r),n(null,t,a))})}function wa(e,t,r,n){n=n||Be;let o=r.src;if(o.length!==6)throw"there must be 6 urls for a cubemap";let c=r.level||0,a=r.internalFormat||r.format||R,i=Ee(a),s=r.format||i.format,u=r.type||I,m=r.target||H;if(m!==X)throw"target must be TEXTURE_CUBE_MAP";Vt(e,t,r),r=Object.assign({},r);let x=6,f=[],y=Lt(e,r),l;function p(E){return function(b,h){--x,b?f.push(b):h.width!==h.height?f.push("cubemap face img is not a square: "+h.src):(be(e,r),e.bindTexture(m,t),x===5?Lt().forEach(function(_){e.texImage2D(_,c,a,s,u,h)}):e.texImage2D(E,c,a,s,u,h),Pe(r)&&e.generateMipmap(m)),x===0&&n(f.length?f:void 0,t,l)}}l=o.map(function(E,b){return Gt(E,r.crossOrigin,p(y[b]))})}function Ra(e,t,r,n){n=n||Be;let o=r.src,c=r.internalFormat||r.format||R,a=Ee(c),i=r.format||a.format,s=r.type||I,u=r.target||Z;if(u!==K&&u!==Z)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Vt(e,t,r),r=Object.assign({},r);let m=o.length,x=[],f,y=r.level||0,l=r.width,p=r.height,E=o.length,b=!0;function h(_){return function(S,T){if(--m,S)x.push(S);else{if(be(e,r),e.bindTexture(u,t),b){b=!1,l=r.width||T.width,p=r.height||T.height,e.texImage3D(u,y,c,l,p,E,0,i,s,null);for(let F=0;F<E;++F)e.texSubImage3D(u,y,0,0,F,l,p,1,i,s,T)}else{let F=T,w;(T.width!==l||T.height!==p)&&(w=dr(),F=w.canvas,w.canvas.width=l,w.canvas.height=p,w.drawImage(T,0,0,l,p)),e.texSubImage3D(u,y,0,0,_,l,p,1,i,s,F),w&&F===w.canvas&&(w.canvas.width=0,w.canvas.height=0)}Pe(r)&&e.generateMipmap(u)}m===0&&n(x.length?x:void 0,t,f)}}f=o.map(function(_,S){return Gt(_,r.crossOrigin,h(S))})}function Je(e,t,r,n){n=n||q.textureOptions;let o=n.target||H;e.bindTexture(o,t);let c=n.width,a=n.height,i=n.depth,s=n.level||0,u=n.internalFormat||n.format||R,m=Ee(u),x=n.format||m.format,f=n.type||$r(e,r,m.type);if(xe(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{let E=Ao(f);r=new E(r)}let y=Ea(u,f),l=r.byteLength/y;if(l%1)throw"length wrong size for format: "+Rt(e,x);let p;if(o===K||o===Z)if(!c&&!a&&!i){let E=Math.cbrt(l);if(E%1!==0)throw"can't guess cube size of array of numElements: "+l;c=E,a=E,i=E}else c&&(!a||!i)?(p=Qe(e,o,a,i,l/c),a=p.width,i=p.height):a&&(!c||!i)?(p=Qe(e,o,c,i,l/a),c=p.width,i=p.height):(p=Qe(e,o,c,a,l/i),c=p.width,a=p.height);else p=Qe(e,o,c,a,l),c=p.width,a=p.height;if(Wr(e),e.pixelStorei(Nt,n.unpackAlignment||1),be(e,n),o===X){let E=y/r.BYTES_PER_ELEMENT,b=l/6*E;Ot(e,n).forEach(h=>{let _=b*h.ndx,S=r.subarray(_,_+b);e.texImage2D(h.face,s,u,c,a,0,x,f,S)})}else o===K||o===Z?e.texImage3D(o,s,u,c,a,i,0,x,f,r):e.texImage2D(o,s,u,c,a,0,x,f,r);return{width:c,height:a,depth:i,type:f}}function Ia(e,t,r){let n=r.target||H;e.bindTexture(n,t);let o=r.level||0,c=r.internalFormat||r.format||R,a=Ee(c),i=r.format||a.format,s=r.type||a.type;if(be(e,r),n===X)for(let u=0;u<6;++u)e.texImage2D(Xe+u,o,c,r.width,r.height,0,i,s,null);else n===K||n===Z?e.texImage3D(n,o,c,r.width,r.height,r.depth,0,i,s,null):e.texImage2D(n,o,c,r.width,r.height,0,i,s,null)}function Y(e,t,r){r=r||Be,t=t||q.textureOptions;let n=e.createTexture(),o=t.target||H,c=t.width||1,a=t.height||1,i=t.internalFormat||R;e.bindTexture(o,n),o===X&&(e.texParameteri(o,Ye,He),e.texParameteri(o,je,He));let s=t.src;if(s)if(typeof s=="function"&&(s=s(e,t)),typeof s=="string")Ca(e,n,t,r);else if(xe(s)||Array.isArray(s)&&(typeof s[0]=="number"||Array.isArray(s[0])||xe(s[0]))){let u=Je(e,n,s,t);c=u.width,a=u.height}else Array.isArray(s)&&(typeof s[0]=="string"||Yr(s[0]))?o===X?wa(e,n,t,r):Ra(e,n,t,r):(Xr(e,n,s,t),c=s.width,a=s.height);else Ia(e,n,t);return Pe(t)&&vt(e,n,t,c,a,i),Hr(e,n,t),n}function Pa(e,t,r,n,o,c){n=n||r.width,o=o||r.height,c=c||r.depth;let a=r.target||H;e.bindTexture(a,t);let i=r.level||0,s=r.internalFormat||r.format||R,u=Ee(s),m=r.format||u.format,x,f=r.src;if(f&&(xe(f)||Array.isArray(f)&&typeof f[0]=="number")?x=r.type||$r(e,f,u.type):x=r.type||u.type,a===X)for(let y=0;y<6;++y)e.texImage2D(Xe+y,i,s,n,o,0,m,x,null);else a===K||a===Z?e.texImage3D(a,i,s,n,o,c,0,m,x,null):e.texImage2D(a,i,s,n,o,0,m,x,null)}function qr(e){return typeof document!="undefined"&&document.getElementById?document.getElementById(e):null}function yn(e,t){return A[t].bindPoint}function us(e,t){return function(r){e.uniform1f(t,r)}}function fs(e,t){return function(r){e.uniform1fv(t,r)}}function ls(e,t){return function(r){e.uniform2fv(t,r)}}function ms(e,t){return function(r){e.uniform3fv(t,r)}}function xs(e,t){return function(r){e.uniform4fv(t,r)}}function pn(e,t){return function(r){e.uniform1i(t,r)}}function En(e,t){return function(r){e.uniform1iv(t,r)}}function bn(e,t){return function(r){e.uniform2iv(t,r)}}function hn(e,t){return function(r){e.uniform3iv(t,r)}}function Tn(e,t){return function(r){e.uniform4iv(t,r)}}function ys(e,t){return function(r){e.uniform1ui(t,r)}}function ps(e,t){return function(r){e.uniform1uiv(t,r)}}function Es(e,t){return function(r){e.uniform2uiv(t,r)}}function bs(e,t){return function(r){e.uniform3uiv(t,r)}}function hs(e,t){return function(r){e.uniform4uiv(t,r)}}function Ts(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}function As(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}function _s(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}function Fs(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}function Ss(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}function Cs(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}function ws(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}function Rs(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}function Is(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}function U(e,t,r,n){let o=yn(e,t);return Ce(e)?function(c){let a,i;$e(e,c)?(a=c,i=null):(a=c.texture,i=c.sampler),e.uniform1i(n,r),e.activeTexture(et+r),e.bindTexture(o,a),e.bindSampler(r,i)}:function(c){e.uniform1i(n,r),e.activeTexture(et+r),e.bindTexture(o,c)}}function M(e,t,r,n,o){let c=yn(e,t),a=new Int32Array(o);for(let i=0;i<o;++i)a[i]=r+i;return Ce(e)?function(i){e.uniform1iv(n,a),i.forEach(function(s,u){e.activeTexture(et+a[u]);let m,x;$e(e,s)?(m=s,x=null):(m=s.texture,x=s.sampler),e.bindSampler(r,x),e.bindTexture(c,m)})}:function(i){e.uniform1iv(n,a),i.forEach(function(s,u){e.activeTexture(et+a[u]),e.bindTexture(c,s)})}}function at(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(tt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||rt,r.normalize||!1,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function ee(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4iv(t,r.value);else throw new Error("The length of an integer constant value must be 4!");else e.bindBuffer(tt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||zt,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function st(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4uiv(t,r.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else e.bindBuffer(tt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||kt,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function Wt(e,t,r){let n=r.size,o=r.count;return function(c){e.bindBuffer(tt,c.buffer);let a=c.size||c.numComponents||n,i=a/o,s=c.type||rt,m=A[s].size*a,x=c.normalize||!1,f=c.offset||0,y=m/o;for(let l=0;l<o;++l)e.enableVertexAttribArray(t+l),e.vertexAttribPointer(t+l,i,s,x,m,f+y*l),c.divisor!==void 0&&e.vertexAttribDivisor(t+l,c.divisor)}}function An(e,t="",r=0){let n=[...t.matchAll(Ps)],o=new Map(n.map((c,a)=>{let i=parseInt(c[1]),s=n[a+1],u=s?s.index:t.length,m=t.substring(c.index,u);return[i-1,m]}));return e.split(`
`).map((c,a)=>{let i=o.get(a);return`${a+1+r}: ${c}${i?`

^^^ ${i}`:""}`}).join(`
`)}function Fn(e,t,r,n){let o=n||jr,c=e.createShader(r),a=0;if(_n.test(t)&&(a=1,t=t.replace(_n,"")),e.shaderSource(c,t),e.compileShader(c),!e.getShaderParameter(c,ga)){let s=e.getShaderInfoLog(c);return o(`${An(t,s,a)}
Error compiling ${Rt(e,r)}: ${s}`),e.deleteShader(c),null}return c}function Ht(e,t,r){let n,o;if(typeof t=="function"&&(r=t,t=void 0),typeof e=="function")r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;let a=e;r=a.errorCallback,e=a.attribLocations,n=a.transformFeedbackVaryings,o=a.transformFeedbackMode}let c={errorCallback:r||jr,transformFeedbackVaryings:n,transformFeedbackMode:o};if(e){let a={};Array.isArray(e)?e.forEach(function(i,s){a[i]=t?t[s]:s}):a=e,c.attribLocations=a}return c}function Bs(e,t){if(t.indexOf("frag")>=0)return da;if(t.indexOf("vert")>=0)return Na}function Cn(e,t){t.forEach(function(r){e.deleteShader(r)})}function gs(e,t,r,n,o){let c=Ht(r,n,o),a=[],i=[];for(let x=0;x<t.length;++x){let f=t[x];if(typeof f=="string"){let y=qr(f),l=y?y.text:f,p=e[Sn[x]];y&&y.type&&(p=Bs(e,y.type)||p),f=Fn(e,l,p,c.errorCallback),i.push(f)}Fo(e,f)&&a.push(f)}if(a.length!==t.length)return c.errorCallback("not enough shaders for program"),Cn(e,i),null;let s=e.createProgram();a.forEach(function(x){e.attachShader(s,x)}),c.attribLocations&&Object.keys(c.attribLocations).forEach(function(x){e.bindAttribLocation(s,c.attribLocations[x],x)});let u=c.transformFeedbackVaryings;if(u&&(u.attribs&&(u=u.attribs),Array.isArray(u)||(u=Object.keys(u)),e.transformFeedbackVaryings(s,u,c.transformFeedbackMode||Ua)),e.linkProgram(s),!e.getProgramParameter(s,Da)){let x=e.getProgramInfoLog(s);return c.errorCallback(`${a.map(f=>{let y=An(e.getShaderSource(f),"",0),l=e.getShaderParameter(f,e.SHADER_TYPE);return`${Rt(e,l)}
${y}}`}).join(`
`)}
Error in program linking: ${x}`),e.deleteProgram(s),Cn(e,i),null}return s}function Ds(e,t,r,n,o){let c=Ht(r,n,o),a=[];for(let i=0;i<t.length;++i){let s=Fn(e,t[i],e[Sn[i]],c.errorCallback);if(!s)return null;a.push(s)}return gs(e,a,c)}function wn(e){let t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function Us(e,t,r,n){let o=e.split(ds).filter(i=>i!==""),c=0,a="";for(;;){let i=o[c++];a+=i;let s=Ns(i[0]),u=s?parseInt(i):i;if(s&&(a+=o[c++]),c===o.length){r[u]=t;break}else{let x=o[c++],f=x==="[",y=r[u]||(f?[]:{});r[u]=y,r=y,n[a]=n[a]||function(l){return function(p){Rn(l,p)}}(y),a+=x}}}function Ms(e,t){let r=0;function n(i,s,u){let m=s.name.endsWith("[0]"),x=s.type,f=A[x];if(!f)throw new Error(`unknown type: 0x${x.toString(16)}`);let y;if(f.bindPoint){let l=r;r+=s.size,m?y=f.arraySetter(e,x,l,u,s.size):y=f.setter(e,x,l,u,s.size)}else f.arraySetter&&m?y=f.arraySetter(e,u):y=f.setter(e,u);return y.location=u,y}let o={},c={},a=e.getProgramParameter(t,Kr);for(let i=0;i<a;++i){let s=e.getActiveUniform(t,i);if(wn(s))continue;let u=s.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));let m=e.getUniformLocation(t,s.name);if(m){let x=n(t,s,m);o[u]=x,Us(u,x,c,o)}}return o}function vs(e,t){let r={},n=e.getProgramParameter(t,va);for(let o=0;o<n;++o){let c=e.getTransformFeedbackVarying(t,o);r[c.name]={index:o,type:c.type,size:c.size}}return r}function Ls(e,t){let r=e.getProgramParameter(t,Kr),n=[],o=[];for(let i=0;i<r;++i){o.push(i),n.push({});let s=e.getActiveUniform(t,i);n[i].name=s.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(i){let s=i[0],u=i[1];e.getActiveUniforms(t,o,e[s]).forEach(function(m,x){n[x][u]=m})});let c={},a=e.getProgramParameter(t,La);for(let i=0;i<a;++i){let s=e.getActiveUniformBlockName(t,i),u={index:e.getUniformBlockIndex(t,s),usedByVertexShader:e.getActiveUniformBlockParameter(t,i,Oa),usedByFragmentShader:e.getActiveUniformBlockParameter(t,i,Ga),size:e.getActiveUniformBlockParameter(t,i,Va),uniformIndices:e.getActiveUniformBlockParameter(t,i,za)};u.used=u.usedByVertexShader||u.usedByFragmentShader,c[s]=u}return{blockSpecs:c,uniformData:n}}function Rn(e,t){for(let r in t){let n=e[r];typeof n=="function"?n(t[r]):Rn(e[r],t[r])}}function ge(e,...t){let r=e.uniformSetters||e,n=t.length;for(let o=0;o<n;++o){let c=t[o];if(Array.isArray(c)){let a=c.length;for(let i=0;i<a;++i)ge(r,c[i])}else for(let a in c){let i=r[a];i&&i(c[a])}}}function Os(e,t){let r={},n=e.getProgramParameter(t,Ma);for(let o=0;o<n;++o){let c=e.getActiveAttrib(t,o);if(wn(c))continue;let a=e.getAttribLocation(t,c.name),i=B[c.type],s=i.setter(e,a,i);s.location=a,r[c.name]=s}return r}function Gs(e,t){for(let r in t){let n=e[r];n&&n(t[r])}}function it(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Gs(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(Ba,r.indices))}function Vs(e,t){let r=Ms(e,t),n=Os(e,t),o={program:t,uniformSetters:r,attribSetters:n};return Ce(e)&&(o.uniformBlockSpec=Ls(e,t),o.transformFeedbackInfo=vs(e,t)),o}function ut(e,t,r,n,o){let c=Ht(r,n,o),a=!0;if(t=t.map(function(s){if(s.indexOf(`
`)<0){let u=qr(s);u?s=u.text:(c.errorCallback("no element with id: "+s),a=!1)}return s}),!a)return null;let i=Ds(e,t,c);return i?Vs(e,i):null}function ft(e,t,r,n,o,c){r=r===void 0?zs:r;let a=t.indices,i=t.elementType,s=n===void 0?t.numElements:n;o=o===void 0?0:o,i||a?c!==void 0?e.drawElementsInstanced(r,s,i===void 0?In:t.elementType,o,c):e.drawElements(r,s,i===void 0?In:t.elementType,o):c!==void 0?e.drawArraysInstanced(r,o,s,c):e.drawArrays(r,o,s)}function ei(e,t){return V[e]||V[t]}function ti(e){return te[e]}function Un(e,t,r,n){let o=Pn,c=e.createFramebuffer();e.bindFramebuffer(o,c),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight,t=t||Nn;let a=0,i={framebuffer:c,attachments:[],width:r,height:n};return t.forEach(function(s){let u=s.attachment,m=s.format,x=s.attachmentPoint||ei(m,s.internalFormat);if(x||(x=Js+a++),!u)if(ti(m))u=e.createRenderbuffer(),e.bindRenderbuffer(De,u),e.renderbufferStorage(De,m,r,n);else{let f=Object.assign({},s);f.width=r,f.height=n,f.auto===void 0&&(f.auto=!1,f.min=f.min||f.minMag||qt,f.mag=f.mag||f.minMag||qt,f.wrapS=f.wrapS||f.wrap||jt,f.wrapT=f.wrapT||f.wrap||jt),u=Y(e,f)}if(yr(e,u))e.framebufferRenderbuffer(o,x,De,u);else if($e(e,u))s.layer!==void 0?e.framebufferTextureLayer(o,x,u,s.level||0,s.layer):e.framebufferTexture2D(o,x,s.target||ks,u,s.level||0);else throw new Error("unknown attachment type");i.attachments.push(u)}),i}function Mn(e,t,r,n,o){n=n||e.drawingBufferWidth,o=o||e.drawingBufferHeight,t.width=n,t.height=o,r=r||Nn,r.forEach(function(c,a){let i=t.attachments[a],s=c.format;if(yr(e,i))e.bindRenderbuffer(De,i),e.renderbufferStorage(De,s,n,o);else if($e(e,i))Pa(e,i,c,n,o);else throw new Error("unknown attachment type")})}function Kt(e,t,r){r=r||Pn,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}function vn(e,t){t=t||1,t=Math.max(0,t);let r=e.clientWidth*t|0,n=e.clientHeight*t|0;return e.width!==r||e.height!==n?(e.width=r,e.height=n,!0):!1}var pt,lr,bt,_e,ht,Tt,At,_t,Ft,fo,lo,mo,xo,yo,po,Eo,bo,ho,mr,Fe,pr,j,Er,Co,wo,Ro,Io,Po,Bo,go,Do,br,vo,Lo,me,Ko,li,mi,xi,yi,pi,Ei,bi,hi,Ti,Ai,_i,Fi,Si,Ci,wi,Ri,Ii,Pi,Bi,gi,Rt,q,xe,dr,It,O,R,Pt,Bt,ye,gt,He,Zo,Qo,H,X,K,Z,Xe,Jo,ec,tc,rc,nc,Dt,dt,Ye,je,Nr,oc,cc,ac,sc,Nt,Ur,Mr,vr,Lr,Or,ic,uc,fc,lc,mc,xc,yc,pc,Ec,bc,hc,Tc,Ac,_c,Fc,Sc,Cc,wc,Rc,Ic,Pc,Bc,gc,Dc,dc,Nc,Uc,Mc,vc,Lc,Oc,Gc,Vc,zc,kc,$c,Wc,Hc,Xc,Yc,jc,qc,Kc,Zc,Qc,Jc,ea,ta,ra,na,oa,ca,aa,sa,ia,ua,fa,Q,I,qe,pe,Ke,ne,d,Gr,Vr,zr,G,we,Ut,la,ma,xa,ya,Re,oe,Ie,ce,ae,J,pa,Mt,jr,et,tt,Ba,ga,Da,da,Na,Ua,Kr,Ma,va,La,Oa,Ga,Va,za,rt,Zr,Qr,Jr,zt,en,tn,rn,nn,on,cn,an,sn,un,fn,ka,$a,Wa,Ha,Xa,Ya,ja,qa,Ka,Za,Qa,Ja,es,kt,ln,mn,xn,ts,rs,ns,os,cs,as,ss,is,nt,ot,$t,ct,A,B,Ps,_n,Sn,ds,Ns,zs,In,Pn,De,ks,$s,Ws,Hs,Xs,Ys,js,qs,Ks,Zs,Qs,Bn,gn,Dn,Xt,Js,lt,dn,Yt,jt,qt,Nn,V,te,he=L(()=>{pt=Float32Array;lr=Float32Array;bt=5120,_e=5121,ht=5122,Tt=5123,At=5124,_t=5125,Ft=5126,fo=32819,lo=32820,mo=33635,xo=5131,yo=33640,po=35899,Eo=35902,bo=36269,ho=34042,mr={};{let e=mr;e[bt]=Int8Array,e[_e]=Uint8Array,e[ht]=Int16Array,e[Tt]=Uint16Array,e[At]=Int32Array,e[_t]=Uint32Array,e[Ft]=Float32Array,e[fo]=Uint16Array,e[lo]=Uint16Array,e[mo]=Uint16Array,e[xo]=Uint16Array,e[yo]=Uint32Array,e[po]=Uint32Array,e[Eo]=Uint32Array,e[bo]=Uint32Array,e[ho]=Uint32Array}Fe=typeof SharedArrayBuffer!="undefined"?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};pr=35044,j=34962,Er=34963,Co=34660,wo=5120,Ro=5121,Io=5122,Po=5123,Bo=5124,go=5125,Do=5126,br={attribPrefix:""};vo=/coord|texture/i,Lo=/color|colour/i;me=["position","positions","a_position"];Ko=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];li=$(Ir),mi=k(Ir),xi=$(wr),yi=k(wr),pi=$(Sr),Ei=k(Sr),bi=$(Cr),hi=k(Cr),Ti=$(wt),Ai=k(wt),_i=$(Fr),Fi=k(Fr),Si=$(Pr),Ci=k(Pr),wi=$(Br),Ri=k(Br),Ii=$(gr),Pi=k(gr),Bi=$(Dr),gi=k(Dr);Rt=function(){let e={},t={};function r(n){let o=n.constructor.name;if(!e[o]){for(let c in n)if(typeof n[c]=="number"){let a=t[n[c]];t[n[c]]=a?`${a} | ${c}`:c}e[o]=!0}}return function(o,c){return r(o),t[c]||(typeof c=="number"?`0x${c.toString(16)}`:c)}}(),q={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},xe=Fe,dr=function(){let e;return function(){return e=e||(typeof document!="undefined"&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),It=6406,O=6407,R=6408,Pt=6409,Bt=6410,ye=6402,gt=34041,He=33071,Zo=9728,Qo=9729,H=3553,X=34067,K=32879,Z=35866,Xe=34069,Jo=34070,ec=34071,tc=34072,rc=34073,nc=34074,Dt=10241,dt=10240,Ye=10242,je=10243,Nr=32882,oc=33082,cc=33083,ac=33084,sc=33085,Nt=3317,Ur=3314,Mr=32878,vr=3316,Lr=3315,Or=32877,ic=37443,uc=37441,fc=37440,lc=33321,mc=36756,xc=33325,yc=33326,pc=33330,Ec=33329,bc=33338,hc=33337,Tc=33340,Ac=33339,_c=33323,Fc=36757,Sc=33327,Cc=33328,wc=33336,Rc=33335,Ic=33332,Pc=33331,Bc=33334,gc=33333,Dc=32849,dc=35905,Nc=36194,Uc=36758,Mc=35898,vc=35901,Lc=34843,Oc=34837,Gc=36221,Vc=36239,zc=36215,kc=36233,$c=36209,Wc=36227,Hc=32856,Xc=35907,Yc=36759,jc=32855,qc=32854,Kc=32857,Zc=34842,Qc=34836,Jc=36220,ea=36238,ta=36975,ra=36214,na=36232,oa=36226,ca=36208,aa=33189,sa=33190,ia=36012,ua=36013,fa=35056,Q=5120,I=5121,qe=5122,pe=5123,Ke=5124,ne=5125,d=5126,Gr=32819,Vr=32820,zr=33635,G=5131,we=36193,Ut=33640,la=35899,ma=35902,xa=36269,ya=34042,Re=33319,oe=33320,Ie=6403,ce=36244,ae=36248,J=36249,pa={};{let e=pa;e[It]={numColorComponents:1},e[Pt]={numColorComponents:1},e[Bt]={numColorComponents:2},e[O]={numColorComponents:3},e[R]={numColorComponents:4},e[Ie]={numColorComponents:1},e[ce]={numColorComponents:1},e[Re]={numColorComponents:2},e[oe]={numColorComponents:2},e[O]={numColorComponents:3},e[ae]={numColorComponents:3},e[R]={numColorComponents:4},e[J]={numColorComponents:4},e[ye]={numColorComponents:1},e[gt]={numColorComponents:2}}jr=xr;et=33984,tt=34962,Ba=34963,ga=35713,Da=35714,da=35632,Na=35633,Ua=35981,Kr=35718,Ma=35721,va=35971,La=35382,Oa=35396,Ga=35398,Va=35392,za=35395,rt=5126,Zr=35664,Qr=35665,Jr=35666,zt=5124,en=35667,tn=35668,rn=35669,nn=35670,on=35671,cn=35672,an=35673,sn=35674,un=35675,fn=35676,ka=35678,$a=35680,Wa=35679,Ha=35682,Xa=35685,Ya=35686,ja=35687,qa=35688,Ka=35689,Za=35690,Qa=36289,Ja=36292,es=36293,kt=5125,ln=36294,mn=36295,xn=36296,ts=36298,rs=36299,ns=36300,os=36303,cs=36306,as=36307,ss=36308,is=36311,nt=3553,ot=34067,$t=32879,ct=35866,A={};A[rt]={Type:Float32Array,size:4,setter:us,arraySetter:fs};A[Zr]={Type:Float32Array,size:8,setter:ls,cols:2};A[Qr]={Type:Float32Array,size:12,setter:ms,cols:3};A[Jr]={Type:Float32Array,size:16,setter:xs,cols:4};A[zt]={Type:Int32Array,size:4,setter:pn,arraySetter:En};A[en]={Type:Int32Array,size:8,setter:bn,cols:2};A[tn]={Type:Int32Array,size:12,setter:hn,cols:3};A[rn]={Type:Int32Array,size:16,setter:Tn,cols:4};A[kt]={Type:Uint32Array,size:4,setter:ys,arraySetter:ps};A[ln]={Type:Uint32Array,size:8,setter:Es,cols:2};A[mn]={Type:Uint32Array,size:12,setter:bs,cols:3};A[xn]={Type:Uint32Array,size:16,setter:hs,cols:4};A[nn]={Type:Uint32Array,size:4,setter:pn,arraySetter:En};A[on]={Type:Uint32Array,size:8,setter:bn,cols:2};A[cn]={Type:Uint32Array,size:12,setter:hn,cols:3};A[an]={Type:Uint32Array,size:16,setter:Tn,cols:4};A[sn]={Type:Float32Array,size:32,setter:Ts,rows:2,cols:2};A[un]={Type:Float32Array,size:48,setter:As,rows:3,cols:3};A[fn]={Type:Float32Array,size:64,setter:_s,rows:4,cols:4};A[Xa]={Type:Float32Array,size:32,setter:Fs,rows:2,cols:3};A[Ya]={Type:Float32Array,size:32,setter:Cs,rows:2,cols:4};A[ja]={Type:Float32Array,size:48,setter:Ss,rows:3,cols:2};A[qa]={Type:Float32Array,size:48,setter:Rs,rows:3,cols:4};A[Ka]={Type:Float32Array,size:64,setter:ws,rows:4,cols:2};A[Za]={Type:Float32Array,size:64,setter:Is,rows:4,cols:3};A[ka]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:nt};A[$a]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ot};A[Wa]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:$t};A[Ha]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:nt};A[Qa]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ct};A[Ja]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ct};A[es]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ot};A[ts]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:nt};A[rs]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:$t};A[ns]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ot};A[os]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ct};A[cs]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:nt};A[as]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:$t};A[ss]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ot};A[is]={Type:null,size:0,setter:U,arraySetter:M,bindPoint:ct};B={};B[rt]={size:4,setter:at};B[Zr]={size:8,setter:at};B[Qr]={size:12,setter:at};B[Jr]={size:16,setter:at};B[zt]={size:4,setter:ee};B[en]={size:8,setter:ee};B[tn]={size:12,setter:ee};B[rn]={size:16,setter:ee};B[kt]={size:4,setter:st};B[ln]={size:8,setter:st};B[mn]={size:12,setter:st};B[xn]={size:16,setter:st};B[nn]={size:4,setter:ee};B[on]={size:8,setter:ee};B[cn]={size:12,setter:ee};B[an]={size:16,setter:ee};B[sn]={size:4,setter:Wt,count:2};B[un]={size:9,setter:Wt,count:3};B[fn]={size:16,setter:Wt,count:4};Ps=/ERROR:\s*\d+:(\d+)/gi;_n=/^[ \t]*\n/;Sn=["VERTEX_SHADER","FRAGMENT_SHADER"];ds=/(\.|\[|]|\w+)/g,Ns=e=>e>="0"&&e<="9";zs=4,In=5123;Pn=36160,De=36161,ks=3553,$s=5121,Ws=6402,Hs=6408,Xs=33190,Ys=36012,js=35056,qs=36013,Ks=32854,Zs=32855,Qs=36194,Bn=33189,gn=6401,Dn=36168,Xt=34041,Js=36064,lt=36096,dn=36128,Yt=33306,jt=33071,qt=9729,Nn=[{format:Hs,type:$s,min:qt,wrap:jt},{format:Xt}],V={};V[Xt]=Yt;V[gn]=dn;V[Dn]=dn;V[Ws]=lt;V[Bn]=lt;V[Xs]=lt;V[Ys]=lt;V[js]=Yt;V[qs]=Yt;te={};te[Ks]=!0;te[Zs]=!0;te[Qs]=!0;te[Xt]=!0;te[Bn]=!0;te[gn]=!0;te[Dn]=!0});var On,Ln=L(()=>{On=`precision mediump float;

attribute vec2 position;
attribute vec2 texCoord;

varying vec2 v_texCoord;

void main() {
  v_texCoord = texCoord;
  gl_Position = vec4(position, 0.0, 1.0);
}
`});var Vn,Gn=L(()=>{Vn=`
precision mediump float;

varying vec2 v_texCoord;

// Colors used for rendering
uniform sampler2D narrowFont;
uniform sampler2D squareFont;
uniform sampler2D palette;

// Tables used for lookups
uniform sampler2D charsTexture;
uniform sampler2D backgroundColorTable;
uniform sampler2D foregroundColorTable;

uniform vec2 fontTileCount;
uniform vec2 screenTileCount;

void main() {
  vec4 charSample = texture2D(charsTexture, v_texCoord);
  vec2 char = (charSample.xy * 255.0);

  vec2 bgColLoc = texture2D(backgroundColorTable, v_texCoord).xy * 255.0;
  vec4 backgroundColor = texture2D(palette, (bgColLoc + 0.5) / 16.0);
  vec2 fgColLoc = texture2D(foregroundColorTable, v_texCoord).xy * 255.0;
  vec4 foregroundColor = texture2D(palette, (fgColLoc + 0.5) / 16.0);

  bool doubleWidth = charSample.z > 0.5;

  vec2 fontTileCountScaled = doubleWidth
    ? vec2(fontTileCount.x * 2.0, fontTileCount.y)
    : fontTileCount;
  vec2 spriteSize = 1.0 / fontTileCountScaled;
  vec2 fontTextureStartOffset = char * spriteSize;

  vec2 spriteOffset = vec2(
    mod((v_texCoord.x * screenTileCount.x), 1.0),
    mod((v_texCoord.y * screenTileCount.y), 1.0)
  ) * spriteSize;

  vec2 fontTextureOffset = fontTextureStartOffset + spriteOffset;

  vec4 fontCol = doubleWidth
    ? texture2D(squareFont, fontTextureOffset)
    //? vec4(spriteOffset / spriteSize, 0.0, 1.0)
    : texture2D(narrowFont, fontTextureOffset);

  //gl_FragColor = vec4(v_texCoord.x, 0.0, v_texCoord.y, 1.0);
  fontCol = fontCol * foregroundColor;
  gl_FragColor = vec4(mix(backgroundColor.rgb, fontCol.rgb, fontCol.a), 1.0);
}
`});var Zt,zn=L(()=>{Zt=class{constructor(t){this.data=new Float32Array(t),this.offset=0}push(t){this.data[this.offset]=t,this.offset+=1}push2(t,r){this.push(t),this.push(r)}}});function Te(e,t,r,n){let o=new Zt(12);return o.push2(e,t),o.push2(r,n),o.push2(e,n),o.push2(e,t),o.push2(r,t),o.push2(r,n),o.data}var Qt=L(()=>{zn()});var Jt,kn=L(()=>{he();Ln();Gn();Qt();Jt=class{constructor(t){let r={position:{numComponents:2,data:Te(-1,1,1,-1)},texCoord:{numComponents:2,data:Te(0,0,1,1)}},n=ut(t,[On,Vn]),o=Se(t,r);this.state={gl:t,programInfo:n,bufferInfo:o}}render(t){let{gl:r}=this.state;r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),r.useProgram(this.state.programInfo.program),it(r,this.state.programInfo,this.state.bufferInfo),ge(this.state.programInfo,{narrowFont:t.narrowFont,squareFont:t.squareFont,charsTexture:t.charsTable,palette:t.palette,backgroundColorTable:t.backgroundColorTable,foregroundColorTable:t.foregroundColorTable,fontTileCount:[16,16],screenTileCount:[t.cols,t.rows]}),ft(r,this.state.bufferInfo)}}});var Wn,$n=L(()=>{Wn=`precision mediump float;

attribute vec2 position;
attribute vec2 texCoord;

varying vec2 v_texCoord;

uniform vec2 scale;

void main() {
  v_texCoord = texCoord;
  gl_Position = vec4(position * scale, 0.0, 1.0);
}
`});var Xn,Hn=L(()=>{Xn=`precision mediump float;

varying vec2 v_texCoord;

uniform sampler2D virtualScreen;
uniform vec2 virtualScreenSize;
uniform sampler2D scanlineTexture;

void main() {
  vec4 col = texture2D(virtualScreen, v_texCoord);

  // Grab a pixel to the left for some bleed
  vec2 left = vec2(-1.0 / virtualScreenSize.x, 0.0);
  vec4 bleedCol = texture2D(virtualScreen, v_texCoord + left);
  vec4 bleedCol2 = texture2D(virtualScreen, v_texCoord + left + left);

  vec4 scanline = texture2D(scanlineTexture, v_texCoord * virtualScreenSize);

  gl_FragColor = (col * 0.6 + bleedCol * 0.2 + bleedCol2 * 0.2) * scanline;
}
`});var jn,Yn=L(()=>{jn=`precision mediump float;

varying vec2 v_texCoord;

uniform sampler2D virtualScreen;

void main() {
  vec4 col = texture2D(virtualScreen, v_texCoord);

  gl_FragColor = col;
}
`});var er,qn=L(()=>{he();$n();Hn();Yn();Qt();er=class{constructor(t,r){let n={position:{numComponents:2,data:Te(-1,-1,1,1)},texCoord:{numComponents:2,data:Te(0,0,1,1)}},o=ut(t,[Wn,r?Xn:jn]),c=Se(t,n),a=Y(t,{src:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,90,90,90,255]),width:1,height:4});this.state={gl:t,programInfo:o,bufferInfo:c,scanlineTexture:a}}render(t,r,n){let{gl:o}=this.state;o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.enable(o.BLEND);let c=[r.x/o.canvas.width,r.y/o.canvas.height];o.useProgram(this.state.programInfo.program),it(o,this.state.programInfo,this.state.bufferInfo),ge(this.state.programInfo,{virtualScreen:t,virtualScreenSize:[n.x,n.y],scale:c,scanlineTexture:this.state.scanlineTexture}),ft(o,this.state.bufferInfo)}}});var xt,Kn=L(()=>{(t=>{function e(r,n){return{x:r.x*n,y:r.y*n}}t.scalarMult=e})(xt||(xt={}))});var de,Zn=L(()=>{he();de=class{constructor(t){this.setCell=(t,r,n,o)=>{this.backingData[t*4]=r,this.backingData[t*4+1]=n,this.backingData[t*4+2]=o?255:0};this.gl=t,this.backingData=new Uint8Array(4);let r={src:this.backingData,width:1,height:1,format:t.RGBA,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE};this.texture=Y(t,r)}updateWithColorData(t,r,n){let{gl:o,texture:c}=this,a=0,i=t*r;for(this.backingData.length<i*4&&(this.backingData=new Uint8Array(i*4));a<i;){let s=n.getUint8(a),u=s%16,m=Math.floor(s/16);this.setCell(a,u,m,!1),a+=1}Je(o,c,this.backingData,{min:o.NEAREST,mag:o.NEAREST,width:t,height:r,wrap:o.CLAMP_TO_EDGE})}updateWithCharData(t,r,n){let{gl:o,texture:c}=this,a=0,i=t*r;for(this.backingData.length<i*4&&(this.backingData=new Uint8Array(i*4));a<i;){let s=n.getUint8(a),u=s%16,m=Math.floor(s/16);if(s!==255)this.setCell(a,u,m,!1);else{let x=n.getUint8(a+1),f=x%16,y=Math.floor(x/16);this.setCell(a,f*2,y,!0),this.setCell(a+1,f*2+1,y,!0),a+=1}a+=1}Je(o,c,this.backingData,{min:o.NEAREST,mag:o.NEAREST,width:t,height:r,wrap:o.CLAMP_TO_EDGE})}}});var Qn,tr,Jn=L(()=>{kn();he();qn();Kn();Zn();Qn=[{min:WebGLRenderingContext.NEAREST,mag:WebGLRenderingContext.NEAREST}],tr=class{constructor(t,r,n,o){let c=t.getContext("webgl");if(c==null)throw new Error("Could not start webgl");let a=Y(c,{src:r.narrow,min:c.NEAREST,mag:c.NEAREST}),i=Y(c,{src:r.square,min:c.NEAREST,mag:c.NEAREST}),s=Y(c,{src:n,min:c.NEAREST,mag:c.NEAREST}),u=Un(c,Qn,1,1);this.state={gl:c,fontSpriteProgram:new Jt(c),virtualScreenProgram:new er(c,o),charsTable:new de(c),bgColorTable:new de(c),fgColorTable:new de(c),narrowFontTexture:a,squareFontTexture:i,virtualScreen:u,palette:s}}clear(){let{gl:t}=this.state;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}useVirtualScreen(){Kt(this.state.gl,this.state.virtualScreen),this.clear()}useRealScreen(){let{gl:t}=this.state;Kt(t,null),t.viewport(0,0,t.canvas.width,t.canvas.height),this.clear()}render(t,r,n){let{gl:o}=this.state;(this.state.virtualScreen.width!=t.x||this.state.virtualScreen.height!=t.y)&&Mn(o,this.state.virtualScreen,Qn,t.x,t.y),this.useVirtualScreen(),o.viewport(0,0,t.x,t.y),this.state.fontSpriteProgram.render({rows:r,cols:n,narrowFont:this.state.narrowFontTexture,squareFont:this.state.squareFontTexture,palette:this.state.palette,charsTable:this.state.charsTable.texture,backgroundColorTable:this.state.bgColorTable.texture,foregroundColorTable:this.state.fgColorTable.texture}),this.useRealScreen();let c=o.canvas.width/this.state.virtualScreen.width,a=o.canvas.height/this.state.virtualScreen.height,i=Math.floor(Math.max(1,Math.min(c,a)));this.state.virtualScreenProgram.render(this.state.virtualScreen.attachments[0],xt.scalarMult(t,i),t)}}});var ii=to(eo=>{fr();Jn();he();var yt=document.getElementById("canvas");fetch("./manifest.json").then(e=>e.json()).then(e=>si(e));var si=e=>Ge(eo,null,function*(){if(e.manifestVersion==null)throw console.log(e),new Error("Manifest version not specified");if(e.manifestVersion>1)throw console.log(e),new Error("Only manifest version 1 is currently supported");let t=new tr(yt,e.fonts,e.palette,e.postProcessing!==!1),r=yield Ae.load(e.program),n=!1;document.addEventListener("keydown",i=>{e.inputMappings.forEach(s=>{s.keys.includes(i.key)&&r.setInput(s.address,1)}),i.key,console.log(i.key)}),document.addEventListener("keyup",i=>{e.inputMappings.forEach(s=>{s.keys.includes(i.key)&&r.setInput(s.address,0)}),i.key});let o=0,c,a=i=>{if(n){requestAnimationFrame(a);return}let s;c==null||i==null?s=.016:s=(i-c)/1e3,c=i,r.tick(s);let u=!1;o%10===0&&(u=vn(yt,window.devicePixelRatio||1));let m=r.config,x=r.screen,f=r.bgColors,y=r.fgColors;y.update&&t.state.fgColorTable.updateWithColorData(m.cols,m.rows,y.cells),f.update&&t.state.bgColorTable.updateWithColorData(m.cols,m.rows,f.cells),x.update&&t.state.charsTable.updateWithCharData(m.cols,m.rows,x.cells);let l={x:m.cols*e.fonts.gridSize.width,y:m.rows*e.fonts.gridSize.height};(x.update||f.update||y.update||u)&&(t.render(l,m.rows,m.cols),t.state.gl.finish(),y.update=!1,f.update=!1,x.update=!1),o+=1,requestAnimationFrame(a)};a(),yt.addEventListener("dblclick",()=>{yt.requestFullscreen()})})});ii();})();
/* @license twgl.js 4.21.2 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
