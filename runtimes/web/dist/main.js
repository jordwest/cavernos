parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"FpUS":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(t){s(t)}}function a(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}u((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(a){s=[6,a],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScreenData=exports.WasmProgram=void 0;var r=function(e){return"number"==typeof e?e:e.value},n=0,o=n+256,s=o+256,i=s+2560,a=i+65536,u=a+65536,c=function(){function s(e){this.state=e,this.appStateAddr=this.state.exports.init(this.osAddr)}return s.load=function(r){return e(this,void 0,void 0,function(){var e,n,o,i,a,u,c;return t(this,function(t){switch(t.label){case 0:return e={env:{prn:function(e,t){var r=n.exports,o=new Uint8ClampedArray(r.memory.buffer,e,t),s=new TextDecoder("utf8");console.info(s.decode(o))}}},null==WebAssembly.instantiateStreaming?[3,2]:[4,WebAssembly.instantiateStreaming(fetch(r),e)];case 1:return i=t.sent(),n=i.instance,[3,6];case 2:return[4,fetch(r)];case 3:return o=t.sent(),u=(a=WebAssembly).instantiate,[4,o.arrayBuffer()];case 4:return[4,u.apply(a,[t.sent(),e])];case 5:i=t.sent(),n=i.instance,t.label=6;case 6:return c=n.exports,console.log("exports",Object.keys(c)),[2,new s({instance:n,exports:c})]}})})},Object.defineProperty(s.prototype,"osAddr",{get:function(){return r(this.state.exports.OS)},enumerable:!1,configurable:!0}),s.prototype.tick=function(e){this.state.exports.frame(this.osAddr,this.appStateAddr,e)},s.prototype.setInput=function(e,t){var n=r(this.state.exports.OS)+o;new DataView(this.state.exports.memory.buffer,n).setUint8(e,t)},Object.defineProperty(s.prototype,"config",{get:function(){var e=new DataView(this.state.exports.memory.buffer,r(this.state.exports.OS)+n,2);return{cols:e.getUint8(0),rows:e.getUint8(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"screen",{get:function(){return new f(this.state.exports.OS,i,this.state.exports.memory.buffer,this.config.cols,this.config.rows)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"bgColors",{get:function(){return new f(this.state.exports.OS,a,this.state.exports.memory.buffer,this.config.cols,this.config.rows)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fgColors",{get:function(){return new f(this.state.exports.OS,u,this.state.exports.memory.buffer,this.config.cols,this.config.rows)},enumerable:!1,configurable:!0}),s}();exports.WasmProgram=c;var f=function(){function e(e,t,n,o,s){var i=r(e)+t;this.updateView=new DataView(n,i,1),this.cells=new DataView(n,i+1,s*o)}return Object.defineProperty(e.prototype,"update",{get:function(){return this.updateView.getUint8(0)>0},set:function(e){this.updateView.setUint8(0,e?1:0)},enumerable:!1,configurable:!0}),e}();exports.ScreenData=f;
},{}],"e29r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addExtensionsToContext=qu,exports.attributes=void 0,exports.bindFramebufferInfo=Uu,exports.bindTransformFeedbackInfo=ks,exports.bindUniformBlock=Ws,exports.canFilter=Wo,exports.canGenerateMipmap=Go,exports.createAttribsFromArrays=at,exports.createAttributeSetters=Hs,exports.createBufferFromArray=pt,exports.createBufferFromTypedArray=Qe,exports.createBufferInfoFromArrays=mt,exports.createBuffersFromArrays=dt,exports.createFramebufferInfo=Ru,exports.createProgram=Ts,exports.createProgramFromScripts=_s,exports.createProgramFromSources=Ss,exports.createProgramInfo=Js,exports.createProgramInfoFromProgram=Ks,exports.createSampler=ei,exports.createSamplers=ti,exports.createTexture=Fi,exports.createTextures=vi,exports.createTransformFeedback=Us,exports.createTransformFeedbackInfo=Rs,exports.createUniformBlockInfo=Gs,exports.createUniformBlockInfoFromProgram=Vs,exports.createUniformBlockSpecFromProgram=Os,exports.createUniformSetters=Ms,exports.createVAOAndSetAttributes=ju,exports.createVAOFromBufferInfo=Vu,exports.createVertexArrayInfo=Du,exports.draw=void 0,exports.drawBufferInfo=nu,exports.drawObjectList=ou,exports.framebuffers=void 0,exports.getArray_=et,exports.getBytesPerElementForInternalFormat=Do,exports.getContext=Ku,exports.getFormatAndTypeForInternalFormat=jo,exports.getGLTypeForTypedArray=Ae,exports.getGLTypeForTypedArrayType=we,exports.getNumComponentsForFormat=$o,exports.getNumComponents_=ot,exports.getTypedArrayTypeForGLType=ve,exports.getWebGLContext=Qu,exports.isArrayBuffer=exports.glEnumToString=void 0,exports.isWebGL1=Ar,exports.isWebGL2=Fr,exports.loadTextureFromUrl=bi,exports.programs=exports.primitives=exports.m4=void 0,exports.resizeCanvasToDisplaySize=Ju,exports.resizeFramebufferInfo=ku,exports.resizeTexture=Ai,exports.setAttribInfoBufferFromArray=st,exports.setAttributeDefaults_=qe,exports.setAttributePrefix=Ye,exports.setAttributes=Qs,exports.setBlockUniforms=Ns,exports.setBuffersAndAttributes=Zs,exports.setDefaultTextureColor=Yo,exports.setDefaults=$u,exports.setEmptyTexture=gi,exports.setSamplerParameters=Jo,exports.setTextureDefaults_=qo,exports.setTextureFilteringForSize=ni,exports.setTextureFromArray=hi,exports.setTextureFromElement=si,exports.setTextureParameters=Ko,exports.setUniformBlock=$s,exports.setUniforms=Ys,exports.vertexArrays=exports.v3=exports.utils=exports.typedarrays=exports.textures=exports.setUniformsAndBindTextures=void 0;let e=Float32Array;function t(t){const r=e;return e=t,r}function r(t,r,n){const o=new e(3);return t&&(o[0]=t),r&&(o[1]=r),n&&(o[2]=n),o}function n(t,r,n){return(n=n||new e(3))[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function o(t,r,n){return(n=n||new e(3))[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n}function i(t,r,n,o){return(o=o||new e(3))[0]=t[0]+n*(r[0]-t[0]),o[1]=t[1]+n*(r[1]-t[1]),o[2]=t[2]+n*(r[2]-t[2]),o}function a(t,r,n,o){return(o=o||new e(3))[0]=t[0]+n[0]*(r[0]-t[0]),o[1]=t[1]+n[1]*(r[1]-t[1]),o[2]=t[2]+n[2]*(r[2]-t[2]),o}function s(t,r,n){return(n=n||new e(3))[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n}function u(t,r,n){return(n=n||new e(3))[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n}function c(t,r,n){return(n=n||new e(3))[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function f(t,r,n){return(n=n||new e(3))[0]=t[0]/r,n[1]=t[1]/r,n[2]=t[2]/r,n}function l(t,r,n){n=n||new e(3);const o=t[2]*r[0]-t[0]*r[2],i=t[0]*r[1]-t[1]*r[0];return n[0]=t[1]*r[2]-t[2]*r[1],n[1]=o,n[2]=i,n}function m(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function p(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function d(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function b(e,t){const r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(r*r+n*n+o*o)}function y(e,t){const r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return r*r+n*n+o*o}function x(t,r){r=r||new e(3);const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.sqrt(n);return o>1e-5?(r[0]=t[0]/o,r[1]=t[1]/o,r[2]=t[2]/o):(r[0]=0,r[1]=0,r[2]=0),r}function h(t,r){return(r=r||new e(3))[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function g(t,r){return(r=r||new e(3))[0]=t[0],r[1]=t[1],r[2]=t[2],r}function F(t,r,n){return(n=n||new e(3))[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n}function A(t,r,n){return(n=n||new e(3))[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n}var w=Object.freeze({__proto__:null,add:n,copy:g,create:r,cross:l,distance:b,distanceSq:y,divide:A,divScalar:f,dot:m,lerp:i,lerpV:a,length:p,lengthSq:d,max:s,min:u,mulScalar:c,multiply:F,negate:h,normalize:x,setDefaultType:t,subtract:o});exports.v3=w;let v,E,T,P=Float32Array;function _(e){const t=P;return P=e,t}function S(e,t){return(t=t||new P(16))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t}function B(e,t){return(t=t||new P(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function I(e){return(e=e||new P(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function z(e,t){if((t=t||new P(16))===e){let r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t}const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],f=e[8],l=e[9],m=e[10],p=e[11],d=e[12],b=e[13],y=e[14],x=e[15];return t[0]=r,t[1]=a,t[2]=f,t[3]=d,t[4]=n,t[5]=s,t[6]=l,t[7]=b,t[8]=o,t[9]=u,t[10]=m,t[11]=y,t[12]=i,t[13]=c,t[14]=p,t[15]=x,t}function C(e,t){t=t||new P(16);const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],f=e[8],l=e[9],m=e[10],p=e[11],d=e[12],b=e[13],y=e[14],x=e[15],h=m*x,g=y*p,F=u*x,A=y*c,w=u*p,v=m*c,E=o*x,T=y*i,_=o*p,S=m*i,B=o*c,I=u*i,z=f*b,C=d*l,M=a*b,R=d*s,k=a*l,U=f*s,O=r*b,L=d*n,D=r*l,j=f*n,V=r*s,G=a*n,W=h*s+A*l+w*b-(g*s+F*l+v*b),$=g*n+E*l+S*b-(h*n+T*l+_*b),N=F*n+T*s+B*b-(A*n+E*s+I*b),X=v*n+_*s+I*l-(w*n+S*s+B*l),Y=1/(r*W+a*$+f*N+d*X);return t[0]=Y*W,t[1]=Y*$,t[2]=Y*N,t[3]=Y*X,t[4]=Y*(g*a+F*f+v*d-(h*a+A*f+w*d)),t[5]=Y*(h*r+T*f+_*d-(g*r+E*f+S*d)),t[6]=Y*(A*r+E*a+I*d-(F*r+T*a+B*d)),t[7]=Y*(w*r+S*a+B*f-(v*r+_*a+I*f)),t[8]=Y*(z*c+R*p+k*x-(C*c+M*p+U*x)),t[9]=Y*(C*i+O*p+j*x-(z*i+L*p+D*x)),t[10]=Y*(M*i+L*c+V*x-(R*i+O*c+G*x)),t[11]=Y*(U*i+D*c+G*p-(k*i+j*c+V*p)),t[12]=Y*(M*m+U*y+C*u-(k*y+z*u+R*m)),t[13]=Y*(D*y+z*o+L*m-(O*m+j*y+C*o)),t[14]=Y*(O*u+G*y+R*o-(V*y+M*o+L*u)),t[15]=Y*(V*m+k*o+j*u-(D*u+G*m+U*o)),t}function M(e,t,r){r=r||new P(16);const n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],f=e[7],l=e[8],m=e[9],p=e[10],d=e[11],b=e[12],y=e[13],x=e[14],h=e[15],g=t[0],F=t[1],A=t[2],w=t[3],v=t[4],E=t[5],T=t[6],_=t[7],S=t[8],B=t[9],I=t[10],z=t[11],C=t[12],M=t[13],R=t[14],k=t[15];return r[0]=n*g+s*F+l*A+b*w,r[1]=o*g+u*F+m*A+y*w,r[2]=i*g+c*F+p*A+x*w,r[3]=a*g+f*F+d*A+h*w,r[4]=n*v+s*E+l*T+b*_,r[5]=o*v+u*E+m*T+y*_,r[6]=i*v+c*E+p*T+x*_,r[7]=a*v+f*E+d*T+h*_,r[8]=n*S+s*B+l*I+b*z,r[9]=o*S+u*B+m*I+y*z,r[10]=i*S+c*B+p*I+x*z,r[11]=a*S+f*B+d*I+h*z,r[12]=n*C+s*M+l*R+b*k,r[13]=o*C+u*M+m*R+y*k,r[14]=i*C+c*M+p*R+x*k,r[15]=a*C+f*M+d*R+h*k,r}function R(e,t,r){return e!==(r=r||I())&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function k(e,t){return(t=t||r())[0]=e[12],t[1]=e[13],t[2]=e[14],t}function U(e,t,n){const o=4*t;return(n=n||r())[0]=e[o+0],n[1]=e[o+1],n[2]=e[o+2],n}function O(e,t,r,n){n!==e&&(n=B(e,n));const o=4*r;return n[o+0]=t[0],n[o+1]=t[1],n[o+2]=t[2],n}function L(e,t,r,n,o){o=o||new P(16);const i=Math.tan(.5*Math.PI-.5*e),a=1/(r-n);return o[0]=i/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+n)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*n*a*2,o[15]=0,o}function D(e,t,r,n,o,i,a){return(a=a||new P(16))[0]=2/(t-e),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(n-r),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2/(o-i),a[11]=0,a[12]=(t+e)/(e-t),a[13]=(n+r)/(r-n),a[14]=(i+o)/(o-i),a[15]=1,a}function j(e,t,r,n,o,i,a){const s=t-e,u=n-r,c=o-i;return(a=a||new P(16))[0]=2*o/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/u,a[6]=0,a[7]=0,a[8]=(e+t)/s,a[9]=(n+r)/u,a[10]=i/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=o*i/c,a[15]=0,a}function V(e,t,n,i){return i=i||new P(16),v=v||r(),E=E||r(),x(o(e,t,T=T||r()),T),x(l(n,T,v),v),x(l(T,v,E),E),i[0]=v[0],i[1]=v[1],i[2]=v[2],i[3]=0,i[4]=E[0],i[5]=E[1],i[6]=E[2],i[7]=0,i[8]=T[0],i[9]=T[1],i[10]=T[2],i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function G(e,t){return(t=t||new P(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function W(e,t,r){r=r||new P(16);const n=t[0],o=t[1],i=t[2],a=e[0],s=e[1],u=e[2],c=e[3],f=e[4],l=e[5],m=e[6],p=e[7],d=e[8],b=e[9],y=e[10],x=e[11],h=e[12],g=e[13],F=e[14],A=e[15];return e!==r&&(r[0]=a,r[1]=s,r[2]=u,r[3]=c,r[4]=f,r[5]=l,r[6]=m,r[7]=p,r[8]=d,r[9]=b,r[10]=y,r[11]=x),r[12]=a*n+f*o+d*i+h,r[13]=s*n+l*o+b*i+g,r[14]=u*n+m*o+y*i+F,r[15]=c*n+p*o+x*i+A,r}function $(e,t){t=t||new P(16);const r=Math.cos(e),n=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N(e,t,r){r=r||new P(16);const n=e[4],o=e[5],i=e[6],a=e[7],s=e[8],u=e[9],c=e[10],f=e[11],l=Math.cos(t),m=Math.sin(t);return r[4]=l*n+m*s,r[5]=l*o+m*u,r[6]=l*i+m*c,r[7]=l*a+m*f,r[8]=l*s-m*n,r[9]=l*u-m*o,r[10]=l*c-m*i,r[11]=l*f-m*a,e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function X(e,t){t=t||new P(16);const r=Math.cos(e),n=Math.sin(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y(e,t,r){r=r||new P(16);const n=e[0],o=e[1],i=e[2],a=e[3],s=e[8],u=e[9],c=e[10],f=e[11],l=Math.cos(t),m=Math.sin(t);return r[0]=l*n-m*s,r[1]=l*o-m*u,r[2]=l*i-m*c,r[3]=l*a-m*f,r[8]=l*s+m*n,r[9]=l*u+m*o,r[10]=l*c+m*i,r[11]=l*f+m*a,e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function q(e,t){t=t||new P(16);const r=Math.cos(e),n=Math.sin(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function H(e,t,r){r=r||new P(16);const n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],f=e[7],l=Math.cos(t),m=Math.sin(t);return r[0]=l*n+m*s,r[1]=l*o+m*u,r[2]=l*i+m*c,r[3]=l*a+m*f,r[4]=l*s-m*n,r[5]=l*u-m*o,r[6]=l*c-m*i,r[7]=l*f-m*a,e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function Q(e,t,r){r=r||new P(16);let n=e[0],o=e[1],i=e[2];const a=Math.sqrt(n*n+o*o+i*i),s=(n/=a)*n,u=(o/=a)*o,c=(i/=a)*i,f=Math.cos(t),l=Math.sin(t),m=1-f;return r[0]=s+(1-s)*f,r[1]=n*o*m+i*l,r[2]=n*i*m-o*l,r[3]=0,r[4]=n*o*m-i*l,r[5]=u+(1-u)*f,r[6]=o*i*m+n*l,r[7]=0,r[8]=n*i*m+o*l,r[9]=o*i*m-n*l,r[10]=c+(1-c)*f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Z(e,t,r,n){n=n||new P(16);let o=t[0],i=t[1],a=t[2];const s=Math.sqrt(o*o+i*i+a*a),u=(o/=s)*o,c=(i/=s)*i,f=(a/=s)*a,l=Math.cos(r),m=Math.sin(r),p=1-l,d=u+(1-u)*l,b=o*i*p+a*m,y=o*a*p-i*m,x=o*i*p-a*m,h=c+(1-c)*l,g=i*a*p+o*m,F=o*a*p+i*m,A=i*a*p-o*m,w=f+(1-f)*l,v=e[0],E=e[1],T=e[2],_=e[3],S=e[4],B=e[5],I=e[6],z=e[7],C=e[8],M=e[9],R=e[10],k=e[11];return n[0]=d*v+b*S+y*C,n[1]=d*E+b*B+y*M,n[2]=d*T+b*I+y*R,n[3]=d*_+b*z+y*k,n[4]=x*v+h*S+g*C,n[5]=x*E+h*B+g*M,n[6]=x*T+h*I+g*R,n[7]=x*_+h*z+g*k,n[8]=F*v+A*S+w*C,n[9]=F*E+A*B+w*M,n[10]=F*T+A*I+w*R,n[11]=F*_+A*z+w*k,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n}function K(e,t){return(t=t||new P(16))[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function J(e,t,r){r=r||new P(16);const n=t[0],o=t[1],i=t[2];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=n*e[3],r[4]=o*e[4],r[5]=o*e[5],r[6]=o*e[6],r[7]=o*e[7],r[8]=i*e[8],r[9]=i*e[9],r[10]=i*e[10],r[11]=i*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function ee(e,t,n){n=n||r();const o=t[0],i=t[1],a=t[2],s=o*e[3]+i*e[7]+a*e[11]+e[15];return n[0]=(o*e[0]+i*e[4]+a*e[8]+e[12])/s,n[1]=(o*e[1]+i*e[5]+a*e[9]+e[13])/s,n[2]=(o*e[2]+i*e[6]+a*e[10]+e[14])/s,n}function te(e,t,n){n=n||r();const o=t[0],i=t[1],a=t[2];return n[0]=o*e[0]+i*e[4]+a*e[8],n[1]=o*e[1]+i*e[5]+a*e[9],n[2]=o*e[2]+i*e[6]+a*e[10],n}function re(e,t,n){n=n||r();const o=C(e),i=t[0],a=t[1],s=t[2];return n[0]=i*o[0]+a*o[1]+s*o[2],n[1]=i*o[4]+a*o[5]+s*o[6],n[2]=i*o[8]+a*o[9]+s*o[10],n}var ne=Object.freeze({__proto__:null,axisRotate:Z,axisRotation:Q,copy:B,frustum:j,getAxis:U,getTranslation:k,identity:I,inverse:C,lookAt:V,multiply:M,negate:S,ortho:D,perspective:L,rotateX:N,rotateY:Y,rotateZ:H,rotationX:$,rotationY:X,rotationZ:q,scale:J,scaling:K,setAxis:O,setDefaultType:_,setTranslation:R,transformDirection:te,transformNormal:re,transformPoint:ee,translate:W,translation:G,transpose:z});exports.m4=ne;const oe=5120,ie=5121,ae=5122,se=5123,ue=5124,ce=5125,fe=5126,le=32819,me=32820,pe=33635,de=5131,be=33640,ye=35899,xe=35902,he=36269,ge=34042,Fe={};{const e=Fe;e[oe]=Int8Array,e[ie]=Uint8Array,e[ae]=Int16Array,e[se]=Uint16Array,e[ue]=Int32Array,e[ce]=Uint32Array,e[fe]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function Ae(e){if(e instanceof Int8Array)return oe;if(e instanceof Uint8Array)return ie;if(e instanceof Uint8ClampedArray)return ie;if(e instanceof Int16Array)return ae;if(e instanceof Uint16Array)return se;if(e instanceof Int32Array)return ue;if(e instanceof Uint32Array)return ce;if(e instanceof Float32Array)return fe;throw new Error("unsupported typed array type")}function we(e){if(e===Int8Array)return oe;if(e===Uint8Array)return ie;if(e===Uint8ClampedArray)return ie;if(e===Int16Array)return ae;if(e===Uint16Array)return se;if(e===Int32Array)return ue;if(e===Uint32Array)return ce;if(e===Float32Array)return fe;throw new Error("unsupported typed array type")}function ve(e){const t=Fe[e];if(!t)throw new Error("unknown gl type");return t}const Ee="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};exports.isArrayBuffer=Ee;var Te=Object.freeze({__proto__:null,getGLTypeForTypedArray:Ae,getGLTypeForTypedArrayType:we,getTypedArrayTypeForGLType:ve,isArrayBuffer:Ee});function Pe(e,t,r){e.forEach(function(e){const n=t[e];void 0!==n&&(r[e]=n)})}function _e(e,t){Object.keys(t).forEach(function(r){t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&(t[r]=e[r])})}function Se(...e){console.error(...e)}function Be(...e){console.warn(...e)}function Ie(e,t){return"undefined"!=typeof WebGLBuffer&&t instanceof WebGLBuffer}function ze(e,t){return"undefined"!=typeof WebGLRenderbuffer&&t instanceof WebGLRenderbuffer}function Ce(e,t){return"undefined"!=typeof WebGLShader&&t instanceof WebGLShader}function Me(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}function Re(e,t){return"undefined"!=typeof WebGLSampler&&t instanceof WebGLSampler}exports.typedarrays=Te;const ke=35044,Ue=34962,Oe=34963,Le=34660,De=5120,je=5121,Ve=5122,Ge=5123,We=5124,$e=5125,Ne=5126,Xe={attribPrefix:""};function Ye(e){Xe.attribPrefix=e}function qe(e){_e(e,Xe)}function He(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||ke)}function Qe(e,t,r,n){if(Ie(e,t))return t;r=r||Ue;const o=e.createBuffer();return He(e,r,o,t,n),o}function Ze(e){return"indices"===e}function Ke(e){return e instanceof Int8Array||e instanceof Uint8Array}function Je(e){return e===Int8Array||e===Uint8Array}function et(e){return e.length?e:e.data}const tt=/coord|texture/i,rt=/color|colour/i;function nt(e,t){let r;if(t%(r=tt.test(e)?2:rt.test(e)?4:3)>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function ot(e,t){return e.numComponents||e.size||nt(t,et(e).length)}function it(e,t){if(Ee(e))return e;if(Ee(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(r=Ze(t)?Uint16Array:Float32Array),new r(e.data)}function at(e,t){const r={};return Object.keys(t).forEach(function(n){if(!Ze(n)){const o=t[n],i=o.attrib||o.name||o.attribName||Xe.attribPrefix+n;if(o.value){if(!Array.isArray(o.value)&&!Ee(o.value))throw new Error("array.value is not array or typedarray");r[i]={value:o.value}}else{let t,a,s,u;if(o.buffer&&o.buffer instanceof WebGLBuffer)t=o.buffer,u=o.numComponents||o.size,a=o.type,s=o.normalize;else if("number"==typeof o||"number"==typeof o.data){const r=o.data||o,i=o.type||Float32Array,c=r*i.BYTES_PER_ELEMENT;a=we(i),s=void 0!==o.normalize?o.normalize:Je(i),u=o.numComponents||o.size||nt(n,r),t=e.createBuffer(),e.bindBuffer(Ue,t),e.bufferData(Ue,c,o.drawType||ke)}else{const r=it(o,n);t=Qe(e,r,void 0,o.drawType),a=Ae(r),s=void 0!==o.normalize?o.normalize:Ke(r),u=ot(o,n)}r[i]={buffer:t,numComponents:u,type:a,normalize:s,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}}),e.bindBuffer(Ue,null),r}function st(e,t,r,n){r=it(r),void 0!==n?(e.bindBuffer(Ue,t.buffer),e.bufferSubData(Ue,n,r)):He(e,Ue,t.buffer,r,t.drawType)}function ut(e,t){return t===De?1:t===je?1:t===Ve?2:t===Ge?2:t===We?4:t===$e?4:t===Ne?4:0}const ct=["position","positions","a_position"];function ft(e){let t,r;for(r=0;r<ct.length&&!((t=ct[r])in e);++r);r===ct.length&&(t=Object.keys(e)[0]);const n=e[t],o=et(n).length,i=ot(n,t),a=o/i;if(o%i>0)throw new Error(`numComponents ${i} not correct for length ${o}`);return a}function lt(e,t){let r,n;for(n=0;n<ct.length&&!((r=ct[n])in t)&&!((r=Xe.attribPrefix+r)in t);++n);n===ct.length&&(r=Object.keys(t)[0]);const o=t[r];e.bindBuffer(Ue,o.buffer);const i=e.getBufferParameter(Ue,Le);e.bindBuffer(Ue,null);const a=i/ut(e,o.type),s=o.numComponents||o.size,u=a/s;if(u%1!=0)throw new Error(`numComponents ${s} not correct for length ${length}`);return u}function mt(e,t,r){const n=at(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);const i=t.indices;if(i){const t=it(i,"indices");o.indices=Qe(e,t,Oe),o.numElements=t.length,o.elementType=Ae(t)}else o.numElements||(o.numElements=lt(e,o.attribs));return o}function pt(e,t,r){const n="indices"===r?Oe:Ue;return Qe(e,it(t,r),n)}function dt(e,t){const r={};return Object.keys(t).forEach(function(n){r[n]=pt(e,t[n],n)}),t.indices?(r.numElements=t.indices.length,r.elementType=Ae(it(t.indices))):r.numElements=ft(t),r}var bt=Object.freeze({__proto__:null,createAttribsFromArrays:at,createBuffersFromArrays:dt,createBufferFromArray:pt,createBufferFromTypedArray:Qe,createBufferInfoFromArrays:mt,setAttribInfoBufferFromArray:st,setAttributePrefix:Ye,setAttributeDefaults_:qe,getNumComponents_:ot,getArray_:et});exports.attributes=bt;const yt=et,xt=ot;function ht(e,t){let r=0;return e.push=function(){for(let t=0;t<arguments.length;++t){const n=arguments[t];if(n instanceof Array||Ee(n))for(let t=0;t<n.length;++t)e[r++]=n[t];else e[r++]=n}},e.reset=function(e){r=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function gt(e,t,r){return ht(new(r||Float32Array)(e*t),e)}function Ft(e){return"indices"!==e}function At(e){const t=e.indices,r={},n=t.length;return Object.keys(e).filter(Ft).forEach(function(o){const i=e[o],a=i.numComponents,s=gt(a,n,i.constructor);for(let e=0;e<n;++e){const r=t[e]*a;for(let e=0;e<a;++e)s.push(i[r+e])}r[o]=s}),r}function wt(e){if(e.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");const t=e.normal,r=t.length;for(let n=0;n<r;n+=9){const e=t[n+0],r=t[n+1],o=t[n+2],i=t[n+3],a=t[n+4],s=t[n+5];let u=e+i+t[n+6],c=r+a+t[n+7],f=o+s+t[n+8];const l=Math.sqrt(u*u+c*c+f*f);u/=l,c/=l,f/=l,t[n+0]=u,t[n+1]=c,t[n+2]=f,t[n+3]=u,t[n+4]=c,t[n+5]=f,t[n+6]=u,t[n+7]=c,t[n+8]=f}return e}function vt(e,t,r){const n=e.length,o=new Float32Array(3);for(let i=0;i<n;i+=3)r(t,[e[i],e[i+1],e[i+2]],o),e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2]}function Et(e,t,n){n=n||r();const o=t[0],i=t[1],a=t[2];return n[0]=o*e[0]+i*e[1]+a*e[2],n[1]=o*e[4]+i*e[5]+a*e[6],n[2]=o*e[8]+i*e[9]+a*e[10],n}function Tt(e,t){return vt(e,t,te),e}function Pt(e,t){return vt(e,C(t),Et),e}function _t(e,t){return vt(e,t,ee),e}function St(e,t){return Object.keys(e).forEach(function(r){const n=e[r];r.indexOf("pos")>=0?_t(n,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?Tt(n,t):r.indexOf("norm")>=0&&Pt(n,t)}),e}function Bt(e,t,r){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(r=r||0)+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function It(e,t,r,n,o){e=e||1,t=t||1,r=r||1,n=n||1,o=o||I();const i=(r+1)*(n+1),a=gt(3,i),s=gt(3,i),u=gt(2,i);for(let l=0;l<=n;l++)for(let o=0;o<=r;o++){const i=o/r,c=l/n;a.push(e*i-.5*e,0,t*c-.5*t),s.push(0,1,0),u.push(i,c)}const c=r+1,f=gt(3,r*n*2,Uint16Array);for(let l=0;l<n;l++)for(let e=0;e<r;e++)f.push((l+0)*c+e,(l+1)*c+e,(l+0)*c+e+1),f.push((l+1)*c+e,(l+1)*c+e+1,(l+0)*c+e+1);return St({position:a,normal:s,texcoord:u,indices:f},o)}function zt(e,t,r,n,o,i,a){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");n=n||0,i=i||0;const s=(o=o||Math.PI)-n,u=(a=a||2*Math.PI)-i,c=(t+1)*(r+1),f=gt(3,c),l=gt(3,c),m=gt(2,c);for(let b=0;b<=r;b++)for(let o=0;o<=t;o++){const a=o/t,c=b/r,p=u*a+i,d=s*c+n,y=Math.sin(p),x=Math.cos(p),h=Math.sin(d),g=x*h,F=Math.cos(d),A=y*h;f.push(e*g,e*F,e*A),l.push(g,F,A),m.push(1-a,c)}const p=t+1,d=gt(3,t*r*2,Uint16Array);for(let b=0;b<t;b++)for(let e=0;e<r;e++)d.push((e+0)*p+b,(e+0)*p+b+1,(e+1)*p+b),d.push((e+1)*p+b,(e+0)*p+b+1,(e+1)*p+b+1);return{position:f,normal:l,texcoord:m,indices:d}}const Ct=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function Mt(e){const t=(e=e||1)/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],i=gt(3,24),a=gt(3,24),s=gt(2,24),u=gt(3,12,Uint16Array);for(let c=0;c<6;++c){const e=Ct[c];for(let u=0;u<4;++u){const t=r[e[u]],f=n[c],l=o[u];i.push(t),a.push(f),s.push(l)}const t=4*c;u.push(t+0,t+1,t+2),u.push(t+0,t+2,t+3)}return{position:i,normal:a,texcoord:s,indices:u}}function Rt(e,t,r,n,o,i,a){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");const s=void 0===i||i,u=void 0===a||a,c=(s?2:0)+(u?2:0),f=(n+1)*(o+1+c),l=gt(3,f),m=gt(3,f),p=gt(2,f),d=gt(3,n*(o+c/2)*2,Uint16Array),b=n+1,y=Math.atan2(e-t,r),x=Math.cos(y),h=Math.sin(y),g=o+(u?2:0);for(let F=s?-2:0;F<=g;++F){let i,a=F/o,s=r*a;F<0?(s=0,a=1,i=e):F>o?(s=r,a=1,i=t):i=e+F/o*(t-e),-2!==F&&F!==o+2||(i=0,a=0),s-=r/2;for(let e=0;e<b;++e){const t=Math.sin(e*Math.PI*2/n),r=Math.cos(e*Math.PI*2/n);l.push(t*i,s,r*i),F<0?m.push(0,-1,0):F>o?m.push(0,1,0):0===i?m.push(0,0,0):m.push(t*x,h,r*x),p.push(e/n,1-a)}}for(let F=0;F<o+c;++F)if(!(1===F&&s||F===o+c-2&&u))for(let e=0;e<n;++e)d.push(b*(F+0)+0+e,b*(F+0)+1+e,b*(F+1)+1+e),d.push(b*(F+0)+0+e,b*(F+1)+1+e,b*(F+1)+0+e);return{position:l,normal:m,texcoord:p,indices:d}}function kt(e,t){t=t||[];const r=[];for(let n=0;n<e.length;n+=4){const o=e[n],i=e.slice(n+1,n+4);i.push.apply(i,t);for(let e=0;e<o;++e)r.push.apply(r,i)}return r}function Ut(){const e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=kt([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),r=kt([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),n=e.length/3,o={position:gt(3,n),texcoord:gt(2,n),normal:gt(3,n),color:gt(4,n,Uint8Array),indices:gt(3,n/3,Uint16Array)};o.position.push(e),o.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),o.normal.push(t),o.color.push(r);for(let i=0;i<n;++i)o.indices.push(i);return o}function Ot(e,t,r,o,i,a,s){if(i<=0)throw new Error("subdivisionDown must be > 0");const u=2,c=(s=s||1)-(a=a||0),f=2*(i+1)*(2+u),l=gt(3,f),m=gt(3,f),p=gt(2,f);function d(e,t,r){return e+(t-e)*r}function b(t,r,s,f,b,y){for(let x=0;x<=i;x++){const h=r/(u-1),g=x/i,A=2*(h-.5),w=(a+g*c)*Math.PI,v=Math.sin(w),E=Math.cos(w),T=d(e,t,v),P=A*o,_=E*e,S=v*T;l.push(P,_,S);const B=n(F([0,v,E],s),f);m.push(B),p.push(h*b+y,g)}}for(let n=0;n<u;n++){const e=2*(n/(u-1)-.5);b(t,n,[1,1,1],[0,0,0],1,0),b(t,n,[0,0,0],[e,0,0],0,0),b(r,n,[1,1,1],[0,0,0],1,0),b(r,n,[0,0,0],[e,0,0],0,1)}const y=gt(3,2*i*(2+u),Uint16Array);function x(e,t){for(let r=0;r<i;++r)y.push(e+r+0,e+r+1,t+r+0),y.push(e+r+1,t+r+1,t+r+0)}const h=i+1;return x(0*h,4*h),x(5*h,7*h),x(6*h,2*h),x(3*h,1*h),{position:l,normal:m,texcoord:p,indices:y}}function Lt(e,t,r,n,o,i){return Rt(e,e,t,r,n,o,i)}function Dt(e,t,r,n,o,i){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0;const a=(i=i||2*Math.PI)-o,s=r+1,u=n+1,c=s*u,f=gt(3,c),l=gt(3,c),m=gt(2,c),p=gt(3,r*n*2,Uint16Array);for(let d=0;d<u;++d){const i=d/n,u=i*Math.PI*2,c=Math.sin(u),p=e+c*t,b=Math.cos(u),y=b*t;for(let e=0;e<s;++e){const t=e/r,n=o+t*a,s=Math.sin(n),u=Math.cos(n),d=s*p,x=u*p,h=s*c,g=u*c;f.push(d,y,x),l.push(h,b,g),m.push(t,1-i)}}for(let d=0;d<n;++d)for(let e=0;e<r;++e){const t=1+e,r=1+d;p.push(s*d+e,s*r+e,s*d+t),p.push(s*r+e,s*r+t,s*d+t)}return{position:f,normal:l,texcoord:m,indices:p}}function jt(e,t,r,n,o){if(t<3)throw new Error("divisions must be at least 3");o=o||1,n=n||0;const i=(t+1)*((r=r||1)+1),a=gt(3,i),s=gt(3,i),u=gt(2,i),c=gt(3,r*t*2,Uint16Array);let f=0;const l=e-n,m=t+1;for(let p=0;p<=r;++p){const e=n+l*Math.pow(p/r,o);for(let n=0;n<=t;++n){const o=2*Math.PI*n/t,i=e*Math.cos(o),l=e*Math.sin(o);if(a.push(i,0,l),s.push(0,1,0),u.push(1-n/t,p/r),p>0&&n!==t){const e=f+(n+1),t=f+n,r=f+n-m,o=f+(n+1)-m;c.push(e,t,r),c.push(e,r,o)}}f+=t+1}return{position:a,normal:s,texcoord:u,indices:c}}function Vt(e){return Math.random()*e|0}function Gt(e,t){t=t||{};const r=e.position.numElements,n=gt(4,r,Uint8Array),o=t.rand||function(e,t){return t<3?Vt(256):255};if(e.color=n,e.indices)for(let i=0;i<r;++i)n.push(o(i,0),o(i,1),o(i,2),o(i,3));else{const e=t.vertsPerColor||3,i=r/e;for(let t=0;t<i;++t){const r=[o(t,0),o(t,1),o(t,2),o(t,3)];for(let t=0;t<e;++t)n.push(r)}}return e}function Wt(e){return function(t){return dt(t,e.apply(this,Array.prototype.slice.call(arguments,1)))}}function $t(e){return function(t){return mt(t,e.apply(null,Array.prototype.slice.call(arguments,1)))}}const Nt=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function Xt(e,t,r,n){n=n||0;const o=e.length;for(let i=0;i<o;++i)t[r+i]=e[i]+n}function Yt(e,t){const r=yt(e),n=new r.constructor(t);let o=n;return r.numComponents&&r.numElements&&ht(n,r.numComponents),e.data&&Pe(Nt,e,o={data:n}),o}function qt(e){const t={};let r;for(let i=0;i<e.length;++i){const n=e[i];Object.keys(n).forEach(function(e){t[e]||(t[e]=[]),r||"indices"===e||(r=e);const o=n[e],i=xt(o,e),a=yt(o).length/i;t[e].push(a)})}const n=t[r],o={};return Object.keys(t).forEach(function(t){const r=function(t){let r,n=0;for(let o=0;o<e.length;++o){const i=e[o][t];n+=yt(i).length,r&&!i.data||(r=i)}return{length:n,spec:r}}(t),i=Yt(r.spec,r.length);!function(t,r,n){let o=0,i=0;for(let a=0;a<e.length;++a){const s=e[a][t],u=yt(s);"indices"===t?(Xt(u,n,i,o),o+=r[a]):Xt(u,n,i),i+=u.length}}(t,n,yt(i)),o[t]=i}),o}function Ht(e){const t={};return Object.keys(e).forEach(function(r){const n=e[r],o=yt(n),i=Yt(n,o.length);Xt(o,yt(i),0),t[r]=i}),t}const Qt=$t(Ut),Zt=Wt(Ut),Kt=$t(Mt),Jt=Wt(Mt),er=$t(It),tr=Wt(It),rr=$t(zt),nr=Wt(zt),or=$t(Rt),ir=Wt(Rt),ar=$t(Bt),sr=Wt(Bt),ur=$t(Ot),cr=Wt(Ot),fr=$t(Lt),lr=Wt(Lt),mr=$t(Dt),pr=Wt(Dt),dr=$t(jt),br=Wt(jt),yr=ur,xr=cr,hr=Ot;var gr=Object.freeze({__proto__:null,create3DFBufferInfo:Qt,create3DFBuffers:Zt,create3DFVertices:Ut,createAugmentedTypedArray:gt,createCubeBufferInfo:Kt,createCubeBuffers:Jt,createCubeVertices:Mt,createPlaneBufferInfo:er,createPlaneBuffers:tr,createPlaneVertices:It,createSphereBufferInfo:rr,createSphereBuffers:nr,createSphereVertices:zt,createTruncatedConeBufferInfo:or,createTruncatedConeBuffers:ir,createTruncatedConeVertices:Rt,createXYQuadBufferInfo:ar,createXYQuadBuffers:sr,createXYQuadVertices:Bt,createCresentBufferInfo:yr,createCresentBuffers:xr,createCresentVertices:hr,createCrescentBufferInfo:ur,createCrescentBuffers:cr,createCrescentVertices:Ot,createCylinderBufferInfo:fr,createCylinderBuffers:lr,createCylinderVertices:Lt,createTorusBufferInfo:mr,createTorusBuffers:pr,createTorusVertices:Dt,createDiscBufferInfo:dr,createDiscBuffers:br,createDiscVertices:jt,deindexVertices:At,flattenNormals:wt,makeRandomVertexColors:Gt,reorientDirections:Tt,reorientNormals:Pt,reorientPositions:_t,reorientVertices:St,concatVertices:qt,duplicateVertices:Ht});function Fr(e){return!!e.texStorage2D}function Ar(e){return!e.texStorage2D}exports.primitives=gr;const wr=function(){const e={},t={};return function(r,n){return function(r){const n=r.constructor.name;if(!e[n]){for(const e in r)if("number"==typeof r[e]){const n=t[r[e]];t[r[e]]=n?`${n} | ${e}`:e}e[n]=!0}}(r),t[n]||("number"==typeof n?`0x${n.toString(16)}`:n)}}();exports.glEnumToString=wr;var vr=Object.freeze({__proto__:null,glEnumToString:wr,isWebGL1:Ar,isWebGL2:Fr});exports.utils=vr;const Er={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},Tr=Ee,Pr=function(){let e;return function(){return e=e||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null)}}(),_r=6406,Sr=6407,Br=6408,Ir=6409,zr=6410,Cr=6402,Mr=34041,Rr=33071,kr=9728,Ur=9729,Or=3553,Lr=34067,Dr=32879,jr=35866,Vr=34069,Gr=34070,Wr=34071,$r=34072,Nr=34073,Xr=34074,Yr=10241,qr=10240,Hr=10242,Qr=10243,Zr=32882,Kr=33082,Jr=33083,en=33084,tn=33085,rn=3317,nn=3314,on=32878,an=3316,sn=3315,un=32877,cn=37443,fn=37441,ln=37440,mn=33321,pn=36756,dn=33325,bn=33326,yn=33330,xn=33329,hn=33338,gn=33337,Fn=33340,An=33339,wn=33323,vn=36757,En=33327,Tn=33328,Pn=33336,_n=33335,Sn=33332,Bn=33331,In=33334,zn=33333,Cn=32849,Mn=35905,Rn=36194,kn=36758,Un=35898,On=35901,Ln=34843,Dn=34837,jn=36221,Vn=36239,Gn=36215,Wn=36233,$n=36209,Nn=36227,Xn=32856,Yn=35907,qn=36759,Hn=32855,Qn=32854,Zn=32857,Kn=34842,Jn=34836,eo=36220,to=36238,ro=36975,no=36214,oo=36232,io=36226,ao=36208,so=33189,uo=33190,co=36012,fo=36013,lo=35056,mo=5120,po=5121,bo=5122,yo=5123,xo=5124,ho=5125,go=5126,Fo=32819,Ao=32820,wo=33635,vo=5131,Eo=36193,To=33640,Po=35899,_o=35902,So=36269,Bo=34042,Io=33319,zo=33320,Co=6403,Mo=36244,Ro=36248,ko=36249,Uo={};{const e=Uo;e[_r]={numColorComponents:1},e[Ir]={numColorComponents:1},e[zr]={numColorComponents:2},e[Sr]={numColorComponents:3},e[Br]={numColorComponents:4},e[Co]={numColorComponents:1},e[Mo]={numColorComponents:1},e[Io]={numColorComponents:2},e[zo]={numColorComponents:2},e[Sr]={numColorComponents:3},e[Ro]={numColorComponents:3},e[Br]={numColorComponents:4},e[ko]={numColorComponents:4},e[Cr]={numColorComponents:1},e[Mr]={numColorComponents:2}}let Oo;function Lo(e){if(!Oo){const e={};e[_r]={textureFormat:_r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[po,vo,Eo,go]},e[Ir]={textureFormat:Ir,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[po,vo,Eo,go]},e[zr]={textureFormat:zr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[po,vo,Eo,go]},e[Sr]={textureFormat:Sr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[po,vo,Eo,go,wo]},e[Br]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[po,vo,Eo,go,Fo,Ao]},e[Cr]={textureFormat:Cr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ho,yo]},e[mn]={textureFormat:Co,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[po]},e[pn]={textureFormat:Co,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[mo]},e[dn]={textureFormat:Co,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[go,vo]},e[bn]={textureFormat:Co,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[go]},e[yn]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[po]},e[xn]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[mo]},e[Sn]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[yo]},e[Bn]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[bo]},e[In]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ho]},e[zn]={textureFormat:Mo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[xo]},e[wn]={textureFormat:Io,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[po]},e[vn]={textureFormat:Io,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[mo]},e[En]={textureFormat:Io,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[go,vo]},e[Tn]={textureFormat:Io,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[go]},e[Pn]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[po]},e[_n]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[mo]},e[hn]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[yo]},e[gn]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[bo]},e[Fn]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ho]},e[An]={textureFormat:zo,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[xo]},e[Cn]={textureFormat:Sr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[po]},e[Mn]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[po]},e[Rn]={textureFormat:Sr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[po,wo]},e[kn]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[mo]},e[Un]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[go,vo,Po]},e[On]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[go,vo,_o]},e[Ln]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[go,vo]},e[Dn]={textureFormat:Sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[go]},e[jn]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[po]},e[Vn]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[mo]},e[Gn]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[yo]},e[Wn]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[bo]},e[$n]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ho]},e[Nn]={textureFormat:Ro,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[xo]},e[Xn]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[po]},e[Yn]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[po]},e[qn]={textureFormat:Br,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[mo]},e[Hn]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[po,Ao,To]},e[Qn]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[po,Fo]},e[Zn]={textureFormat:Br,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[To]},e[Kn]={textureFormat:Br,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[go,vo]},e[Jn]={textureFormat:Br,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[go]},e[eo]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[po]},e[to]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[mo]},e[ro]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[To]},e[no]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[yo]},e[oo]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[bo]},e[io]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[xo]},e[ao]={textureFormat:ko,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ho]},e[so]={textureFormat:Cr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[yo,ho]},e[uo]={textureFormat:Cr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ho]},e[co]={textureFormat:Cr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[go]},e[lo]={textureFormat:Mr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Bo]},e[fo]={textureFormat:Mr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[So]},Object.keys(e).forEach(function(t){const r=e[t];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(e,t){const n=r.type[t];r.bytesPerElementMap[n]=e})}),Oo=e}return Oo[e]}function Do(e,t){const r=Lo(e);if(!r)throw"unknown internal format";const n=r.bytesPerElementMap[t];if(void 0===n)throw"unknown internal format";return n}function jo(e){const t=Lo(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function Vo(e){return 0==(e&e-1)}function Go(e,t,r,n){if(!Fr(e))return Vo(t)&&Vo(r);const o=Lo(n);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function Wo(e){const t=Lo(e);if(!t)throw"unknown internal format";return t.textureFilterable}function $o(e){const t=Uo[e];if(!t)throw"unknown format: "+e;return t.numColorComponents}function No(e,t,r){return Tr(t)?Ae(t):r||po}function Xo(e,t,r,n,o){if(o%1!=0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=o/n)%1)throw"can't guess dimensions"}else if((n=o/r)%1)throw"can't guess dimensions"}else{const e=Math.sqrt(o/(t===Lr?6:1));e%1==0?(r=e,n=e):(r=o,n=1)}return{width:r,height:n}}function Yo(e){Er.textureColor=new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}function qo(e){_e(e,Er),e.textureColor&&Yo(e.textureColor)}function Ho(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(cn,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(fn,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(ln,t.flipY)}function Qo(e){e.pixelStorei(rn,4),Fr(e)&&(e.pixelStorei(nn,0),e.pixelStorei(on,0),e.pixelStorei(an,0),e.pixelStorei(sn,0),e.pixelStorei(un,0))}function Zo(e,t,r,n){n.minMag&&(r.call(e,t,Yr,n.minMag),r.call(e,t,qr,n.minMag)),n.min&&r.call(e,t,Yr,n.min),n.mag&&r.call(e,t,qr,n.mag),n.wrap&&(r.call(e,t,Hr,n.wrap),r.call(e,t,Qr,n.wrap),(t===Dr||Re(e,t))&&r.call(e,t,Zr,n.wrap)),n.wrapR&&r.call(e,t,Zr,n.wrapR),n.wrapS&&r.call(e,t,Hr,n.wrapS),n.wrapT&&r.call(e,t,Qr,n.wrapT),n.minLod&&r.call(e,t,Kr,n.minLod),n.maxLod&&r.call(e,t,Jr,n.maxLod),n.baseLevel&&r.call(e,t,en,n.baseLevel),n.maxLevel&&r.call(e,t,tn,n.maxLevel)}function Ko(e,t,r){const n=r.target||Or;e.bindTexture(n,t),Zo(e,n,e.texParameteri,r)}function Jo(e,t,r){Zo(e,t,e.samplerParameteri,r)}function ei(e,t){const r=e.createSampler();return Jo(e,r,t),r}function ti(e,t){const r={};return Object.keys(t).forEach(function(n){r[n]=ei(e,t[n])}),r}function ri(e){return e=e||Er.textureColor,Tr(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}function ni(e,t,r,n,o,i){r=r||Er.textureOptions,i=i||Br;const a=r.target||Or;if(n=n||r.width,o=o||r.height,e.bindTexture(a,t),Go(e,n,o,i))e.generateMipmap(a);else{const t=Wo(i)?Ur:kr;e.texParameteri(a,Yr,t),e.texParameteri(a,qr,t),e.texParameteri(a,Hr,Rr),e.texParameteri(a,Qr,Rr)}}function oi(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function ii(e,t){return(t=t||{}).cubeFaceOrder||[Vr,Gr,Wr,$r,Nr,Xr]}function ai(e,t){const r=ii(e,t).map(function(e,t){return{face:e,ndx:t}});return r.sort(function(e,t){return e.face-t.face}),r}function si(e,t,r,n){const o=(n=n||Er.textureOptions).target||Or,i=n.level||0;let a=r.width,s=r.height;const u=n.internalFormat||n.format||Br,c=jo(u),f=n.format||c.format,l=n.type||c.type;if(Ho(e,n),e.bindTexture(o,t),o===Lr){const c=r.width,m=r.height;let p,d;if(c/6===m)p=m,d=[0,0,1,0,2,0,3,0,4,0,5,0];else if(m/6===c)p=c,d=[0,0,0,1,0,2,0,3,0,4,0,5];else if(c/3==m/2)p=c/3,d=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(c/2!=m/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);p=c/2,d=[0,0,1,0,0,1,1,1,0,2,1,2]}const b=Pr();b?(b.canvas.width=p,b.canvas.height=p,a=p,s=p,ai(e,n).forEach(function(t){const n=d[2*t.ndx+0]*p,o=d[2*t.ndx+1]*p;b.drawImage(r,n,o,p,p,0,0,p,p),e.texImage2D(t.face,i,u,f,l,b.canvas)}),b.canvas.width=1,b.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=p,s=p,ai(e,n).forEach(function(c){const m=d[2*c.ndx+0]*p,b=d[2*c.ndx+1]*p;e.texImage2D(c.face,i,u,p,p,0,f,l,null),createImageBitmap(r,m,b,p,p,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(r){Ho(e,n),e.bindTexture(o,t),e.texImage2D(c.face,i,u,f,l,r),oi(n)&&ni(e,t,n,a,s,u)})}))}else if(o===Dr||o===jr){const t=Math.min(r.width,r.height),n=Math.max(r.width,r.height),a=n/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const s=r.width===n?1:0,c=r.height===n?1:0;e.pixelStorei(rn,1),e.pixelStorei(nn,r.width),e.pixelStorei(on,0),e.pixelStorei(un,0),e.texImage3D(o,i,u,t,t,t,0,f,l,null);for(let u=0;u<a;++u){const n=u*t*s,a=u*t*c;e.pixelStorei(an,n),e.pixelStorei(sn,a),e.texSubImage3D(o,i,0,0,u,t,t,1,f,l,r)}Qo(e)}else e.texImage2D(o,i,u,f,l,r);oi(n)&&ni(e,t,n,a,s,u),Ko(e,t,n)}function ui(){}function ci(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}function fi(e,t){return void 0!==t||ci(e)?t:"anonymous"}function li(e,t,r){let n;if(r=r||ui,t=void 0!==t?t:Er.crossOrigin,t=fi(e,t),"undefined"!=typeof Image){n=new Image,void 0!==t&&(n.crossOrigin=t);const o=function(){n.removeEventListener("error",i),n.removeEventListener("load",a),n=null},i=function(){const t="couldn't load image: "+e;Se(t),r(t,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",i),n.addEventListener("load",a),n.src=e,n}if("undefined"!=typeof ImageBitmap){let o,i;const a=function(){r(o,i)},s={};t&&(s.mode="cors"),fetch(e,s).then(function(e){if(!e.ok)throw e;return e.blob()}).then(function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(e){i=e,setTimeout(a)}).catch(function(e){o=e,setTimeout(a)}),n=null}return n}function mi(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function pi(e,t,r){return mi(e)?(setTimeout(function(){r(null,e)}),e):li(e,t,r)}function di(e,t,r){const n=(r=r||Er.textureOptions).target||Or;if(e.bindTexture(n,t),!1===r.color)return;const o=ri(r.color);if(n===Lr)for(let i=0;i<6;++i)e.texImage2D(Vr+i,0,Br,1,1,0,Br,po,o);else n===Dr||n===jr?e.texImage3D(n,0,Br,1,1,1,0,Br,po,o):e.texImage2D(n,0,Br,1,1,0,Br,po,o)}function bi(e,t,r,n){return n=n||ui,r=r||Er.textureOptions,di(e,t,r),pi((r=Object.assign({},r)).src,r.crossOrigin,function(o,i){o?n(o,t,i):(si(e,t,i,r),n(null,t,i))})}function yi(e,t,r,n){n=n||ui;const o=r.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const i=r.level||0,a=r.internalFormat||r.format||Br,s=jo(a),u=r.format||s.format,c=r.type||po,f=r.target||Or;if(f!==Lr)throw"target must be TEXTURE_CUBE_MAP";di(e,t,r),r=Object.assign({},r);let l=6;const m=[],p=ii(e,r);let d;d=o.map(function(o,s){return pi(o,r.crossOrigin,(b=p[s],function(o,s){--l,o?m.push(o):s.width!==s.height?m.push("cubemap face img is not a square: "+s.src):(Ho(e,r),e.bindTexture(f,t),5===l?ii().forEach(function(t){e.texImage2D(t,i,a,u,c,s)}):e.texImage2D(b,i,a,u,c,s),oi(r)&&e.generateMipmap(f)),0===l&&n(m.length?m:void 0,t,d)}));var b})}function xi(e,t,r,n){n=n||ui;const o=r.src,i=r.internalFormat||r.format||Br,a=jo(i),s=r.format||a.format,u=r.type||po,c=r.target||jr;if(c!==Dr&&c!==jr)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";di(e,t,r),r=Object.assign({},r);let f=o.length;const l=[];let m;const p=r.level||0;let d=r.width,b=r.height;const y=o.length;let x=!0;m=o.map(function(o,a){return pi(o,r.crossOrigin,(h=a,function(o,a){if(--f,o)l.push(o);else{if(Ho(e,r),e.bindTexture(c,t),x){x=!1,d=r.width||a.width,b=r.height||a.height,e.texImage3D(c,p,i,d,b,y,0,s,u,null);for(let t=0;t<y;++t)e.texSubImage3D(c,p,0,0,t,d,b,1,s,u,a)}else{let t,r=a;a.width===d&&a.height===b||(r=(t=Pr()).canvas,t.canvas.width=d,t.canvas.height=b,t.drawImage(a,0,0,d,b)),e.texSubImage3D(c,p,0,0,h,d,b,1,s,u,r),t&&r===t.canvas&&(t.canvas.width=0,t.canvas.height=0)}oi(r)&&e.generateMipmap(c)}0===f&&n(l.length?l:void 0,t,m)}));var h})}function hi(e,t,r,n){const o=(n=n||Er.textureOptions).target||Or;e.bindTexture(o,t);let i=n.width,a=n.height,s=n.depth;const u=n.level||0,c=n.internalFormat||n.format||Br,f=jo(c),l=n.format||f.format,m=n.type||No(e,r,f.type);if(Tr(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{const e=ve(m);r=new e(r)}const p=Do(c,m),d=r.byteLength/p;if(d%1)throw"length wrong size for format: "+wr(e,l);let b;if(o===Dr||o===jr)if(i||a||s)!i||a&&s?!a||i&&s?(b=Xo(e,o,i,a,d/s),i=b.width,a=b.height):(b=Xo(e,o,i,s,d/a),i=b.width,s=b.height):(b=Xo(e,o,a,s,d/i),a=b.width,s=b.height);else{const e=Math.cbrt(d);if(e%1!=0)throw"can't guess cube size of array of numElements: "+d;i=e,a=e,s=e}else b=Xo(e,o,i,a,d),i=b.width,a=b.height;if(Qo(e),e.pixelStorei(rn,n.unpackAlignment||1),Ho(e,n),o===Lr){const t=d/6*(p/r.BYTES_PER_ELEMENT);ai(e,n).forEach(n=>{const o=t*n.ndx,s=r.subarray(o,o+t);e.texImage2D(n.face,u,c,i,a,0,l,m,s)})}else o===Dr||o===jr?e.texImage3D(o,u,c,i,a,s,0,l,m,r):e.texImage2D(o,u,c,i,a,0,l,m,r);return{width:i,height:a,depth:s,type:m}}function gi(e,t,r){const n=r.target||Or;e.bindTexture(n,t);const o=r.level||0,i=r.internalFormat||r.format||Br,a=jo(i),s=r.format||a.format,u=r.type||a.type;if(Ho(e,r),n===Lr)for(let c=0;c<6;++c)e.texImage2D(Vr+c,o,i,r.width,r.height,0,s,u,null);else n===Dr||n===jr?e.texImage3D(n,o,i,r.width,r.height,r.depth,0,s,u,null):e.texImage2D(n,o,i,r.width,r.height,0,s,u,null)}function Fi(e,t,r){r=r||ui,t=t||Er.textureOptions;const n=e.createTexture(),o=t.target||Or;let i=t.width||1,a=t.height||1;const s=t.internalFormat||Br;e.bindTexture(o,n),o===Lr&&(e.texParameteri(o,Hr,Rr),e.texParameteri(o,Qr,Rr));let u=t.src;if(u)if("function"==typeof u&&(u=u(e,t)),"string"==typeof u)bi(e,n,t,r);else if(Tr(u)||Array.isArray(u)&&("number"==typeof u[0]||Array.isArray(u[0])||Tr(u[0]))){const r=hi(e,n,u,t);i=r.width,a=r.height}else Array.isArray(u)&&("string"==typeof u[0]||mi(u[0]))?o===Lr?yi(e,n,t,r):xi(e,n,t,r):(si(e,n,u,t),i=u.width,a=u.height);else gi(e,n,t);return oi(t)&&ni(e,n,t,i,a,s),Ko(e,n,t),n}function Ai(e,t,r,n,o,i){n=n||r.width,o=o||r.height,i=i||r.depth;const a=r.target||Or;e.bindTexture(a,t);const s=r.level||0,u=r.internalFormat||r.format||Br,c=jo(u),f=r.format||c.format;let l;const m=r.src;if(l=m&&(Tr(m)||Array.isArray(m)&&"number"==typeof m[0])?r.type||No(e,m,c.type):r.type||c.type,a===Lr)for(let p=0;p<6;++p)e.texImage2D(Vr+p,s,u,n,o,0,f,l,null);else a===Dr||a===jr?e.texImage3D(a,s,u,n,o,i,0,f,l,null):e.texImage2D(a,s,u,n,o,0,f,l,null)}function wi(e){return"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]}function vi(e,t,r){r=r||ui;let n=0;const o=[],i={},a={};function s(){0===n&&setTimeout(function(){r(o.length?o:void 0,i,a)},0)}return Object.keys(t).forEach(function(r){const u=t[r];let c;wi(u.src)&&(c=function(e,t,i){a[r]=i,--n,e&&o.push(e),s()},++n),i[r]=Fi(e,u,c)}),s(),i}var Ei=Object.freeze({__proto__:null,setTextureDefaults_:qo,createSampler:ei,createSamplers:ti,setSamplerParameters:Jo,createTexture:Fi,setEmptyTexture:gi,setTextureFromArray:hi,loadTextureFromUrl:bi,setTextureFromElement:si,setTextureFilteringForSize:ni,setTextureParameters:Ko,setDefaultTextureColor:Yo,createTextures:vi,resizeTexture:Ai,canGenerateMipmap:Go,canFilter:Wo,getNumComponentsForFormat:$o,getBytesPerElementForInternalFormat:Do,getFormatAndTypeForInternalFormat:jo});exports.textures=Ei;const Ti=Se,Pi=Be;function _i(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}const Si=33984,Bi=35048,Ii=34962,zi=34963,Ci=35345,Mi=35982,Ri=36386,ki=35713,Ui=35714,Oi=35632,Li=35633,Di=35981,ji=35718,Vi=35721,Gi=35971,Wi=35382,$i=35396,Ni=35398,Xi=35392,Yi=35395,qi=5126,Hi=35664,Qi=35665,Zi=35666,Ki=5124,Ji=35667,ea=35668,ta=35669,ra=35670,na=35671,oa=35672,ia=35673,aa=35674,sa=35675,ua=35676,ca=35678,fa=35680,la=35679,ma=35682,pa=35685,da=35686,ba=35687,ya=35688,xa=35689,ha=35690,ga=36289,Fa=36292,Aa=36293,wa=5125,va=36294,Ea=36295,Ta=36296,Pa=36298,_a=36299,Sa=36300,Ba=36303,Ia=36306,za=36307,Ca=36308,Ma=36311,Ra=3553,ka=34067,Ua=32879,Oa=35866,La={};function Da(e,t){return La[t].bindPoint}function ja(e,t){return function(r){e.uniform1f(t,r)}}function Va(e,t){return function(r){e.uniform1fv(t,r)}}function Ga(e,t){return function(r){e.uniform2fv(t,r)}}function Wa(e,t){return function(r){e.uniform3fv(t,r)}}function $a(e,t){return function(r){e.uniform4fv(t,r)}}function Na(e,t){return function(r){e.uniform1i(t,r)}}function Xa(e,t){return function(r){e.uniform1iv(t,r)}}function Ya(e,t){return function(r){e.uniform2iv(t,r)}}function qa(e,t){return function(r){e.uniform3iv(t,r)}}function Ha(e,t){return function(r){e.uniform4iv(t,r)}}function Qa(e,t){return function(r){e.uniform1ui(t,r)}}function Za(e,t){return function(r){e.uniform1uiv(t,r)}}function Ka(e,t){return function(r){e.uniform2uiv(t,r)}}function Ja(e,t){return function(r){e.uniform3uiv(t,r)}}function es(e,t){return function(r){e.uniform4uiv(t,r)}}function ts(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}function rs(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}function ns(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}function os(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}function is(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}function as(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}function ss(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}function us(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}function cs(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}function fs(e,t,r,n){const o=Da(e,t);return Fr(e)?function(t){let i,a;Me(e,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.uniform1i(n,r),e.activeTexture(Si+r),e.bindTexture(o,i),e.bindSampler(r,a)}:function(t){e.uniform1i(n,r),e.activeTexture(Si+r),e.bindTexture(o,t)}}function ls(e,t,r,n,o){const i=Da(e,t),a=new Int32Array(o);for(let s=0;s<o;++s)a[s]=r+s;return Fr(e)?function(t){e.uniform1iv(n,a),t.forEach(function(t,n){let o,s;e.activeTexture(Si+a[n]),Me(e,t)?(o=t,s=null):(o=t.texture,s=t.sampler),e.bindSampler(r,s),e.bindTexture(i,o)})}:function(t){e.uniform1iv(n,a),t.forEach(function(t,r){e.activeTexture(Si+a[r]),e.bindTexture(i,t)})}}function ms(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(Ii,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||qi,r.normalize||!1,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function ps(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(Ii,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||Ki,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function ds(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(Ii,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||wa,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function bs(e,t,r){const n=r.size,o=r.count;return function(r){e.bindBuffer(Ii,r.buffer);const i=r.size||r.numComponents||n,a=i/o,s=r.type||qi,u=La[s].size*i,c=r.normalize||!1,f=r.offset||0,l=u/o;for(let n=0;n<o;++n)e.enableVertexAttribArray(t+n),e.vertexAttribPointer(t+n,a,s,c,u,f+l*n),void 0!==r.divisor&&e.vertexAttribDivisor(t+n,r.divisor)}}La[qi]={Type:Float32Array,size:4,setter:ja,arraySetter:Va},La[35664]={Type:Float32Array,size:8,setter:Ga,cols:2},La[35665]={Type:Float32Array,size:12,setter:Wa,cols:3},La[35666]={Type:Float32Array,size:16,setter:$a,cols:4},La[Ki]={Type:Int32Array,size:4,setter:Na,arraySetter:Xa},La[35667]={Type:Int32Array,size:8,setter:Ya,cols:2},La[35668]={Type:Int32Array,size:12,setter:qa,cols:3},La[35669]={Type:Int32Array,size:16,setter:Ha,cols:4},La[wa]={Type:Uint32Array,size:4,setter:Qa,arraySetter:Za},La[36294]={Type:Uint32Array,size:8,setter:Ka,cols:2},La[36295]={Type:Uint32Array,size:12,setter:Ja,cols:3},La[36296]={Type:Uint32Array,size:16,setter:es,cols:4},La[ra]={Type:Uint32Array,size:4,setter:Na,arraySetter:Xa},La[35671]={Type:Uint32Array,size:8,setter:Ya,cols:2},La[35672]={Type:Uint32Array,size:12,setter:qa,cols:3},La[35673]={Type:Uint32Array,size:16,setter:Ha,cols:4},La[35674]={Type:Float32Array,size:32,setter:ts,rows:2,cols:2},La[35675]={Type:Float32Array,size:48,setter:rs,rows:3,cols:3},La[35676]={Type:Float32Array,size:64,setter:ns,rows:4,cols:4},La[35685]={Type:Float32Array,size:32,setter:os,rows:2,cols:3},La[35686]={Type:Float32Array,size:32,setter:as,rows:2,cols:4},La[35687]={Type:Float32Array,size:48,setter:is,rows:3,cols:2},La[35688]={Type:Float32Array,size:48,setter:us,rows:3,cols:4},La[35689]={Type:Float32Array,size:64,setter:ss,rows:4,cols:2},La[35690]={Type:Float32Array,size:64,setter:cs,rows:4,cols:3},La[35678]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:3553},La[35680]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:34067},La[35679]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:32879},La[35682]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:3553},La[36289]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:35866},La[36292]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:35866},La[36293]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:34067},La[36298]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:3553},La[36299]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:32879},La[36300]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:34067},La[36303]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:35866},La[36306]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:3553},La[36307]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:32879},La[36308]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:34067},La[36311]={Type:null,size:0,setter:fs,arraySetter:ls,bindPoint:35866};const ys={};ys[qi]={size:4,setter:ms},ys[35664]={size:8,setter:ms},ys[35665]={size:12,setter:ms},ys[35666]={size:16,setter:ms},ys[Ki]={size:4,setter:ps},ys[35667]={size:8,setter:ps},ys[35668]={size:12,setter:ps},ys[35669]={size:16,setter:ps},ys[wa]={size:4,setter:ds},ys[36294]={size:8,setter:ds},ys[36295]={size:12,setter:ds},ys[36296]={size:16,setter:ds},ys[ra]={size:4,setter:ps},ys[35671]={size:8,setter:ps},ys[35672]={size:12,setter:ps},ys[35673]={size:16,setter:ps},ys[35674]={size:4,setter:bs,count:2},ys[35675]={size:9,setter:bs,count:3},ys[35676]={size:16,setter:bs,count:4};const xs=/ERROR:\s*\d+:(\d+)/gi;function hs(e,t="",r=0){const n=[...t.matchAll(xs)],o=new Map(n.map((e,r)=>{const o=parseInt(e[1]),i=n[r+1],a=i?i.index:t.length;return[o-1,t.substring(e.index,a)]}));return e.split("\n").map((e,t)=>{const n=o.get(t);return`${t+1+r}: ${e}${n?`\n\n^^^ ${n}`:""}`}).join("\n")}const gs=/^[ \t]*\n/;function Fs(e,t,r,n){const o=n||Ti,i=e.createShader(r);let a=0;if(gs.test(t)&&(a=1,t=t.replace(gs,"")),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,ki)){const n=e.getShaderInfoLog(i);return o(`${hs(t,n,a)}\nError compiling ${wr(e,r)}: ${n}`),e.deleteShader(i),null}return i}function As(e,t,r){let n,o;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;r=t.errorCallback,e=t.attribLocations,n=t.transformFeedbackVaryings,o=t.transformFeedbackMode}const i={errorCallback:r||Ti,transformFeedbackVaryings:n,transformFeedbackMode:o};if(e){let r={};Array.isArray(e)?e.forEach(function(e,n){r[e]=t?t[n]:n}):r=e,i.attribLocations=r}return i}const ws=["VERTEX_SHADER","FRAGMENT_SHADER"];function vs(e,t){return t.indexOf("frag")>=0?Oi:t.indexOf("vert")>=0?Li:void 0}function Es(e,t){t.forEach(function(t){e.deleteShader(t)})}function Ts(e,t,r,n,o){const i=As(r,n,o),a=[],s=[];for(let f=0;f<t.length;++f){let r=t[f];if("string"==typeof r){const t=_i(r),n=t?t.text:r;let o=e[ws[f]];t&&t.type&&(o=vs(e,t.type)||o),r=Fs(e,n,o,i.errorCallback),s.push(r)}Ce(e,r)&&a.push(r)}if(a.length!==t.length)return i.errorCallback("not enough shaders for program"),Es(e,s),null;const u=e.createProgram();a.forEach(function(t){e.attachShader(u,t)}),i.attribLocations&&Object.keys(i.attribLocations).forEach(function(t){e.bindAttribLocation(u,i.attribLocations[t],t)});let c=i.transformFeedbackVaryings;if(c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(u,c,i.transformFeedbackMode||Di)),e.linkProgram(u),!e.getProgramParameter(u,Ui)){const t=e.getProgramInfoLog(u);return i.errorCallback(`${a.map(t=>{const r=hs(e.getShaderSource(t),"",0),n=e.getShaderParameter(t,e.SHADER_TYPE);return`${wr(e,n)}\n${r}}`}).join("\n")}\nError in program linking: ${t}`),e.deleteProgram(u),Es(e,s),null}return u}function Ps(e,t,r,n){let o="";const i=_i(t);if(!i)throw new Error(`unknown script element: ${t}`);o=i.text;const a=r||vs(e,i.type);if(!a)throw new Error("unknown shader type");return Fs(e,o,a,n)}function _s(e,t,r,n,o){const i=As(r,n,o),a=[];for(let s=0;s<t.length;++s){const r=Ps(e,t[s],e[ws[s]],i.errorCallback);if(!r)return null;a.push(r)}return Ts(e,a,i)}function Ss(e,t,r,n,o){const i=As(r,n,o),a=[];for(let s=0;s<t.length;++s){const r=Fs(e,t[s],e[ws[s]],i.errorCallback);if(!r)return null;a.push(r)}return Ts(e,a,i)}function Bs(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}const Is=/(\.|\[|]|\w+)/g,zs=e=>e>="0"&&e<="9";function Cs(e,t,r,n){const o=e.split(Is).filter(e=>""!==e);let i=0,a="";for(;;){const e=o[i++];a+=e;const s=zs(e[0]),u=s?parseInt(e):e;if(s&&(a+=o[i++]),i===o.length){r[u]=t;break}{const e=o[i++],t="["===e,s=r[u]||(t?[]:{});r[u]=s,r=s,n[a]=n[a]||function(e){return function(t){Xs(e,t)}}(s),a+=e}}}function Ms(e,t){let r=0;function n(t,n,o){const i=n.name.endsWith("[0]"),a=n.type,s=La[a];if(!s)throw new Error(`unknown type: 0x${a.toString(16)}`);let u;if(s.bindPoint){const t=r;r+=n.size,u=i?s.arraySetter(e,a,t,o,n.size):s.setter(e,a,t,o,n.size)}else u=s.arraySetter&&i?s.arraySetter(e,o):s.setter(e,o);return u.location=o,u}const o={},i={},a=e.getProgramParameter(t,ji);for(let s=0;s<a;++s){const r=e.getActiveUniform(t,s);if(Bs(r))continue;let a=r.name;a.endsWith("[0]")&&(a=a.substr(0,a.length-3));const u=e.getUniformLocation(t,r.name);if(u){const e=n(0,r,u);o[a]=e,Cs(a,e,i,o)}}return o}function Rs(e,t){const r={},n=e.getProgramParameter(t,Gi);for(let o=0;o<n;++o){const n=e.getTransformFeedbackVarying(t,o);r[n.name]={index:o,type:n.type,size:n.size}}return r}function ks(e,t,r){t.transformFeedbackInfo&&(t=t.transformFeedbackInfo),r.attribs&&(r=r.attribs);for(const n in r){const o=t[n];if(o){const t=r[n];t.offset?e.bindBufferRange(Mi,o.index,t.buffer,t.offset,t.size):e.bindBufferBase(Mi,o.index,t.buffer)}}}function Us(e,t,r){const n=e.createTransformFeedback();return e.bindTransformFeedback(Ri,n),e.useProgram(t.program),ks(e,t,r),e.bindTransformFeedback(Ri,null),n}function Os(e,t){const r=e.getProgramParameter(t,ji),n=[],o=[];for(let s=0;s<r;++s){o.push(s),n.push({});const r=e.getActiveUniform(t,s);n[s].name=r.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){const i=r[0],a=r[1];e.getActiveUniforms(t,o,e[i]).forEach(function(e,t){n[t][a]=e})});const i={},a=e.getProgramParameter(t,Wi);for(let s=0;s<a;++s){const r=e.getActiveUniformBlockName(t,s),n={index:e.getUniformBlockIndex(t,r),usedByVertexShader:e.getActiveUniformBlockParameter(t,s,$i),usedByFragmentShader:e.getActiveUniformBlockParameter(t,s,Ni),size:e.getActiveUniformBlockParameter(t,s,Xi),uniformIndices:e.getActiveUniformBlockParameter(t,s,Yi)};n.used=n.usedByVertexShader||n.usedByFragmentShader,i[r]=n}return{blockSpecs:i,uniformData:n}}const Ls=/\[\d+\]\.$/,Ds=(e,t)=>((e+(t-1))/t|0)*t;function js(e,t,r,n){if(t||r){n=n||1;const t=e.length/4;return function(r){let o=0,i=0;for(let a=0;a<t;++a){for(let t=0;t<n;++t)e[o++]=r[i++];o+=4-n}}}return function(t){t.length?e.set(t):e[0]=t}}function Vs(e,t,r,n){const o=r.blockSpecs,i=r.uniformData,a=o[n];if(!a)return Pi("no uniform block object named:",n),{name:n,uniforms:{}};const s=new ArrayBuffer(a.size),u=e.createBuffer(),c=a.index;e.bindBuffer(Ci,u),e.uniformBlockBinding(t,a.index,c);let f=n+".";Ls.test(f)&&(f=f.replace(Ls,"."));const l={},m={},p={};return a.uniformIndices.forEach(function(e){const t=i[e];let r=t.name;r.startsWith(f)&&(r=r.substr(f.length));const n=r.endsWith("[0]");n&&(r=r.substr(0,r.length-3));const o=La[t.type],a=o.Type,u=n?Ds(o.size,16)*t.size:o.size*t.size,c=new a(s,t.offset,u/a.BYTES_PER_ELEMENT);l[r]=c;const d=js(c,n,o.rows,o.cols);m[r]=d,Cs(r,d,p,m)}),{name:n,array:s,asFloat:new Float32Array(s),buffer:u,uniforms:l,setters:m}}function Gs(e,t,r){return Vs(e,t.program,t.uniformBlockSpec,r)}function Ws(e,t,r){const n=(t.uniformBlockSpec||t).blockSpecs[r.name];if(n){const t=n.index;return e.bindBufferRange(Ci,t,r.buffer,r.offset||0,r.array.byteLength),!0}return!1}function $s(e,t,r){Ws(e,t,r)&&e.bufferData(Ci,r.array,Bi)}function Ns(e,t){const r=e.setters;for(const n in t){const e=r[n];if(e){e(t[n])}}}function Xs(e,t){for(const r in t){const n=e[r];"function"==typeof n?n(t[r]):Xs(e[r],t[r])}}function Ys(e,...t){const r=e.uniformSetters||e,n=t.length;for(let o=0;o<n;++o){const e=t[o];if(Array.isArray(e)){const t=e.length;for(let n=0;n<t;++n)Ys(r,e[n])}else for(const t in e){const n=r[t];n&&n(e[t])}}}const qs=Ys;function Hs(e,t){const r={},n=e.getProgramParameter(t,Vi);for(let o=0;o<n;++o){const n=e.getActiveAttrib(t,o);if(Bs(n))continue;const i=e.getAttribLocation(t,n.name),a=ys[n.type],s=a.setter(e,i,a);s.location=i,r[n.name]=s}return r}function Qs(e,t){for(const r in t){const n=e[r];n&&n(t[r])}}function Zs(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Qs(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(zi,r.indices))}function Ks(e,t){const r={program:t,uniformSetters:Ms(e,t),attribSetters:Hs(e,t)};return Fr(e)&&(r.uniformBlockSpec=Os(e,t),r.transformFeedbackInfo=Rs(e,t)),r}function Js(e,t,r,n,o){const i=As(r,n,o);let a=!0;if(t=t.map(function(e){if(e.indexOf("\n")<0){const t=_i(e);t?e=t.text:(i.errorCallback("no element with id: "+e),a=!1)}return e}),!a)return null;const s=Ss(e,t,i);return s?Ks(e,s):null}exports.setUniformsAndBindTextures=qs;var eu=Object.freeze({__proto__:null,createAttributeSetters:Hs,createProgram:Ts,createProgramFromScripts:_s,createProgramFromSources:Ss,createProgramInfo:Js,createProgramInfoFromProgram:Ks,createUniformSetters:Ms,createUniformBlockSpecFromProgram:Os,createUniformBlockInfoFromProgram:Vs,createUniformBlockInfo:Gs,createTransformFeedback:Us,createTransformFeedbackInfo:Rs,bindTransformFeedbackInfo:ks,setAttributes:Qs,setBuffersAndAttributes:Zs,setUniforms:Ys,setUniformsAndBindTextures:qs,setUniformBlock:$s,setBlockUniforms:Ns,bindUniformBlock:Ws});exports.programs=eu;const tu=4,ru=5123;function nu(e,t,r,n,o,i){r=void 0===r?tu:r;const a=t.indices,s=t.elementType,u=void 0===n?t.numElements:n;o=void 0===o?0:o,s||a?void 0!==i?e.drawElementsInstanced(r,u,void 0===s?ru:t.elementType,o,i):e.drawElements(r,u,void 0===s?ru:t.elementType,o):void 0!==i?e.drawArraysInstanced(r,o,u,i):e.drawArrays(r,o,u)}function ou(e,t){let r=null,n=null;t.forEach(function(t){if(!1===t.active)return;const o=t.programInfo,i=t.vertexArrayInfo||t.bufferInfo;let a=!1;const s=void 0===t.type?tu:t.type;o!==r&&(r=o,e.useProgram(o.program),a=!0),(a||i!==n)&&(n&&n.vertexArrayObject&&!i.vertexArrayObject&&e.bindVertexArray(null),n=i,Zs(e,o,i)),Ys(o,t.uniforms),nu(e,i,s,t.count,t.offset,t.instanceCount)}),n&&n.vertexArrayObject&&e.bindVertexArray(null)}var iu=Object.freeze({__proto__:null,drawBufferInfo:nu,drawObjectList:ou});exports.draw=iu;const au=36160,su=36161,uu=3553,cu=5121,fu=6402,lu=6408,mu=33190,pu=36012,du=35056,bu=36013,yu=32854,xu=32855,hu=36194,gu=33189,Fu=6401,Au=36168,wu=34041,vu=36064,Eu=36096,Tu=36128,Pu=33306,_u=33071,Su=9729,Bu=[{format:6408,type:5121,min:Su,wrap:_u},{format:34041}],Iu={};function zu(e,t){return Iu[e]||Iu[t]}Iu[34041]=33306,Iu[6401]=36128,Iu[36168]=36128,Iu[6402]=36096,Iu[33189]=36096,Iu[33190]=36096,Iu[36012]=36096,Iu[35056]=33306,Iu[36013]=33306;const Cu={};function Mu(e){return Cu[e]}function Ru(e,t,r,n){const o=au,i=e.createFramebuffer();e.bindFramebuffer(o,i),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight;let a=0;const s={framebuffer:i,attachments:[],width:r,height:n};return(t=t||Bu).forEach(function(t){let i=t.attachment;const u=t.format;let c=t.attachmentPoint||zu(u,t.internalFormat);if(c||(c=vu+a++),!i)if(Mu(u))i=e.createRenderbuffer(),e.bindRenderbuffer(su,i),e.renderbufferStorage(su,u,r,n);else{const o=Object.assign({},t);o.width=r,o.height=n,void 0===o.auto&&(o.auto=!1,o.min=o.min||o.minMag||Su,o.mag=o.mag||o.minMag||Su,o.wrapS=o.wrapS||o.wrap||_u,o.wrapT=o.wrapT||o.wrap||_u),i=Fi(e,o)}if(ze(e,i))e.framebufferRenderbuffer(o,c,su,i);else{if(!Me(e,i))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(o,c,i,t.level||0,t.layer):e.framebufferTexture2D(o,c,t.target||uu,i,t.level||0)}s.attachments.push(i)}),s}function ku(e,t,r,n,o){n=n||e.drawingBufferWidth,o=o||e.drawingBufferHeight,t.width=n,t.height=o,(r=r||Bu).forEach(function(r,i){const a=t.attachments[i],s=r.format;if(ze(e,a))e.bindRenderbuffer(su,a),e.renderbufferStorage(su,s,n,o);else{if(!Me(e,a))throw new Error("unknown attachment type");Ai(e,a,r,n,o)}})}function Uu(e,t,r){r=r||au,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}Cu[32854]=!0,Cu[32855]=!0,Cu[36194]=!0,Cu[34041]=!0,Cu[33189]=!0,Cu[6401]=!0,Cu[36168]=!0;var Ou=Object.freeze({__proto__:null,bindFramebufferInfo:Uu,createFramebufferInfo:Ru,resizeFramebufferInfo:ku});exports.framebuffers=Ou;const Lu=34963;function Du(e,t,r){const n=e.createVertexArray();return e.bindVertexArray(n),t.length||(t=[t]),t.forEach(function(t){Zs(e,t,r)}),e.bindVertexArray(null),{numElements:r.numElements,elementType:r.elementType,vertexArrayObject:n}}function ju(e,t,r,n){const o=e.createVertexArray();return e.bindVertexArray(o),Qs(t,r),n&&e.bindBuffer(Lu,n),e.bindVertexArray(null),o}function Vu(e,t,r){return ju(e,t.attribSetters||t,r.attribs,r.indices)}var Gu=Object.freeze({__proto__:null,createVertexArrayInfo:Du,createVAOAndSetAttributes:ju,createVAOFromBufferInfo:Vu});exports.vertexArrays=Gu;const Wu={addExtensionsToContext:!0};function $u(e){_e(e,Wu),qe(e),qo(e)}const Nu=/^(.*?)_/;function Xu(e,t){wr(e,0);const r=e.getExtension(t);if(r){const n={},o=Nu.exec(t)[1],i="_"+o;for(const t in r){const a=r[t],s="function"==typeof a,u=s?o:i;let c=t;t.endsWith(u)&&(c=t.substring(0,t.length-u.length)),void 0!==e[c]?s||e[c]===a||Be(c,e[c],a,t):s?e[c]=function(e){return function(){return e.apply(r,arguments)}}(a):(e[c]=a,n[c]=a)}n.constructor={name:r.constructor.name},wr(n,0)}return r}const Yu=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function qu(e){for(let t=0;t<Yu.length;++t)Xu(e,Yu[t])}function Hu(e,t){const r=["webgl","experimental-webgl"];let n=null;for(let o=0;o<r.length;++o)if(n=e.getContext(r[o],t)){Wu.addExtensionsToContext&&qu(n);break}return n}function Qu(e,t){return Hu(e,t)}function Zu(e,t){const r=["webgl2","webgl","experimental-webgl"];let n=null;for(let o=0;o<r.length;++o)if(n=e.getContext(r[o],t)){Wu.addExtensionsToContext&&qu(n);break}return n}function Ku(e,t){return Zu(e,t)}function Ju(e,t){t=t||1,t=Math.max(0,t);const r=e.clientWidth*t|0,n=e.clientHeight*t|0;return(e.width!==r||e.height!==n)&&(e.width=r,e.height=n,!0)}
},{}],"YGoC":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = texCoord;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n";
},{}],"UwF1":[function(require,module,exports) {
module.exports="\nprecision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 v_texCoord;\n\n// Colors used for rendering\nuniform sampler2D narrowFont;\nuniform sampler2D squareFont;\nuniform sampler2D palette;\n\n// Tables used for lookups\nuniform sampler2D charsTexture;\nuniform sampler2D backgroundColorTable;\nuniform sampler2D foregroundColorTable;\n\nuniform vec2 fontTileCount;\nuniform vec2 screenTileCount;\n\nvoid main() {\n  vec4 charSample = texture2D(charsTexture, v_texCoord);\n  vec2 char = (charSample.xy * 255.0);\n\n  vec2 bgColLoc = texture2D(backgroundColorTable, v_texCoord).xy * 255.0;\n  vec4 backgroundColor = texture2D(palette, (bgColLoc + 0.5) / 16.0);\n  vec2 fgColLoc = texture2D(foregroundColorTable, v_texCoord).xy * 255.0;\n  vec4 foregroundColor = texture2D(palette, (fgColLoc + 0.5) / 16.0);\n\n  bool doubleWidth = charSample.z > 0.5;\n\n  vec2 fontTileCountScaled = doubleWidth\n    ? vec2(fontTileCount.x * 2.0, fontTileCount.y)\n    : fontTileCount;\n  vec2 spriteSize = 1.0 / fontTileCountScaled;\n  vec2 fontTextureStartOffset = char * spriteSize;\n\n  vec2 spriteOffset = vec2(\n    mod((v_texCoord.x * screenTileCount.x), 1.0),\n    mod((v_texCoord.y * screenTileCount.y), 1.0)\n  ) * spriteSize;\n\n  vec2 fontTextureOffset = fontTextureStartOffset + spriteOffset;\n\n  vec4 fontCol = doubleWidth\n    ? texture2D(squareFont, fontTextureOffset)\n    //? vec4(spriteOffset / spriteSize, 0.0, 1.0)\n    : texture2D(narrowFont, fontTextureOffset);\n\n  //gl_FragColor = vec4(v_texCoord.x, 0.0, v_texCoord.y, 1.0);\n  fontCol = fontCol * foregroundColor;\n  gl_FragColor = vec4(mix(backgroundColor.rgb, fontCol.rgb, fontCol.a), 1.0);\n}\n";
},{}],"hqj0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrayBufferCursor=exports.Float32Cursor=void 0;var t=function(){function t(t){this.data=new Float32Array(t),this.offset=0}return t.prototype.push=function(t){this.data[this.offset]=t,this.offset+=1},t.prototype.push2=function(t,s){this.push(t),this.push(s)},t}();exports.Float32Cursor=t;var s=function(){function t(t){this.view=new DataView(t),this.offset=0}return t.prototype.f2=function(t,s){this.view.setFloat32(this.offset,t),this.offset+=4,this.view.setFloat32(this.offset,s),this.offset+=4},t}();exports.ArrayBufferCursor=s;
},{}],"mCSj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.quad=void 0;var r=require("./cursor");function u(u,e,s,t){var o=new r.Float32Cursor(12);return o.push2(u,e),o.push2(s,t),o.push2(u,t),o.push2(u,e),o.push2(s,e),o.push2(s,t),o.data}exports.quad=u;
},{"./cursor":"hqj0"}],"NauY":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(null!=r)for(var n in r)"default"!==n&&Object.hasOwnProperty.call(r,n)&&e(o,r,n);return t(o,r),o},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FontSpriteProgram=void 0;var n=r(require("twgl.js")),a=o(require("./fontsprite.vert")),u=o(require("./fontsprite.frag")),i=require("../../util/quad"),f=function(){function e(e){var t={position:{numComponents:2,data:i.quad(-1,1,1,-1)},texCoord:{numComponents:2,data:i.quad(0,0,1,1)}},r=n.createProgramInfo(e,[a.default,u.default]),o=n.createBufferInfoFromArrays(e,t);this.state={gl:e,programInfo:r,bufferInfo:o}}return e.prototype.render=function(e){var t=this.state.gl;t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.useProgram(this.state.programInfo.program),n.setBuffersAndAttributes(t,this.state.programInfo,this.state.bufferInfo),n.setUniforms(this.state.programInfo,{narrowFont:e.narrowFont,squareFont:e.squareFont,charsTexture:e.charsTable,palette:e.palette,backgroundColorTable:e.backgroundColorTable,foregroundColorTable:e.foregroundColorTable,fontTileCount:[16,16],screenTileCount:[e.cols,e.rows]}),n.drawBufferInfo(t,this.state.bufferInfo)},e}();exports.FontSpriteProgram=f;
},{"twgl.js":"e29r","./fontsprite.vert":"YGoC","./fontsprite.frag":"UwF1","../../util/quad":"mCSj"}],"mx25":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 scale;\n\nvoid main() {\n  v_texCoord = texCoord;\n  gl_Position = vec4(position * scale, 0.0, 1.0);\n}\n";
},{}],"bMyr":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D virtualScreen;\nuniform vec2 virtualScreenSize;\nuniform sampler2D scanlineTexture;\n\nvoid main() {\n  vec4 col = texture2D(virtualScreen, v_texCoord);\n\n  // Grab a pixel to the left for some bleed\n  vec2 left = vec2(-1.0 / virtualScreenSize.x, 0.0);\n  vec4 bleedCol = texture2D(virtualScreen, v_texCoord + left);\n  vec4 bleedCol2 = texture2D(virtualScreen, v_texCoord + left + left);\n\n  vec4 scanline = texture2D(scanlineTexture, v_texCoord * virtualScreenSize);\n\n  gl_FragColor = (col * 0.6 + bleedCol * 0.2 + bleedCol2 * 0.2) * scanline;\n}\n";
},{}],"LFsF":[function(require,module,exports) {
module.exports="precision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D virtualScreen;\n\nvoid main() {\n  vec4 col = texture2D(virtualScreen, v_texCoord);\n\n  gl_FragColor = col;\n}\n";
},{}],"mnlI":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(null!=r)for(var a in r)"default"!==a&&Object.hasOwnProperty.call(r,a)&&e(n,r,a);return t(n,r),n},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualScreenProgram=void 0;var a=r(require("twgl.js")),i=n(require("./virtualscreen.vert")),u=n(require("./virtualscreen.frag")),o=n(require("./virtualscreen_postprocess_off.frag")),s=require("../../util/quad"),f=function(){function e(e,t){var r={position:{numComponents:2,data:s.quad(-1,-1,1,1)},texCoord:{numComponents:2,data:s.quad(0,0,1,1)}},n=a.createProgramInfo(e,[i.default,t?u.default:o.default]),f=a.createBufferInfoFromArrays(e,r),c=a.createTexture(e,{src:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,90,90,90,255]),width:1,height:4});this.state={gl:e,programInfo:n,bufferInfo:f,scanlineTexture:c}}return e.prototype.render=function(e,t,r){var n=this.state.gl;n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND);var i=[t.x/n.canvas.width,t.y/n.canvas.height];n.useProgram(this.state.programInfo.program),a.setBuffersAndAttributes(n,this.state.programInfo,this.state.bufferInfo),a.setUniforms(this.state.programInfo,{virtualScreen:e,virtualScreenSize:[r.x,r.y],scale:i,scanlineTexture:this.state.scanlineTexture}),a.drawBufferInfo(n,this.state.bufferInfo)},e}();exports.VirtualScreenProgram=f;
},{"twgl.js":"e29r","./virtualscreen.vert":"mx25","./virtualscreen.frag":"bMyr","./virtualscreen_postprocess_off.frag":"LFsF","../../util/quad":"mCSj"}],"rSK1":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Vec2=void 0,function(e){e.scalarMult=function(e,t){return{x:e.x*t,y:e.y*t}}}(e=exports.Vec2||(exports.Vec2={}));
},{}],"IndL":[function(require,module,exports) {
"use strict";var t=this&&this.__createBinding||(Object.create?function(t,e,a,i){void 0===i&&(i=a),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[a]}})}:function(t,e,a,i){void 0===i&&(i=a),t[i]=e[a]}),e=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var i={};if(null!=a)for(var r in a)"default"!==r&&Object.hasOwnProperty.call(a,r)&&t(i,a,r);return e(i,a),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LookupTable=void 0;var i=a(require("twgl.js")),r=function(){function t(t){var e=this;this.setCell=function(t,a,i,r){e.backingData[4*t]=a,e.backingData[4*t+1]=i,e.backingData[4*t+2]=r?255:0},this.gl=t,this.backingData=new Uint8Array(4);var a={src:this.backingData,width:1,height:1,format:t.RGBA,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE};this.texture=i.createTexture(t,a)}return t.prototype.updateWithColorData=function(t,e,a){var r=this.gl,n=this.texture,o=0,s=t*e;for(this.backingData.length<4*s&&(this.backingData=new Uint8Array(4*s));o<s;){var h=a.getUint8(o),u=h%16,l=Math.floor(h/16);this.setCell(o,u,l,!1),o+=1}i.setTextureFromArray(r,n,this.backingData,{min:r.NEAREST,mag:r.NEAREST,width:t,height:e,wrap:r.CLAMP_TO_EDGE})},t.prototype.updateWithCharData=function(t,e,a){var r=this.gl,n=this.texture,o=0,s=t*e;for(this.backingData.length<4*s&&(this.backingData=new Uint8Array(4*s));o<s;){var h=a.getUint8(o),u=h%16,l=Math.floor(h/16);if(255!==h)this.setCell(o,u,l,!1);else{var c=a.getUint8(o+1),f=c%16,g=Math.floor(c/16);this.setCell(o,2*f,g,!0),this.setCell(o+1,2*f+1,g,!0),o+=1}o+=1}i.setTextureFromArray(r,n,this.backingData,{min:r.NEAREST,mag:r.NEAREST,width:t,height:e,wrap:r.CLAMP_TO_EDGE})},t}();exports.LookupTable=r;
},{"twgl.js":"e29r"}],"zUtG":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var a={};if(null!=r)for(var n in r)"default"!==n&&Object.hasOwnProperty.call(r,n)&&e(a,r,n);return t(a,r),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Renderer=void 0;var a=require("./fontsprite/fontsprite"),n=r(require("twgl.js")),i=require("./virtualscreen/virtualscreen"),o=require("../util/vec2"),s=require("./lookup_table"),u=[{min:WebGLRenderingContext.NEAREST,mag:WebGLRenderingContext.NEAREST}],l=function(){function e(e,t,r,o){var l=e.getContext("webgl");if(null==l)throw new Error("Could not start webgl");var c=n.createTexture(l,{src:t.narrow,min:l.NEAREST,mag:l.NEAREST}),h=n.createTexture(l,{src:t.square,min:l.NEAREST,mag:l.NEAREST}),f=n.createTexture(l,{src:r,min:l.NEAREST,mag:l.NEAREST}),b=n.createFramebufferInfo(l,u,1,1);this.state={gl:l,fontSpriteProgram:new a.FontSpriteProgram(l),virtualScreenProgram:new i.VirtualScreenProgram(l,o),charsTable:new s.LookupTable(l),bgColorTable:new s.LookupTable(l),fgColorTable:new s.LookupTable(l),narrowFontTexture:c,squareFontTexture:h,virtualScreen:b,palette:f}}return e.prototype.clear=function(){var e=this.state.gl;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)},e.prototype.useVirtualScreen=function(){n.bindFramebufferInfo(this.state.gl,this.state.virtualScreen),this.clear()},e.prototype.useRealScreen=function(){var e=this.state.gl;n.bindFramebufferInfo(e,null),e.viewport(0,0,e.canvas.width,e.canvas.height),this.clear()},e.prototype.render=function(e,t,r){var a=this.state.gl;this.state.virtualScreen.width==e.x&&this.state.virtualScreen.height==e.y||n.resizeFramebufferInfo(a,this.state.virtualScreen,u,e.x,e.y),this.useVirtualScreen(),a.viewport(0,0,e.x,e.y),this.state.fontSpriteProgram.render({rows:t,cols:r,narrowFont:this.state.narrowFontTexture,squareFont:this.state.squareFontTexture,palette:this.state.palette,charsTable:this.state.charsTable.texture,backgroundColorTable:this.state.bgColorTable.texture,foregroundColorTable:this.state.fgColorTable.texture}),this.useRealScreen();var i=a.canvas.width/this.state.virtualScreen.width,s=a.canvas.height/this.state.virtualScreen.height,l=Math.floor(Math.max(1,Math.min(i,s)));this.state.virtualScreenProgram.render(this.state.virtualScreen.attachments[0],o.Vec2.scalarMult(e,l),e)},e}();exports.Renderer=l;
},{"./fontsprite/fontsprite":"NauY","twgl.js":"e29r","./virtualscreen/virtualscreen":"mnlI","../util/vec2":"rSK1","./lookup_table":"IndL"}],"ZCfc":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./wasm/load"),r=require("./rendering/renderer"),o=require("twgl.js"),a=document.getElementById("canvas");fetch("./manifest.json").then(function(e){return e.json()}).then(function(e){return i(e)});var i=function(i){return e(void 0,void 0,void 0,function(){var e,s,u,l,c;return t(this,function(t){switch(t.label){case 0:if(null==i.manifestVersion)throw console.log(i),new Error("Manifest version not specified");if(i.manifestVersion>1)throw console.log(i),new Error("Only manifest version 1 is currently supported");return e=new r.Renderer(a,i.fonts,i.palette,!1!==i.postProcessing),[4,n.WasmProgram.load(i.program)];case 1:return s=t.sent(),!1,document.addEventListener("keydown",function(e){i.inputMappings.forEach(function(t){t.keys.includes(e.key)&&s.setInput(t.address,1)}),e.key,console.log(e.key)}),document.addEventListener("keyup",function(e){i.inputMappings.forEach(function(t){t.keys.includes(e.key)&&s.setInput(t.address,0)}),e.key}),u=0,(c=function(t){var n;n=null==l||null==t?.016:(t-l)/1e3,l=t,s.tick(n);var r=!1;u%10==0&&(r=o.resizeCanvasToDisplaySize(a,window.devicePixelRatio||1));var f=s.config,d=s.screen,p=s.bgColors,h=s.fgColors;h.update&&e.state.fgColorTable.updateWithColorData(f.cols,f.rows,h.cells),p.update&&e.state.bgColorTable.updateWithColorData(f.cols,f.rows,p.cells),d.update&&e.state.charsTable.updateWithCharData(f.cols,f.rows,d.cells);var y={x:f.cols*i.fonts.gridSize.width,y:f.rows*i.fonts.gridSize.height};(d.update||p.update||h.update||r)&&(e.render(y,f.rows,f.cols),e.state.gl.finish(),h.update=!1,p.update=!1,d.update=!1),u+=1,requestAnimationFrame(c)})(),a.addEventListener("dblclick",function(){a.requestFullscreen()}),[2]}})})};
},{"./wasm/load":"FpUS","./rendering/renderer":"zUtG","twgl.js":"e29r"}]},{},["ZCfc"], null)
//# sourceMappingURL=/main.js.map